{"id":"the-system-020","title":"[EPIC] Reranker Core Infrastructure","description":"Core reranker infrastructure for Engram search pipeline.\n\nBounded Context: Reranker Domain\nReference: docs/plans/reranker-implementation.md (Section 3.2)\n\nProvides the foundational reranking capabilities including:\n- BatchedReranker for parallel document scoring\n- Model management and singleton patterns\n- Score normalization and result merging\n\nThis epic enables multi-tier reranking architecture.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T22:55:04.069554-06:00","updated_at":"2025-12-08T23:53:50.186046-06:00","closed_at":"2025-12-08T23:53:50.186046-06:00"}
{"id":"the-system-0js","title":"CRITICAL: XState guard evaluates stale context - tools never execute","description":"Location: apps/control/src/engine/decision.ts:216-218\n\nThe guard 'requiresTool' reads from context.currentToolCalls which is assigned by the onDone action. In XState v5, guards are evaluated BEFORE actions run. The guard checks the PREVIOUS value of currentToolCalls, not the value from event.output.\n\nImpact: Tool calls are never executed; agent always responds without using tools.\n\nFix: Access event.output in the guard instead of context, or restructure the state machine.","status":"in_progress","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:55:48.646311-06:00","updated_at":"2025-12-10T20:13:33.362638-06:00"}
{"id":"the-system-0kvz","title":"MEDIUM: Promise completion detection logic broken in BatchedReranker","description":"Location: packages/search-core/src/services/batched-reranker.ts:309-321\n\nThe logic races already-completed promises against Promise.resolve(false) which returns false immediately. No promises are ever removed from the executing array.\n\nImpact: Concurrency limits are not enforced correctly.\n\nFix: Use proper promise tracking or Promise.allSettled pattern.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:58:19.248795-06:00","updated_at":"2025-12-09T16:58:19.248795-06:00"}
{"id":"the-system-0mn","title":"Add reranker health check endpoint","description":"GET /health/reranker: model loaded status, last inference time, error count last 5min, circuit breaker state.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T23:02:32.531406-06:00","updated_at":"2025-12-09T00:35:31.540248-06:00","closed_at":"2025-12-09T00:35:31.540248-06:00"}
{"id":"the-system-0vl","title":"Implement UI for Lineage and Replay","description":"Build React components in apps/interface to visualize the lineage graph and session replay data using the new API endpoints.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T01:21:25.207222-06:00","updated_at":"2025-12-07T01:32:59.460857-06:00","closed_at":"2025-12-07T01:32:59.460857-06:00"}
{"id":"the-system-17o","title":"Design LLM reranking prompt templates","description":"Design effective prompt templates for listwise reranking.\n\nReference: docs/plans/reranker-implementation.md (Phase 4)\n\nPrompt requirements:\n- Present query and all candidates clearly\n- Request ordered ranking with reasoning\n- Handle different content types (code, text, mixed)\n- Optimize for grok-4-1-fast-reasoning token efficiency\n\nTemplate structure:\n```\nSystem: You are a search relevance expert...\nUser: \nQuery: {query}\nCandidates:\n1. {doc1_content}\n2. {doc2_content}\n...\nRank these candidates by relevance to the query.\nReturn format: [1, 3, 2, ...] most to least relevant.\n```\n\nLocation: packages/search-core/src/services/llm-reranker.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:57:23.380636-06:00","updated_at":"2025-12-09T00:36:40.249902-06:00","closed_at":"2025-12-09T00:36:40.249902-06:00"}
{"id":"the-system-1cg","title":"Add rerank options to SearchQuery interface","description":"Extend SearchQuery interface with reranking options.\n\nReference: docs/plans/reranker-implementation.md (Section 4.1)\n\nInterface update:\n```typescript\nexport interface SearchOptions {\n  // Existing\n  limit?: number;\n  filters?: SearchFilters;\n  strategy?: SearchStrategy;\n\n  // New: Reranking control\n  rerank?: boolean;              // Default: true\n  rerankTier?: RerankerTier;     // Default: auto-routed\n  rerankDepth?: number;          // How many to fetch for reranking\n}\n```\n\nDefault behavior:\n- rerank: true (enabled by default)\n- rerankTier: undefined (auto-routed)\n- rerankDepth: 30 (oversample for reranking)\n\nLocation: packages/search-core/src/models/schema.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:57:50.618749-06:00","updated_at":"2025-12-08T23:06:54.942258-06:00","closed_at":"2025-12-08T23:06:54.942258-06:00"}
{"id":"the-system-1ir","title":"MEDIUM: Process event listeners accumulate - memory leak","description":"Location: apps/search/src/index.ts:110-117\n\nThe startConsumer() method registers SIGTERM and SIGINT handlers every time it is called. These handlers are never removed.\n\nImpact: Memory leak, MaxListenersExceededWarning after 11 listeners.\n\nFix: Use process.once() instead of process.on(), or store and remove listeners.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:57:03.492692-06:00","updated_at":"2025-12-09T16:57:03.492692-06:00"}
{"id":"the-system-1p4","title":"Integrate Microsoft Wassette Library","description":"","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T00:35:57.400142-06:00","updated_at":"2025-12-07T00:44:03.560935-06:00","closed_at":"2025-12-07T00:44:03.560935-06:00","dependencies":[{"issue_id":"the-system-1p4","depends_on_id":"the-system-5ll","type":"blocks","created_at":"2025-12-07T00:36:36.294796-06:00","created_by":"daemon"},{"issue_id":"the-system-1p4","depends_on_id":"the-system-28p","type":"blocks","created_at":"2025-12-07T00:36:36.327121-06:00","created_by":"daemon"},{"issue_id":"the-system-1p4","depends_on_id":"the-system-3lb","type":"blocks","created_at":"2025-12-07T00:36:36.357739-06:00","created_by":"daemon"},{"issue_id":"the-system-1p4","depends_on_id":"the-system-yvm","type":"blocks","created_at":"2025-12-07T00:36:36.387797-06:00","created_by":"daemon"}]}
{"id":"the-system-1q5","title":"[EPIC] Phase 1: Type Safety \u0026 Error Handling","description":"# Phase 1: Type Safety \u0026 Error Handling\n\n**Duration**: 3-4 days\n**Dependencies**: Phase 0 complete\n**Parallelization**: Tasks 1.1, 1.2, 1.3 can run in parallel\n\n## Overview\nAddress type safety issues and fix silent error swallowing across the codebase:\n- Remove dangerous `as any` type casts\n- Add Zod schemas to parsers for runtime validation\n- Fix silent error swallowing patterns\n\n## Issue Summary\n- Total `as any` casts: 70+\n- Silent error catches: 15+\n- Parsers without validation: 8\n\n## Success Criteria\n- [ ] `as any` usage reduced from 70+ to \u003c10\n- [ ] All parsers have Zod validation\n- [ ] No silent error swallowing\n- [ ] All tests pass\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 249-345)\n- docs/refactor/apps/execution/REPORT.md\n- docs/refactor/apps/ingestion/REPORT.md\n- docs/refactor/packages/ingestion-core/REPORT.md","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-09T03:30:31.92641-06:00","updated_at":"2025-12-09T04:03:15.833088-06:00","closed_at":"2025-12-09T04:03:15.833088-06:00","labels":["p0","refactoring","type-safety"],"dependencies":[{"issue_id":"the-system-1q5","depends_on_id":"the-system-wai","type":"blocks","created_at":"2025-12-09T03:38:41.068863-06:00","created_by":"daemon"}]}
{"id":"the-system-1q5.1","title":"[1.1] Remove 'as any' Type Bypasses","description":"# Task 1.1: Remove `as any` Type Bypasses\n\n**Effort**: 8 hours\n**Dependencies**: Task 0.2 (Storage Interfaces)\n**Parallel**: Can run with 1.2, 1.3 (after 0.2 complete)\n\n## Files by Priority\n\n| File | Count | Resolution |\n|------|-------|------------|\n| `apps/execution/src/index.ts` | 6 | Create proper MCP SDK types |\n| `apps/ingestion/src/index.ts` | 1 | Import KafkaClient types |\n| `apps/search/src/index.ts` | 5 | Import Kafka message types |\n| `apps/control/src/index.ts` | 1 | Use null pattern for SearchRetriever |\n| `packages/search-core/src/services/*.ts` | 8 | Type pipeline functions properly |\n| `packages/logger/src/index.ts` | 1 | Fix level type |\n\n## Strategy\n1. Audit all `as any` casts with `grep -r \"as any\" --include=\"*.ts\"`\n2. For each cast, determine proper type\n3. Create missing type definitions where needed\n4. Update function signatures to accept proper types\n\n## Acceptance Criteria\n- [ ] `as any` count reduced from 70+ to \u003c10\n- [ ] No type errors introduced\n- [ ] All tests pass\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 255-274)\n- docs/refactor/apps/execution/REPORT.md\n- docs/refactor/apps/search/REPORT.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T03:30:49.207013-06:00","updated_at":"2025-12-09T04:03:15.718563-06:00","closed_at":"2025-12-09T04:03:15.718563-06:00","labels":["parallel-ok","refactoring","type-safety"],"dependencies":[{"issue_id":"the-system-1q5.1","depends_on_id":"the-system-1q5","type":"parent-child","created_at":"2025-12-09T03:30:49.207418-06:00","created_by":"daemon"},{"issue_id":"the-system-1q5.1","depends_on_id":"the-system-wai.2","type":"blocks","created_at":"2025-12-09T03:38:47.944607-06:00","created_by":"daemon"}]}
{"id":"the-system-1q5.2","title":"[1.2] Add Zod Schemas to Ingestion Parsers","description":"# Task 1.2: Add Zod Schemas to Parsers\n\n**Effort**: 8 hours\n**Dependencies**: Task 0.1 (@engram/common)\n**Parallel**: Can run with 1.1, 1.3 (after 0.1 complete)\n\n## Deliverables\nCreate: `packages/ingestion-core/src/parser/schemas.ts`\n\n```typescript\nexport const AnthropicMessageStartSchema = z.object({\n  type: z.literal(\"message_start\"),\n  message: z.object({\n    usage: z.object({\n      input_tokens: z.number(),\n    }).optional(),\n  }).optional(),\n});\n\nexport const OpenAIChunkSchema = z.object({\n  choices: z.array(z.object({\n    delta: z.object({\n      content: z.string().optional(),\n      tool_calls: z.array(z.object({\n        id: z.string(),\n        function: z.object({\n          name: z.string(),\n          arguments: z.string(),\n        }),\n      })).optional(),\n    }),\n  })),\n});\n\n// Add schemas for all 8 parsers\n```\n\n## Parsers to Update\n- AnthropicParser\n- OpenAIParser\n- ClaudeCodeParser\n- GeminiParser\n- CodexParser\n- ClineParser\n- XAIParser\n- OpenCodeParser\n\n## Acceptance Criteria\n- [ ] All 8 parsers have Zod schemas\n- [ ] Runtime validation active\n- [ ] ParseError thrown on invalid input\n- [ ] Unit tests for each schema\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 276-323)\n- docs/refactor/packages/ingestion-core/REPORT.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T03:31:01.914302-06:00","updated_at":"2025-12-09T04:03:15.76196-06:00","closed_at":"2025-12-09T04:03:15.76196-06:00","labels":["parallel-ok","refactoring","type-safety","zod"],"dependencies":[{"issue_id":"the-system-1q5.2","depends_on_id":"the-system-1q5","type":"parent-child","created_at":"2025-12-09T03:31:01.914809-06:00","created_by":"daemon"},{"issue_id":"the-system-1q5.2","depends_on_id":"the-system-wai.1","type":"blocks","created_at":"2025-12-09T03:38:47.975938-06:00","created_by":"daemon"}]}
{"id":"the-system-1q5.3","title":"[1.3] Fix Silent Error Swallowing","description":"# Task 1.3: Fix Silent Error Swallowing\n\n**Effort**: 4 hours\n**Dependencies**: Task 0.1 (error types from @engram/common)\n**Parallel**: Can run with 1.1, 1.2 (after 0.1 complete)\n\n## Locations to Fix\n\n| File | Lines | Current Behavior | Fix |\n|------|-------|------------------|-----|\n| `apps/control/src/context/assembler.ts` | 113-116, 147-150 | Returns `[]` | Log + throw ContextAssemblyError |\n| `packages/execution-core/src/rehydrator.ts` | 33-43 | Silent JSON parse | Log + throw RehydrationError |\n| `apps/ingestion/src/index.ts` | 173-178 | Kafka errors logged only | Add to DLQ |\n| `apps/memory/src/index.ts` | 84-87 | Silent message drop | Log warning |\n| `packages/vfs/src/patch.ts` | 12-14 | Silent catch | Check error type, rethrow unexpected |\n| `packages/logger/src/browser.ts` | 44-46 | Silent fetch failure | Add error callback |\n| `packages/storage/src/blob.ts` | 78-83, 112-117 | Returns stub URI | Throw or use Result type |\n\n## Error Types to Use (from @engram/common)\n- `EngramError` - base class\n- `GraphOperationError` - FalkorDB operations\n- `ParseError` - parsing failures\n- `ValidationError` - validation failures\n- `ContextAssemblyError` - context building\n- `RehydrationError` - state reconstruction\n\n## Acceptance Criteria\n- [ ] All silent catches identified and fixed\n- [ ] Appropriate error types used\n- [ ] Errors logged before throwing\n- [ ] DLQ implementation for Kafka\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 325-345)\n- docs/refactor/apps/control/REPORT.md\n- docs/refactor/packages/execution-core/REPORT.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T03:31:15.864464-06:00","updated_at":"2025-12-09T04:03:15.798651-06:00","closed_at":"2025-12-09T04:03:15.798651-06:00","labels":["error-handling","parallel-ok","refactoring"],"dependencies":[{"issue_id":"the-system-1q5.3","depends_on_id":"the-system-1q5","type":"parent-child","created_at":"2025-12-09T03:31:15.864991-06:00","created_by":"daemon"},{"issue_id":"the-system-1q5.3","depends_on_id":"the-system-wai.1","type":"blocks","created_at":"2025-12-09T03:38:48.008965-06:00","created_by":"daemon"}]}
{"id":"the-system-1s8","title":"Migrate tests from bun:test to vitest","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T19:02:32.952965-06:00","updated_at":"2025-12-08T19:13:02.357643-06:00","closed_at":"2025-12-08T19:13:02.357643-06:00"}
{"id":"the-system-1v5","title":"Integrate SpladeEmbedder into TextEmbedder","description":"Update TextEmbedder to use SpladeEmbedder for embedSparse() and embedSparseQuery() methods. Replace BM25Sparse usage. Keep BM25Sparse as fallback initially.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T19:25:05.862727-06:00","updated_at":"2025-12-08T19:43:44.839434-06:00","closed_at":"2025-12-08T19:43:44.839434-06:00","dependencies":[{"issue_id":"the-system-1v5","depends_on_id":"the-system-4au","type":"blocks","created_at":"2025-12-08T19:25:16.360697-06:00","created_by":"daemon"}]}
{"id":"the-system-1wn","title":"Add Test Coverage: packages/ingestion-core","description":"Add comprehensive unit and integration tests for packages/ingestion-core","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T01:51:16.522674-06:00","updated_at":"2025-12-07T01:59:24.390314-06:00","closed_at":"2025-12-07T01:59:24.390314-06:00","labels":["ingestion-core","packages","testing"]}
{"id":"the-system-1zvv","title":"LOW: Log loss when forwardToBackend is false","description":"Location: packages/logger/src/browser.ts:30-36\n\nWhen forwardToBackend is false, flush() clears the buffer before checking the flag. Logs accumulated in the buffer are silently discarded.\n\nFix: Check forwardToBackend before clearing buffer.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:58:52.496359-06:00","updated_at":"2025-12-09T16:58:52.496359-06:00"}
{"id":"the-system-24i","title":"Create test dataset with relevance judgments","description":"Curate 100+ query-document pairs with human relevance labels for evaluation. Export to JSON for reproducible benchmarks.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T23:01:48.398766-06:00","updated_at":"2025-12-09T00:35:34.847294-06:00","closed_at":"2025-12-09T00:35:34.847294-06:00"}
{"id":"the-system-25p","title":"[EPIC] Testing \u0026 Quality","description":"Unit tests, integration tests, and quality evaluation for reranker system (Section 10)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-08T23:01:25.788967-06:00","updated_at":"2025-12-08T23:59:28.757899-06:00","closed_at":"2025-12-08T23:59:28.757899-06:00","dependencies":[{"issue_id":"the-system-25p","depends_on_id":"the-system-hcz","type":"blocks","created_at":"2025-12-08T23:03:03.470975-06:00","created_by":"daemon"}]}
{"id":"the-system-28p","title":"Configure Control Service MCP Client","description":"the-system-1p4","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T00:36:28.953409-06:00","updated_at":"2025-12-07T00:39:29.552858-06:00","closed_at":"2025-12-07T00:39:29.552858-06:00"}
{"id":"the-system-2a6","title":"Create SearchResults component with result cards","description":"Create a search results grid component matching SessionBrowser's design.\n\nReference: docs/plans/search-ui.md (Phase 2: SearchResults Component)\n\nNew file: apps/interface/app/components/SearchResults.tsx\n\nSearchResults component:\n- Header: \"‚óè SEARCH RESULTS\" with match count badge\n- Grid layout: repeat(auto-fill, minmax(220px, 1fr)) - same as SessionBrowser\n- Empty state: \"No matches found. Try different keywords.\"\n- Error state: \"Search unavailable. Check connection.\"\n- Loading state: Skeleton cards with pulse animation\n\nSearchResultCard sub-component props:\n- type: 'thought' | 'code' | 'doc'\n- content: string (truncated to ~100 chars with ellipsis)\n- score: number (0-1, displayed as percentage like \"92% match\")\n- sessionId: string (truncated to 8 chars, clickable)\n- nodeId: string (for future deep linking)\n- timestamp: number (formatted as relative time)\n- onClick: () =\u003e void\n\nVisual design:\n- Card background: rgba(15, 20, 30, 0.6) with glassmorphism\n- Type icon/badge with color:\n  - Thought: üí≠ or brain icon, rgb(139, 92, 246) violet\n  - Code: üíª or code icon, rgb(251, 191, 36) amber  \n  - Doc: üìÑ or file icon, rgb(59, 130, 246) blue\n- Score bar: 5 segments like activity bar, filled based on score percentage\n- Hover: translateY(-2px), border glow, background gradient shift\n- Animation: cardReveal with staggered delay (same as SessionCard)\n\nClick action: navigate to /session/{sessionId}\nFuture: add ?highlight={nodeId} for deep linking to specific node","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T21:39:23.535994-06:00","updated_at":"2025-12-08T21:53:46.845027-06:00","closed_at":"2025-12-08T21:53:46.845027-06:00"}
{"id":"the-system-2bb","title":"Add Test Coverage: packages/execution-core","description":"Add comprehensive unit and integration tests for packages/execution-core","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T01:51:16.421619-06:00","updated_at":"2025-12-07T02:01:51.776297-06:00","closed_at":"2025-12-07T02:01:51.776297-06:00","labels":["execution-core","packages","testing"]}
{"id":"the-system-2cgm","title":"MEDIUM: Unhandled JSON.parse errors in session repository","description":"Location: packages/memory-core/src/repositories/falkor-session.repository.ts:210\n\nJSON.parse(props.metadata) is called without try-catch. If metadata contains malformed JSON, this will throw an unhandled exception.\n\nImpact: Crashes operation if database contains corrupted metadata.\n\nFix: Wrap JSON.parse in try-catch, log warning, return undefined on failure.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:57:37.619302-06:00","updated_at":"2025-12-09T16:57:37.619302-06:00"}
{"id":"the-system-2fu","title":"MEDIUM: Redis connection race condition returns null client","description":"Locations:\n- packages/storage/src/redis.ts:42-61\n\nThe connection wait loop has a race condition. If connecting becomes true and the connection fails, connecting is reset but client remains null. Waiting callers return client! which is null.\n\nImpact: Null pointer crashes under network failure conditions.\n\nFix: Check client is not null after exiting wait loop.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:57:31.869197-06:00","updated_at":"2025-12-09T16:57:31.869197-06:00"}
{"id":"the-system-2h1v","title":"MEDIUM: FalkorDB connection promise created eagerly","description":"Location: packages/storage/src/falkor.ts:77-88\n\nThe FalkorClient constructor creates a connection promise immediately upon instantiation. If FalkorDB is unavailable, errors surface later unexpectedly.\n\nImpact: Test setup complexity, confusing error timing.\n\nFix: Defer connection until connect() is explicitly called.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:58:19.956142-06:00","updated_at":"2025-12-09T16:58:19.956142-06:00"}
{"id":"the-system-2i4","title":"Update Qdrant schema for separate code/text vectors","description":"CodeEmbedder now uses nomic-embed-text-v1 (768 dim) while TextEmbedder uses e5-small (384 dim). The current schema only has a single 'dense' vector field. Need to: 1) Add separate vector fields (text_dense: 384, code_dense: 768), 2) Update indexer to use correct vector field based on content type, 3) Consider migration strategy for existing data.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T02:20:56.357901-06:00","updated_at":"2025-12-08T02:35:58.080574-06:00","closed_at":"2025-12-08T02:35:58.080574-06:00"}
{"id":"the-system-2l1","title":"CRITICAL: Arbitrary Cypher query execution without auth","description":"Location: apps/interface/app/api/graphql/schema.ts:115-121\n\nThe 'graph' resolver accepts arbitrary Cypher queries and executes them directly. The comment acknowledges this should be protected, but there is no authentication or authorization check.\n\nImpact: Any GraphQL user can execute arbitrary database commands including data deletion, extraction, or manipulation.\n\nFix: Either remove the graph resolver entirely or add strong authentication/authorization.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:55:49.997962-06:00","updated_at":"2025-12-09T16:55:49.997962-06:00"}
{"id":"the-system-2p2","title":"HIGH: Database connection leak in handleListFilesAtTime","description":"Location: apps/execution/src/index.ts:145-158\n\nThe handleListFilesAtTime function calls graphClient.connect() but never calls disconnect(). Each invocation opens a new connection that is never closed.\n\nImpact: Connection pool exhaustion over time.\n\nFix: Add finally block to ensure disconnect() is always called.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:56:57.512847-06:00","updated_at":"2025-12-09T16:56:57.512847-06:00"}
{"id":"the-system-2r3","title":"Implement graceful degradation on reranker failure","description":"If reranker throws/times out: return RRF results with degradation flag. Log error. Don't fail the entire search.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T23:02:31.528484-06:00","updated_at":"2025-12-09T00:13:48.384792-06:00","closed_at":"2025-12-09T00:13:48.384792-06:00"}
{"id":"the-system-2v4","title":"Expand CI/CD pipeline for all services","description":"cloudbuild.yaml only includes build/deploy steps for ingestion service. Need to add similar steps for memory, search, execution, control, and interface services. Consider matrix builds for efficiency. Ref: define-cicd-pipeline.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T02:06:31.315902-06:00","updated_at":"2025-12-08T02:45:53.073412-06:00","closed_at":"2025-12-08T02:45:53.073412-06:00"}
{"id":"the-system-2zx3","title":"LOW: Division by zero in reranking statistics","description":"Location: packages/search-core/src/services/retriever.ts:186-190\n\nWhen calculating average scores, there is no check for empty arrays. If reranked is empty, avgRerankedScore will be NaN (0/0).\n\nFix: Add length check before division.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:59:17.089991-06:00","updated_at":"2025-12-09T16:59:17.089991-06:00"}
{"id":"the-system-3al","title":"Integrate xAI Grok Model","description":"Replace mock model in DecisionEngine with xAI grok-4-1-fast-reasoning using OpenAI compatibility.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T01:19:43.069323-06:00","updated_at":"2025-12-07T01:20:41.45158-06:00","closed_at":"2025-12-07T01:20:41.45158-06:00"}
{"id":"the-system-3f78","title":"LOW: VirtualFileSystem cwd property never used","description":"Location: packages/vfs/src/vfs.ts:22,26\n\nThe cwd property is initialized but never used in any method. All path operations use absolute paths.\n\nFix: Remove dead code or implement relative path support.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:59:45.485677-06:00","updated_at":"2025-12-09T16:59:45.485677-06:00"}
{"id":"the-system-3jt","title":"Add TurnNode schema to memory-core","description":"Create TurnNode with user_content, assistant_preview, blob_ref, embedding, sequence_index, files_touched","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T03:13:52.852817-06:00","updated_at":"2025-12-08T03:18:11.118751-06:00","closed_at":"2025-12-08T03:18:11.118751-06:00","dependencies":[{"issue_id":"the-system-3jt","depends_on_id":"the-system-3sh","type":"blocks","created_at":"2025-12-08T03:14:04.438837-06:00","created_by":"daemon"}]}
{"id":"the-system-3lb","title":"Update Execution Service to use Wassette","description":"the-system-1p4","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T00:36:28.997771-06:00","updated_at":"2025-12-07T00:41:57.107522-06:00","closed_at":"2025-12-07T00:41:57.107522-06:00"}
{"id":"the-system-3sh","title":"Refactor graph nodes: Replace ThoughtNode with Turn/Reasoning/FileTouch hierarchy","description":"","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T03:13:41.027462-06:00","updated_at":"2025-12-08T03:24:06.53209-06:00","closed_at":"2025-12-08T03:24:06.53209-06:00"}
{"id":"the-system-3v3","title":"Add ReasoningNode schema to memory-core","description":"Create ReasoningNode for thinking blocks within a turn, with content_hash, preview, blob_ref, embedding, sequence_index","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T03:13:53.505541-06:00","updated_at":"2025-12-08T03:18:11.157575-06:00","closed_at":"2025-12-08T03:18:11.157575-06:00","dependencies":[{"issue_id":"the-system-3v3","depends_on_id":"the-system-3sh","type":"blocks","created_at":"2025-12-08T03:14:04.476967-06:00","created_by":"daemon"}]}
{"id":"the-system-3xi","title":"HIGH: Cypher injection in GraphMerger","description":"Location: packages/memory-core/src/merger.ts:28,34\n\nThe mergeNodes method interpolates the relationship type from query results directly into new queries without validation.\n\nRisk: If the database contains malicious data in relationship types, this could cause unexpected behavior.\n\nFix: Validate relationship types before interpolation.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:56:18.594555-06:00","updated_at":"2025-12-09T16:56:18.594555-06:00"}
{"id":"the-system-43s","title":"Add structured logging for rerank events","description":"Log: event=search_rerank with query hash, tier, model, inputCandidates, outputResults, latencyMs, topScoreDelta","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T23:02:02.506404-06:00","updated_at":"2025-12-08T23:58:32.827028-06:00","closed_at":"2025-12-08T23:58:32.827028-06:00"}
{"id":"the-system-455","title":"Bounded Context: System Infrastructure","description":"Foundational deployment configuration, container orchestration (GKE/Cloud Run), and database provisioning (Redpanda, FalkorDB, Qdrant). See docs/bitemporal/context/system-infrastructure/","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:47:42.307572-06:00","updated_at":"2025-12-06T22:11:34.264873-06:00","closed_at":"2025-12-06T22:11:34.264879-06:00","labels":["context","gcp","infrastructure"]}
{"id":"the-system-455.1","title":"Define Monorepo Structure","description":"Establish Turborepo v2.6.3 workspace with 'apps', 'packages', and 'tooling'. See docs/bitemporal/context/system-infrastructure/define-monorepo-structure.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:48:15.819997-06:00","updated_at":"2025-12-06T22:08:27.919338-06:00","closed_at":"2025-12-06T22:08:27.919341-06:00","labels":["infrastructure","setup","turborepo"],"dependencies":[{"issue_id":"the-system-455.1","depends_on_id":"the-system-455","type":"parent-child","created_at":"2025-12-06T21:48:15.820431-06:00","created_by":"daemon"}]}
{"id":"the-system-455.10","title":"Define CI/CD Pipeline","description":"Google Cloud Build configuration (cloudbuild.yaml). See docs/bitemporal/context/system-infrastructure/define-cicd-pipeline.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:48:16.210169-06:00","updated_at":"2025-12-06T22:11:16.052419-06:00","closed_at":"2025-12-06T22:11:16.052426-06:00","labels":["cicd","gcp","infrastructure"],"dependencies":[{"issue_id":"the-system-455.10","depends_on_id":"the-system-455","type":"parent-child","created_at":"2025-12-06T21:48:16.210608-06:00","created_by":"daemon"}]}
{"id":"the-system-455.11","title":"Define Secret Management","description":"Integrate GCP Secret Manager with Cloud Run. See docs/bitemporal/context/system-infrastructure/define-secret-management.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:48:16.253675-06:00","updated_at":"2025-12-06T22:11:16.081949-06:00","closed_at":"2025-12-06T22:11:16.081954-06:00","labels":["gcp","infrastructure","security"],"dependencies":[{"issue_id":"the-system-455.11","depends_on_id":"the-system-455","type":"parent-child","created_at":"2025-12-06T21:48:16.25406-06:00","created_by":"daemon"}]}
{"id":"the-system-455.12","title":"Define Log Aggregation","description":"Structured JSON logging (Pino) for Cloud Logging. See docs/bitemporal/context/system-infrastructure/define-log-aggregation.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:48:16.299128-06:00","updated_at":"2025-12-06T22:10:59.067709-06:00","closed_at":"2025-12-06T22:10:59.067714-06:00","labels":["infrastructure","logging","observability"],"dependencies":[{"issue_id":"the-system-455.12","depends_on_id":"the-system-455","type":"parent-child","created_at":"2025-12-06T21:48:16.299554-06:00","created_by":"daemon"}]}
{"id":"the-system-455.13","title":"Create Development Environment Setup","description":"docker-compose.dev.yml and 'bun run dev' scripts. See docs/bitemporal/context/system-infrastructure/create-development-environment-setup.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:48:16.345125-06:00","updated_at":"2025-12-06T22:08:55.192389-06:00","closed_at":"2025-12-06T22:08:55.192393-06:00","labels":["dx","infrastructure","setup"],"dependencies":[{"issue_id":"the-system-455.13","depends_on_id":"the-system-455","type":"parent-child","created_at":"2025-12-06T21:48:16.345549-06:00","created_by":"daemon"}]}
{"id":"the-system-455.2","title":"Define Cloud Infrastructure Strategy","description":"Architecture for Cloud Run (Stateless) + GKE Autopilot (Stateful). See docs/bitemporal/context/system-infrastructure/define-cloud-infrastructure-strategy.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:48:15.863526-06:00","updated_at":"2025-12-06T22:11:27.315546-06:00","closed_at":"2025-12-06T22:11:27.31555-06:00","labels":["architecture","gcp","infrastructure"],"dependencies":[{"issue_id":"the-system-455.2","depends_on_id":"the-system-455","type":"parent-child","created_at":"2025-12-06T21:48:15.863919-06:00","created_by":"daemon"}]}
{"id":"the-system-455.3","title":"Create Ingestion Service Dockerfile","description":"Multi-stage Dockerfile for Ingestion Service (Bun). See docs/bitemporal/context/system-infrastructure/create-ingestion-service-dockerfile.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:48:15.908008-06:00","updated_at":"2025-12-06T22:10:59.101307-06:00","closed_at":"2025-12-06T22:10:59.10131-06:00","labels":["docker","infrastructure","ingestion"],"dependencies":[{"issue_id":"the-system-455.3","depends_on_id":"the-system-455","type":"parent-child","created_at":"2025-12-06T21:48:15.908412-06:00","created_by":"daemon"}]}
{"id":"the-system-455.4","title":"Create Memory Service Dockerfile","description":"Multi-stage Dockerfile for Memory Service (Bun/Node). See docs/bitemporal/context/system-infrastructure/create-memory-service-dockerfile.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:48:15.951797-06:00","updated_at":"2025-12-06T22:10:59.130229-06:00","closed_at":"2025-12-06T22:10:59.130231-06:00","labels":["docker","infrastructure","memory"],"dependencies":[{"issue_id":"the-system-455.4","depends_on_id":"the-system-455","type":"parent-child","created_at":"2025-12-06T21:48:15.952181-06:00","created_by":"daemon"}]}
{"id":"the-system-455.5","title":"Create Search Service Dockerfile","description":"Multi-stage Dockerfile for Search Service. See docs/bitemporal/context/system-infrastructure/create-search-service-dockerfile.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:48:15.9968-06:00","updated_at":"2025-12-06T22:10:59.160841-06:00","closed_at":"2025-12-06T22:10:59.160843-06:00","labels":["docker","infrastructure","search"],"dependencies":[{"issue_id":"the-system-455.5","depends_on_id":"the-system-455","type":"parent-child","created_at":"2025-12-06T21:48:15.997201-06:00","created_by":"daemon"}]}
{"id":"the-system-455.6","title":"Create Execution Service Dockerfile","description":"Multi-stage Dockerfile for Execution Service (Wasm). See docs/bitemporal/context/system-infrastructure/create-execution-service-dockerfile.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:48:16.039854-06:00","updated_at":"2025-12-06T22:10:59.189711-06:00","closed_at":"2025-12-06T22:10:59.189713-06:00","labels":["docker","execution","infrastructure"],"dependencies":[{"issue_id":"the-system-455.6","depends_on_id":"the-system-455","type":"parent-child","created_at":"2025-12-06T21:48:16.040344-06:00","created_by":"daemon"}]}
{"id":"the-system-455.7","title":"Configure Redpanda Deployment","description":"docker-compose and Helm charts for Redpanda. See docs/bitemporal/context/system-infrastructure/configure-redpanda-deployment.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:48:16.082757-06:00","updated_at":"2025-12-06T22:10:11.214638-06:00","closed_at":"2025-12-06T22:10:11.214642-06:00","labels":["deployment","infrastructure","redpanda"],"dependencies":[{"issue_id":"the-system-455.7","depends_on_id":"the-system-455","type":"parent-child","created_at":"2025-12-06T21:48:16.083154-06:00","created_by":"daemon"}]}
{"id":"the-system-455.8","title":"Configure FalkorDB Deployment","description":"docker-compose and Kubernetes manifest for FalkorDB. See docs/bitemporal/context/system-infrastructure/configure-falkordb-deployment.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:48:16.124943-06:00","updated_at":"2025-12-06T22:10:11.247383-06:00","closed_at":"2025-12-06T22:10:11.247386-06:00","labels":["deployment","falkordb","infrastructure"],"dependencies":[{"issue_id":"the-system-455.8","depends_on_id":"the-system-455","type":"parent-child","created_at":"2025-12-06T21:48:16.125294-06:00","created_by":"daemon"}]}
{"id":"the-system-455.9","title":"Configure Qdrant Deployment","description":"docker-compose and Helm charts for Qdrant. See docs/bitemporal/context/system-infrastructure/configure-qdrant-deployment.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:48:16.166807-06:00","updated_at":"2025-12-06T22:10:11.275534-06:00","closed_at":"2025-12-06T22:10:11.275536-06:00","labels":["deployment","infrastructure","qdrant"],"dependencies":[{"issue_id":"the-system-455.9","depends_on_id":"the-system-455","type":"parent-child","created_at":"2025-12-06T21:48:16.167296-06:00","created_by":"daemon"}]}
{"id":"the-system-4au","title":"Implement SPLADE pooling algorithm","description":"Implement spladePooling function: max pooling over sequence + ReLU + log(1+x) scaling. Output sparse vector with indices and values arrays. Handle 30,522-dim BERT vocabulary.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T19:25:04.937404-06:00","updated_at":"2025-12-08T19:37:27.307598-06:00","closed_at":"2025-12-08T19:37:27.307598-06:00","dependencies":[{"issue_id":"the-system-4au","depends_on_id":"the-system-5nj","type":"blocks","created_at":"2025-12-08T19:25:16.328248-06:00","created_by":"daemon"}]}
{"id":"the-system-4sy","title":"Bounded Context: Agent Control","description":"The 'Frontal Cortex'. Mastra agents, workflows, and decision loops. See docs/bitemporal/context/agent-control/","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:47:42.521911-06:00","updated_at":"2025-12-06T22:33:15.178178-06:00","closed_at":"2025-12-06T22:33:15.17818-06:00","labels":["context","control","mastra"]}
{"id":"the-system-4sy.1","title":"Initialize Mastra Framework Project","description":"Setup apps/control with Mastra core and Vercel AI SDK. See docs/bitemporal/context/agent-control/initialize-mastra-framework-project.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:55:04.82216-06:00","updated_at":"2025-12-06T22:32:10.311593-06:00","closed_at":"2025-12-06T22:32:10.311596-06:00","labels":["control","mastra","setup"],"dependencies":[{"issue_id":"the-system-4sy.1","depends_on_id":"the-system-4sy","type":"parent-child","created_at":"2025-12-06T21:55:04.822514-06:00","created_by":"daemon"}]}
{"id":"the-system-4sy.10","title":"Implement Tool Selection Strategy","description":"Static vs Dynamic tool injection logic. See docs/bitemporal/context/agent-control/implement-tool-selection-strategy.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T21:55:05.205829-06:00","updated_at":"2025-12-06T23:10:23.431231-06:00","closed_at":"2025-12-06T23:10:23.431234-06:00","labels":["control","optimization","tools"],"dependencies":[{"issue_id":"the-system-4sy.10","depends_on_id":"the-system-4sy","type":"parent-child","created_at":"2025-12-06T21:55:05.206288-06:00","created_by":"daemon"}]}
{"id":"the-system-4sy.11","title":"Develop Agent Heartbeat Monitor","description":"Watchdog for stuck agent states. See docs/bitemporal/context/agent-control/develop-agent-heartbeat-monitor.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T21:55:05.249694-06:00","updated_at":"2025-12-06T23:21:48.867977-06:00","closed_at":"2025-12-06T23:21:48.867979-06:00","labels":["control","monitor","resilience"],"dependencies":[{"issue_id":"the-system-4sy.11","depends_on_id":"the-system-4sy","type":"parent-child","created_at":"2025-12-06T21:55:05.250052-06:00","created_by":"daemon"}]}
{"id":"the-system-4sy.12","title":"Define Fallback Behavior Logic","description":"Error recovery for hallucinations or bad JSON. See docs/bitemporal/context/agent-control/define-fallback-behavior-logic.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T21:55:05.289559-06:00","updated_at":"2025-12-07T01:00:13.218045-06:00","closed_at":"2025-12-07T01:00:13.218045-06:00","labels":["control","error-handling"],"dependencies":[{"issue_id":"the-system-4sy.12","depends_on_id":"the-system-4sy","type":"parent-child","created_at":"2025-12-06T21:55:05.289947-06:00","created_by":"daemon"}]}
{"id":"the-system-4sy.2","title":"Define Agent Persona Configuration","description":"The Soul persona definition and core system prompt. See docs/bitemporal/context/agent-control/define-agent-persona-configuration.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:55:04.863714-06:00","updated_at":"2025-12-06T22:32:10.341548-06:00","closed_at":"2025-12-06T22:32:10.34155-06:00","labels":["control","persona","prompt"],"dependencies":[{"issue_id":"the-system-4sy.2","depends_on_id":"the-system-4sy","type":"parent-child","created_at":"2025-12-06T21:55:04.864076-06:00","created_by":"daemon"}]}
{"id":"the-system-4sy.3","title":"Implement Mastra Workflow Definitions","description":"The Think-Act-Observe loop workflow in Mastra. See docs/bitemporal/context/agent-control/implement-mastra-workflow-definitions.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:55:04.906247-06:00","updated_at":"2025-12-06T22:32:10.369882-06:00","closed_at":"2025-12-06T22:32:10.369884-06:00","labels":["control","logic","workflow"],"dependencies":[{"issue_id":"the-system-4sy.3","depends_on_id":"the-system-4sy","type":"parent-child","created_at":"2025-12-06T21:55:04.906621-06:00","created_by":"daemon"}]}
{"id":"the-system-4sy.4","title":"Create Agent State Machine","description":"XState machine for agent lifecycle status (IDLE, ACTING). See docs/bitemporal/context/agent-control/create-agent-state-machine.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:55:04.948837-06:00","updated_at":"2025-12-06T23:09:19.610523-06:00","closed_at":"2025-12-06T23:09:19.610526-06:00","labels":["control","state","xstate"],"dependencies":[{"issue_id":"the-system-4sy.4","depends_on_id":"the-system-4sy","type":"parent-child","created_at":"2025-12-06T21:55:04.949233-06:00","created_by":"daemon"}]}
{"id":"the-system-4sy.5","title":"Implement Graphiti MCP Client Integration","description":"Bridge Memory MCP tools to Mastra agent. See docs/bitemporal/context/agent-control/implement-graphiti-mcp-client-integration.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:55:04.995243-06:00","updated_at":"2025-12-06T23:15:26.591915-06:00","closed_at":"2025-12-06T23:15:26.591919-06:00","labels":["control","integration","mcp"],"dependencies":[{"issue_id":"the-system-4sy.5","depends_on_id":"the-system-4sy","type":"parent-child","created_at":"2025-12-06T21:55:04.995629-06:00","created_by":"daemon"}]}
{"id":"the-system-4sy.6","title":"Implement Wassette MCP Client Integration","description":"Bridge Execution MCP tools to Mastra agent. See docs/bitemporal/context/agent-control/implement-wassette-mcp-client-integration.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:55:05.037032-06:00","updated_at":"2025-12-06T23:15:26.622311-06:00","closed_at":"2025-12-06T23:15:26.622314-06:00","labels":["control","integration","mcp"],"dependencies":[{"issue_id":"the-system-4sy.6","depends_on_id":"the-system-4sy","type":"parent-child","created_at":"2025-12-06T21:55:05.037369-06:00","created_by":"daemon"}]}
{"id":"the-system-4sy.7","title":"Define Decision Loop Logic","description":"Logic to route LLM output (tool_call vs thought vs content). See docs/bitemporal/context/agent-control/define-decision-loop-logic.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:55:05.07853-06:00","updated_at":"2025-12-06T23:38:26.430145-06:00","closed_at":"2025-12-06T23:38:26.430149-06:00","labels":["control","logic","routing"],"dependencies":[{"issue_id":"the-system-4sy.7","depends_on_id":"the-system-4sy","type":"parent-child","created_at":"2025-12-06T21:55:05.078882-06:00","created_by":"daemon"}]}
{"id":"the-system-4sy.8","title":"Implement Context Window Manager","description":"Strategy to assemble prompts within token limits. See docs/bitemporal/context/agent-control/implement-context-window-manager.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:55:05.120761-06:00","updated_at":"2025-12-06T23:10:01.451043-06:00","closed_at":"2025-12-06T23:10:01.451046-06:00","labels":["context","control","tokens"],"dependencies":[{"issue_id":"the-system-4sy.8","depends_on_id":"the-system-4sy","type":"parent-child","created_at":"2025-12-06T21:55:05.12118-06:00","created_by":"daemon"}]}
{"id":"the-system-4sy.9","title":"Create Agent Session Initializer","description":"Bootstrap new sessions in Memory and Redpanda. See docs/bitemporal/context/agent-control/create-agent-session-initializer.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:55:05.16388-06:00","updated_at":"2025-12-07T00:25:23.07323-06:00","closed_at":"2025-12-07T00:25:23.07323-06:00","labels":["control","init","session"],"dependencies":[{"issue_id":"the-system-4sy.9","depends_on_id":"the-system-4sy","type":"parent-child","created_at":"2025-12-06T21:55:05.16433-06:00","created_by":"daemon"}]}
{"id":"the-system-52s2","title":"LOW: Path traversal not handled in VirtualFileSystem","description":"Location: packages/vfs/src/vfs.ts:97-99\n\nThe splitPath method does not handle '..' path components. A path like '/foo/../bar' creates '..' as a literal directory name instead of resolving to '/bar'.\n\nFix: Normalize paths to resolve '..' segments.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:58:50.975105-06:00","updated_at":"2025-12-09T16:58:50.975105-06:00"}
{"id":"the-system-5jl","title":"Write unit tests for RerankerRouter","description":"Test query classification, tier selection, routing heuristics. File: packages/search-core/src/services/__tests__/reranker-router.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T23:01:44.090351-06:00","updated_at":"2025-12-08T23:42:40.800687-06:00","closed_at":"2025-12-08T23:42:40.800687-06:00"}
{"id":"the-system-5ll","title":"Install Wassette Binary","description":"the-system-1p4","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T00:36:28.913252-06:00","updated_at":"2025-12-07T00:38:05.086774-06:00","closed_at":"2025-12-07T00:38:05.086774-06:00"}
{"id":"the-system-5nj","title":"Create SpladeEmbedder class with ONNX model loading","description":"Implement SpladeEmbedder class in packages/search-core/src/services/splade-embedder.ts. Load sparse-encoder-testing/splade-bert-tiny-nq-onnx model via onnxruntime-node. Include model caching and lazy initialization.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T19:24:50.584545-06:00","updated_at":"2025-12-08T19:32:22.691119-06:00","closed_at":"2025-12-08T19:32:22.691119-06:00"}
{"id":"the-system-5o4","title":"[EPIC] Phase 3: Architecture Improvements","description":"# Phase 3: Architecture Improvements\n\n**Duration**: 5-7 days\n**Dependencies**: Phase 2 complete\n**Parallelization**: Tasks 3.1, 3.2 parallel; 3.3 depends on 3.1; 3.4 independent\n\n## Overview\nImprove architectural patterns across the codebase:\n- Repository pattern for data access\n- Strategy pattern for event handlers\n- Dependency injection throughout\n- File system abstraction for testing\n\n## Issue Summary\n- SOLID violations: 34\n- Missing abstractions: 8+\n- Testability blockers: 5+\n\n## Success Criteria\n- [ ] Repository interfaces defined and implemented\n- [ ] Event handlers use strategy pattern\n- [ ] All apps support dependency injection\n- [ ] IFileSystem interface enables mocking\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 442-534)\n- docs/refactor/packages/memory-core/REPORT.md\n- docs/refactor/apps/memory/REPORT.md\n- docs/refactor/packages/vfs/REPORT.md","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-09T03:35:33.147796-06:00","updated_at":"2025-12-09T04:28:54.899457-06:00","closed_at":"2025-12-09T04:28:54.899457-06:00","labels":["architecture","p0","refactoring"],"dependencies":[{"issue_id":"the-system-5o4","depends_on_id":"the-system-97r","type":"blocks","created_at":"2025-12-09T03:38:41.131587-06:00","created_by":"daemon"}]}
{"id":"the-system-5o4.1","title":"[3.1] Implement Repository Pattern (memory-core)","description":"# Task 3.1: Implement Repository Pattern\n\n**Effort**: 12 hours\n**Dependencies**: Tasks 0.2 (interfaces), 0.3 (types)\n**Parallel**: Can run with 3.2, 3.4\n\n## Location\n`packages/memory-core/src/repositories/`\n\n## Interfaces to Create\n```typescript\n// session.repository.ts\nexport interface SessionRepository {\n  findById(id: string): Promise\u003cSession | null\u003e;\n  findByExternalId(externalId: string): Promise\u003cSession | null\u003e;\n  findActive(): Promise\u003cSession[]\u003e;\n  create(session: CreateSessionInput): Promise\u003cSession\u003e;\n  update(id: string, updates: UpdateSessionInput): Promise\u003cSession\u003e;\n  delete(id: string): Promise\u003cvoid\u003e;\n}\n\n// turn.repository.ts\nexport interface TurnRepository {\n  findById(id: string): Promise\u003cTurn | null\u003e;\n  findBySession(sessionId: string): Promise\u003cTurn[]\u003e;\n  findByTimeRange(sessionId: string, start: Date, end: Date): Promise\u003cTurn[]\u003e;\n  create(turn: CreateTurnInput): Promise\u003cTurn\u003e;\n  update(id: string, updates: UpdateTurnInput): Promise\u003cTurn\u003e;\n}\n\n// reasoning.repository.ts\nexport interface ReasoningRepository {\n  findByTurn(turnId: string): Promise\u003cReasoning[]\u003e;\n  create(reasoning: CreateReasoningInput): Promise\u003cReasoning\u003e;\n}\n\n// tool-call.repository.ts\nexport interface ToolCallRepository {\n  findByTurn(turnId: string): Promise\u003cToolCall[]\u003e;\n  create(toolCall: CreateToolCallInput): Promise\u003cToolCall\u003e;\n  updateResult(id: string, result: ToolResult): Promise\u003cToolCall\u003e;\n}\n```\n\n## Implementations\n- FalkorSessionRepository\n- FalkorTurnRepository\n- FalkorReasoningRepository\n- FalkorToolCallRepository\n\n## Usage Changes\n- `apps/control/src/session/initializer.ts` ‚Üí Use `SessionRepository`\n- `apps/control/src/context/assembler.ts` ‚Üí Use repositories\n- `apps/memory/src/index.ts` ‚Üí Use `SessionRepository`\n- `apps/memory/src/turn-aggregator.ts` ‚Üí Use repositories\n\n## Acceptance Criteria\n- [ ] All 4 repository interfaces defined\n- [ ] FalkorDB implementations created\n- [ ] Apps updated to use repositories\n- [ ] Unit tests for repositories\n- [ ] Integration tests pass\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 448-469)\n- docs/refactor/packages/memory-core/REPORT.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T03:36:06.074919-06:00","updated_at":"2025-12-09T04:20:13.364645-06:00","closed_at":"2025-12-09T04:20:13.364645-06:00","labels":["architecture","parallel-ok","refactoring","repository-pattern"],"dependencies":[{"issue_id":"the-system-5o4.1","depends_on_id":"the-system-5o4","type":"parent-child","created_at":"2025-12-09T03:36:06.075901-06:00","created_by":"daemon"},{"issue_id":"the-system-5o4.1","depends_on_id":"the-system-wai.2","type":"blocks","created_at":"2025-12-09T03:38:59.661222-06:00","created_by":"daemon"},{"issue_id":"the-system-5o4.1","depends_on_id":"the-system-wai.3","type":"blocks","created_at":"2025-12-09T03:38:59.693718-06:00","created_by":"daemon"}]}
{"id":"the-system-5o4.2","title":"[3.2] Extract Event Handler Strategy (memory app)","description":"# Task 3.2: Extract Event Handler Strategy (memory app)\n\n**Effort**: 6 hours\n**Dependencies**: None (after Phase 2)\n**Parallel**: Can run with 3.1, 3.4\n\n## Location\n`apps/memory/src/handlers/`\n\n## Current Problem\n120-line switch statement in `TurnAggregator.processEvent()`\n\n## Handlers to Create\n```typescript\n// handler.interface.ts\nexport interface EventHandler {\n  eventType: string;\n  handle(event: IngestionEvent, context: HandlerContext): Promise\u003cvoid\u003e;\n}\n\n// content.handler.ts\nexport class ContentEventHandler implements EventHandler {\n  eventType = 'content';\n  async handle(event: ContentEvent, context: HandlerContext): Promise\u003cvoid\u003e {\n    // Handle content events\n  }\n}\n\n// thought.handler.ts\nexport class ThoughtEventHandler implements EventHandler {\n  eventType = 'thought';\n  async handle(event: ThoughtEvent, context: HandlerContext): Promise\u003cvoid\u003e {\n    // Handle thought events\n  }\n}\n\n// tool-call.handler.ts\nexport class ToolCallEventHandler implements EventHandler {\n  eventType = 'tool_call';\n  async handle(event: ToolCallEvent, context: HandlerContext): Promise\u003cvoid\u003e {\n    // Handle tool call events\n  }\n}\n\n// Additional handlers:\n// - DiffEventHandler\n// - UsageEventHandler\n// - ControlEventHandler\n```\n\n## Handler Registry\n```typescript\nexport class EventHandlerRegistry {\n  private handlers = new Map\u003cstring, EventHandler\u003e();\n  \n  register(handler: EventHandler): void {\n    this.handlers.set(handler.eventType, handler);\n  }\n  \n  getHandler(eventType: string): EventHandler | undefined {\n    return this.handlers.get(eventType);\n  }\n}\n```\n\n## Acceptance Criteria\n- [ ] EventHandler interface defined\n- [ ] All 6 handlers implemented\n- [ ] Handler registry created\n- [ ] TurnAggregator refactored\n- [ ] Unit tests for each handler\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 471-490)\n- docs/refactor/apps/memory/REPORT.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T03:36:07.488962-06:00","updated_at":"2025-12-09T04:20:14.656653-06:00","closed_at":"2025-12-09T04:20:14.656653-06:00","labels":["architecture","parallel-ok","refactoring","strategy-pattern"],"dependencies":[{"issue_id":"the-system-5o4.2","depends_on_id":"the-system-5o4","type":"parent-child","created_at":"2025-12-09T03:36:07.489766-06:00","created_by":"daemon"}]}
{"id":"the-system-5o4.3","title":"[3.3] Implement Dependency Injection Pattern","description":"# Task 3.3: Implement Dependency Injection Pattern\n\n**Effort**: 10 hours\n**Dependencies**: Task 3.1 (Repository Pattern)\n**NOT Parallel**: Must wait for 3.1\n\n## Pattern\nFactory functions with injectable dependencies\n\n## Apps to Update\n\n### apps/control\n```typescript\n// Before\nconst assembler = new ContextAssembler(falkorClient);\n\n// After\nexport function createContextAssembler(deps: {\n  sessionRepo: SessionRepository;\n  turnRepo: TurnRepository;\n  searchRetriever?: SearchRetriever;\n}): ContextAssembler {\n  return new ContextAssembler(deps);\n}\n```\n\nComponents:\n- DecisionEngine\n- ContextAssembler\n- SessionManager\n\n### apps/memory\nComponents:\n- TurnAggregator\n- index.ts bootstrap\n\n### apps/execution\nComponents:\n- Rehydrator\n- TimeTravelService\n\n### apps/search\nComponents:\n- SearchService\n\n### apps/ingestion\nComponents:\n- IngestionProcessor\n\n## Factory Pattern\n```typescript\n// factory.ts\nexport interface AppDependencies {\n  graphClient: GraphClient;\n  messageClient: MessageClient;\n  blobStore: BlobStore;\n  logger: Logger;\n}\n\nexport function createApp(deps: AppDependencies): App {\n  const sessionRepo = new FalkorSessionRepository(deps.graphClient);\n  const turnRepo = new FalkorTurnRepository(deps.graphClient);\n  // ...\n}\n```\n\n## Acceptance Criteria\n- [ ] All apps have factory functions\n- [ ] Dependencies injectable\n- [ ] Easy to mock for tests\n- [ ] No global singletons\n- [ ] Integration tests pass\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 492-510)\n- docs/refactor/apps/control/REPORT.md\n- docs/refactor/apps/memory/REPORT.md\n- docs/refactor/apps/execution/REPORT.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T03:36:09.858694-06:00","updated_at":"2025-12-09T04:28:53.279073-06:00","closed_at":"2025-12-09T04:28:53.279073-06:00","labels":["architecture","dependency-injection","refactoring"],"dependencies":[{"issue_id":"the-system-5o4.3","depends_on_id":"the-system-5o4","type":"parent-child","created_at":"2025-12-09T03:36:09.85938-06:00","created_by":"daemon"},{"issue_id":"the-system-5o4.3","depends_on_id":"the-system-5o4.1","type":"blocks","created_at":"2025-12-09T03:38:59.726132-06:00","created_by":"daemon"}]}
{"id":"the-system-5o4.4","title":"[3.4] Add IFileSystem Interface (vfs)","description":"# Task 3.4: Add IFileSystem Interface (vfs)\n\n**Effort**: 2 hours\n**Dependencies**: None (after Phase 2)\n**Parallel**: Can run with 3.1, 3.2\n\n## Location\n`packages/vfs/src/interfaces.ts`\n\n## Interface Design\n```typescript\nexport interface IFileSystem {\n  exists(path: string): boolean;\n  mkdir(path: string): void;\n  writeFile(path: string, content: string): void;\n  readFile(path: string): string;\n  readDir(path: string): string[];\n  stat(path: string): FileStat;\n  unlink(path: string): void;\n}\n\nexport interface FileStat {\n  isFile(): boolean;\n  isDirectory(): boolean;\n  size: number;\n  mtime: Date;\n}\n\n// Node.js implementation\nexport class NodeFileSystem implements IFileSystem {\n  exists(path: string): boolean {\n    return fs.existsSync(path);\n  }\n  // ...\n}\n\n// In-memory implementation for testing\nexport class InMemoryFileSystem implements IFileSystem {\n  private files = new Map\u003cstring, string\u003e();\n  // ...\n}\n```\n\n## Components to Update\n- PatchManager (uses fs directly)\n- Any other vfs components using fs\n\n## Acceptance Criteria\n- [ ] IFileSystem interface defined\n- [ ] NodeFileSystem implementation\n- [ ] InMemoryFileSystem for tests\n- [ ] PatchManager updated\n- [ ] Unit tests using InMemoryFileSystem\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 512-533)\n- docs/refactor/packages/vfs/REPORT.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T03:36:11.451735-06:00","updated_at":"2025-12-09T04:20:16.1617-06:00","closed_at":"2025-12-09T04:20:16.1617-06:00","labels":["architecture","interfaces","parallel-ok","refactoring","vfs"],"dependencies":[{"issue_id":"the-system-5o4.4","depends_on_id":"the-system-5o4","type":"parent-child","created_at":"2025-12-09T03:36:11.452504-06:00","created_by":"daemon"}]}
{"id":"the-system-5rh","title":"Write integration tests for reranker pipeline","description":"End-to-end tests: index documents, search with/without rerank, verify relevance improvement. File: packages/search-core/src/services/__tests__/reranker.integration.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T23:01:46.473247-06:00","updated_at":"2025-12-08T23:59:17.47617-06:00","closed_at":"2025-12-08T23:59:17.47617-06:00"}
{"id":"the-system-5s0","title":"MEDIUM: Non-atomic read-modify-write in session update","description":"Location: packages/memory-core/src/repositories/falkor-session.repository.ts:119-182\n\nThe update method performs a read-modify-write cycle without atomic guarantees. Two concurrent updates could cause lost updates or orphaned versions.\n\nImpact: Data integrity issues under concurrent access.\n\nFix: Implement optimistic locking with version numbers or use database transactions.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:57:33.026126-06:00","updated_at":"2025-12-09T16:57:33.026126-06:00"}
{"id":"the-system-622","title":"Add Test Coverage: packages/logger","description":"Add comprehensive unit and integration tests for packages/logger","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T01:51:16.572667-06:00","updated_at":"2025-12-07T01:59:17.196109-06:00","closed_at":"2025-12-07T01:59:17.19611-06:00","labels":["logger","packages","testing"]}
{"id":"the-system-62op","title":"LOW: JSON.stringify comparison unreliable for object equality","description":"Location: packages/execution-core/src/replay.ts:199-209\n\nUsing JSON.stringify for deep equality comparison is unreliable. Object key order matters, undefined values are stripped, circular references throw.\n\nFix: Use deep-equal library or structured comparison.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:59:14.707291-06:00","updated_at":"2025-12-09T16:59:14.707291-06:00"}
{"id":"the-system-63j","title":"Implement sparse-only search in SearchRetriever","description":"Implement the sparse search path in SearchRetriever.search() that currently returns an empty array.\n\nReference: docs/plans/hybrid-retriever.md (Phase 1)\n\nChanges to packages/search-core/src/services/retriever.ts:\n- Add call to textEmbedder.embedSparseQuery(text) to generate SPLADE sparse vector\n- Use client.query() with sparse vector format: { indices, values }\n- Set using: \"sparse\" to target the sparse named vector field\n- Apply filter and score_threshold (default 0.1 for sparse)\n- Return results.points to match dense search return format\n\nThe sparse search is triggered when:\n- User explicitly sets strategy: \"sparse\"\n- QueryClassifier detects quoted strings (exact match intent)\n\nSparse search works for both text and code content since SPLADE is content-agnostic.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T21:37:49.339784-06:00","updated_at":"2025-12-08T21:46:15.838917-06:00","closed_at":"2025-12-08T21:46:15.838917-06:00"}
{"id":"the-system-63yl","title":"LOW: isUserError always returns true","description":"Location: packages/execution-core/src/errors.ts:9-12\n\nThe isUserError function is a stub that always returns true. All errors are incorrectly classified as user errors.\n\nFix: Implement proper error classification logic.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:58:53.703759-06:00","updated_at":"2025-12-09T16:58:53.703759-06:00"}
{"id":"the-system-6bo","title":"Implement hybrid search with RRF fusion in SearchRetriever","description":"Implement true hybrid search in SearchRetriever.search() using Qdrant's prefetch + RRF fusion API.\n\nReference: docs/plans/hybrid-retriever.md (Phase 2)\n\nChanges to packages/search-core/src/services/retriever.ts:\n- Generate both dense and sparse query vectors in parallel using Promise.all\n- Use client.query() with prefetch array containing:\n  - Dense vector prefetch: { query: denseVector, using: vectorName, limit: limit * 2 }\n  - Sparse vector prefetch: { query: { indices, values }, using: \"sparse\", limit: limit * 2 }\n- Set query: { fusion: \"rrf\" } for Reciprocal Rank Fusion\n- Oversample in prefetch (2x limit) to give RRF more candidates to fuse\n- Apply filter if provided\n- No score_threshold with RRF (scores are rank-based)\n- Return results.points\n\nThe hybrid search is the default strategy for most natural language queries.\nQueryClassifier returns alpha weight (0.0-1.0) which could be used for weighted fusion in future.\n\nDepends on: the-system-63j (sparse search implementation provides the pattern)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T21:38:01.042392-06:00","updated_at":"2025-12-08T21:47:09.802851-06:00","closed_at":"2025-12-08T21:47:09.802851-06:00","dependencies":[{"issue_id":"the-system-6bo","depends_on_id":"the-system-63j","type":"blocks","created_at":"2025-12-08T21:38:08.75772-06:00","created_by":"daemon"}]}
{"id":"the-system-6hk","title":"MEDIUM: Browser logger event listeners never removed","description":"Location: packages/logger/src/browser.ts:117-126\n\nEvery call to createBrowserLogger() adds new event listeners that are never removed. The flush timer is also never cleared.\n\nImpact: Memory leak in long-running browser applications.\n\nFix: Add destroy() method to remove event listeners and clear timer.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:57:04.226701-06:00","updated_at":"2025-12-09T16:57:04.226701-06:00"}
{"id":"the-system-6kd","title":"MEDIUM: Session extractors never cleaned up - memory leak","description":"Location: apps/ingestion/src/index.ts:28-29\n\nThe thinkingExtractors and diffExtractors Maps store per-session extractors but are never cleaned up. As new sessions are processed, these Maps grow indefinitely.\n\nImpact: Over time, the service will consume increasing memory until it crashes or is OOM-killed.\n\nFix: Implement session lifecycle management to remove extractors when sessions end.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:56:58.512594-06:00","updated_at":"2025-12-09T16:56:58.512594-06:00"}
{"id":"the-system-6lwv","title":"LOW: Unhandled WebSocket unsubscribe errors","description":"Location: apps/interface/lib/websocket-server.ts:53-56, 99-102\n\nThe ws.on('close') handler calls unsubscribe() without error handling. If unsubscribe fails, it becomes an unhandled promise rejection.\n\nFix: Add .catch() handler to unsubscribe call.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:59:23.157877-06:00","updated_at":"2025-12-09T16:59:23.157877-06:00"}
{"id":"the-system-6uvd","title":"LOW: hashObject crashes on non-object input","description":"Location: packages/common/src/utils/hash.ts:64\n\nThe hashObject function crashes when passed null, arrays, or primitive values. Object.keys(null) throws TypeError.\n\nFix: Add type check before calling Object.keys.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:58:46.245164-06:00","updated_at":"2025-12-09T16:58:46.245164-06:00"}
{"id":"the-system-70a","title":"Add project context properties to SessionNode","description":"Add working_dir, git_remote, agent_type to SessionNode for project-level filtering","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T03:13:55.589464-06:00","updated_at":"2025-12-08T03:18:11.081148-06:00","closed_at":"2025-12-08T03:18:11.081148-06:00","dependencies":[{"issue_id":"the-system-70a","depends_on_id":"the-system-3sh","type":"blocks","created_at":"2025-12-08T03:14:04.554328-06:00","created_by":"daemon"}]}
{"id":"the-system-7bq","title":"[EPIC] Phase 5: Frontend \u0026 Polish","description":"# Phase 5: Frontend \u0026 Polish\n\n**Duration**: 4-5 days\n**Dependencies**: Phase 4 complete\n**Parallelization**: Tasks 5.1-5.2 parallel; 5.3 depends on 5.1/5.2; 5.4 independent\n\n## Overview\nClean up frontend code and remove technical debt:\n- Split god components\n- Extract shared UI components\n- Remove dead code and unused dependencies\n\n## Issue Summary\n- God components: 2 (1580 LOC, 1171 LOC)\n- Dead code files: 2+\n- Unused dependencies: 4+\n- Max file length target: \u003c400 LOC\n\n## Success Criteria\n- [ ] SessionReplay.tsx split into \u003c200 LOC files\n- [ ] LineageGraph.tsx split into \u003c200 LOC files\n- [ ] Shared UI components extracted\n- [ ] Dead code removed\n- [ ] Unused deps removed\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 573-675)\n- docs/refactor/apps/interface/REPORT.md","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-09T03:37:37.783851-06:00","updated_at":"2025-12-09T04:47:36.419903-06:00","closed_at":"2025-12-09T04:47:36.419903-06:00","labels":["frontend","p0","polish","refactoring"],"dependencies":[{"issue_id":"the-system-7bq","depends_on_id":"the-system-jzj","type":"blocks","created_at":"2025-12-09T03:38:41.191895-06:00","created_by":"daemon"}]}
{"id":"the-system-7bq.1","title":"[5.1] Split SessionReplay.tsx (1580 LOC)","description":"# Task 5.1: Split SessionReplay.tsx\n\n**Effort**: 8 hours\n**Current LOC**: 1580 lines\n**Target LOC**: ~200 per file\n**Parallel**: Can run with 5.2, 5.4\n\n## File Under Refactoring\n`apps/interface/app/components/SessionReplay.tsx`\n\n## Target Structure\n```\napp/components/SessionReplay/\n  index.tsx              # Main component (~200 LOC)\n  MessageCards/\n    ResponseCard.tsx     # AI response rendering\n    QueryCard.tsx        # User query rendering\n    ToolCallCard.tsx     # Tool invocations\n    ReasoningTrace.tsx   # Thinking/reasoning display\n    TurnHeader.tsx       # Turn metadata header\n  StatsHeader.tsx        # Session statistics\n  LoadingState.tsx       # Loading skeleton\n  EmptyState.tsx         # No data state\n  utils/\n    consolidateTimeline.ts  # Timeline logic\n    messageUtils.ts         # Message formatting\n```\n\n## Extraction Strategy\n1. Identify natural component boundaries\n2. Extract MessageCards first (most complex)\n3. Extract utility functions\n4. Create barrel exports\n5. Update imports in parent\n\n## Acceptance Criteria\n- [ ] Main file \u003c200 LOC\n- [ ] All subcomponents extracted\n- [ ] Utils extracted\n- [ ] No functionality lost\n- [ ] All tests pass\n- [ ] Visual regression verified\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 579-604)\n- docs/refactor/apps/interface/REPORT.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T03:38:09.659879-06:00","updated_at":"2025-12-09T04:47:32.658098-06:00","closed_at":"2025-12-09T04:47:32.658098-06:00","labels":["component-split","frontend","parallel-ok","refactoring"],"dependencies":[{"issue_id":"the-system-7bq.1","depends_on_id":"the-system-7bq","type":"parent-child","created_at":"2025-12-09T03:38:09.661054-06:00","created_by":"daemon"}]}
{"id":"the-system-7bq.2","title":"[5.2] Split LineageGraph.tsx (1171 LOC)","description":"# Task 5.2: Split LineageGraph.tsx\n\n**Effort**: 6 hours\n**Current LOC**: 1171 lines\n**Target LOC**: ~200 per file\n**Parallel**: Can run with 5.1, 5.4\n\n## File Under Refactoring\n`apps/interface/app/components/LineageGraph.tsx`\n\n## Target Structure\n```\napp/components/LineageGraph/\n  index.tsx              # Main component (~200 LOC)\n  NeuralNode.tsx         # Node rendering\n  GraphStats.tsx         # Graph statistics\n  layouts/\n    radialLayout.ts      # Radial layout algorithm\n    gridLayout.ts        # Grid layout algorithm\n  config/\n    nodeTypeConfig.ts    # Node type configuration\n  EmptyState.tsx         # No data state\n  LoadingSkeleton.tsx    # Loading skeleton\n```\n\n## Extraction Strategy\n1. Extract layout algorithms (pure functions)\n2. Extract node configuration\n3. Extract NeuralNode component\n4. Extract state components\n5. Create barrel exports\n\n## Acceptance Criteria\n- [ ] Main file \u003c200 LOC\n- [ ] Layout algorithms extracted\n- [ ] Node rendering separated\n- [ ] No functionality lost\n- [ ] All tests pass\n- [ ] Visual regression verified\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 606-630)\n- docs/refactor/apps/interface/REPORT.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T03:38:10.700448-06:00","updated_at":"2025-12-09T04:47:33.495985-06:00","closed_at":"2025-12-09T04:47:33.495985-06:00","labels":["component-split","frontend","parallel-ok","refactoring"],"dependencies":[{"issue_id":"the-system-7bq.2","depends_on_id":"the-system-7bq","type":"parent-child","created_at":"2025-12-09T03:38:10.701223-06:00","created_by":"daemon"}]}
{"id":"the-system-7bq.3","title":"[5.3] Extract Shared UI Components","description":"# Task 5.3: Extract Shared UI Components\n\n**Effort**: 4 hours\n**Dependencies**: Tasks 5.1, 5.2 (extract from splits)\n**NOT Parallel**: Must wait for 5.1, 5.2\n\n## Location\n`apps/interface/app/components/shared/`\n\n## Components to Extract\n```\napp/components/shared/\n  EmptyState.tsx         # Reusable empty state\n  LoadingSkeleton.tsx    # Reusable loading skeleton\n  Particles.tsx          # Background particles effect\n  design-tokens.ts       # Shared design tokens\n  index.ts               # Barrel export\n```\n\n## EmptyState Component\n```typescript\ninterface EmptyStateProps {\n  icon?: React.ReactNode;\n  title: string;\n  description?: string;\n  action?: {\n    label: string;\n    onClick: () =\u003e void;\n  };\n}\n\nexport function EmptyState({ icon, title, description, action }: EmptyStateProps) {\n  // Reusable empty state\n}\n```\n\n## LoadingSkeleton Component\n```typescript\ninterface LoadingSkeletonProps {\n  variant: 'card' | 'list' | 'graph';\n  count?: number;\n}\n\nexport function LoadingSkeleton({ variant, count = 3 }: LoadingSkeletonProps) {\n  // Reusable loading skeleton\n}\n```\n\n## Acceptance Criteria\n- [ ] Shared components extracted\n- [ ] Design tokens consolidated\n- [ ] Components used in SessionReplay\n- [ ] Components used in LineageGraph\n- [ ] Consistent styling\n- [ ] Storybook stories (optional)\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 632-649)\n- docs/refactor/apps/interface/REPORT.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T03:38:12.06236-06:00","updated_at":"2025-12-09T04:47:34.673583-06:00","closed_at":"2025-12-09T04:47:34.673583-06:00","labels":["frontend","refactoring","ui-components"],"dependencies":[{"issue_id":"the-system-7bq.3","depends_on_id":"the-system-7bq","type":"parent-child","created_at":"2025-12-09T03:38:12.063844-06:00","created_by":"daemon"},{"issue_id":"the-system-7bq.3","depends_on_id":"the-system-7bq.1","type":"blocks","created_at":"2025-12-09T03:39:10.82268-06:00","created_by":"daemon"},{"issue_id":"the-system-7bq.3","depends_on_id":"the-system-7bq.2","type":"blocks","created_at":"2025-12-09T03:39:10.871092-06:00","created_by":"daemon"}]}
{"id":"the-system-7bq.4","title":"[5.4] Remove Dead Code \u0026 Unused Dependencies","description":"# Task 5.4: Remove Dead Code \u0026 Unused Dependencies\n\n**Effort**: 2 hours\n**Dependencies**: None (after Phase 4)\n**Parallel**: Can run with 5.1, 5.2\n\n## Dead Code to Remove\n\n| File | Dead Code | Action |\n|------|-----------|--------|\n| `apps/search/src/routes/health.ts` | Entire file unused | Integrate or remove |\n| `apps/memory/src/index.ts:176-216` | Legacy ThoughtNode | Remove (behind flag) |\n\n## Unused Dependencies to Remove\n\n| Package | Dependency | Action |\n|---------|------------|--------|\n| `packages/storage` | `kafkajs` | Remove (duplicate of @engram/events) |\n| `packages/ingestion-core` | `google-libphonenumber` | Remove |\n| `packages/memory-core` | `ulid`, `date-fns` | Remove (unused) |\n| `apps/control` | `@ai-sdk/openai` | Remove |\n\n## Process\n1. Run `npm run build` to verify baseline\n2. Remove dead code files\n3. Remove unused deps one by one\n4. Run `npm run build` after each removal\n5. Run tests to verify\n\n## Verification Commands\n```bash\n# Find unused exports\nnpx ts-unused-exports tsconfig.json\n\n# Find unused deps\nnpx depcheck\n\n# Verify build\nnpm run build \u0026\u0026 npm test\n```\n\n## Acceptance Criteria\n- [ ] Dead code removed\n- [ ] Unused deps removed\n- [ ] Build passes\n- [ ] Tests pass\n- [ ] No runtime errors\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 651-675)\n- All package.json files","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-09T03:38:14.40676-06:00","updated_at":"2025-12-09T04:47:35.368052-06:00","closed_at":"2025-12-09T04:47:35.368052-06:00","labels":["cleanup","dead-code","parallel-ok","refactoring"],"dependencies":[{"issue_id":"the-system-7bq.4","depends_on_id":"the-system-7bq","type":"parent-child","created_at":"2025-12-09T03:38:14.407441-06:00","created_by":"daemon"}]}
{"id":"the-system-7kh","title":"Implement query complexity classifier","description":"Implement query complexity classification for routing decisions.\n\nReference: docs/plans/reranker-implementation.md (Appendix B)\n\nClassification function:\n```typescript\nfunction classifyQueryComplexity(query: string): \"simple\" | \"moderate\" | \"complex\" {\n  const features = {\n    length: query.length,\n    words: query.split(/\\s+/).length,\n    hasQuotes: /\"[^\"]+\"/.test(query),\n    hasOperators: /AND|OR|NOT|\\+|-/.test(query),\n    hasCode: /[a-zA-Z]+\\.[a-zA-Z]+\\(|function\\s|class\\s|=\u003e/.test(query),\n    questionWords: /^(what|how|why|when|where|who|which)/i.test(query),\n  };\n  // Score-based classification\n}\n```\n\nUsed by RerankerRouter to select appropriate tier.\n\nLocation: packages/search-core/src/services/query-classifier.ts (extend existing)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:56:09.269894-06:00","updated_at":"2025-12-08T23:35:52.376248-06:00","closed_at":"2025-12-08T23:35:52.376248-06:00"}
{"id":"the-system-7l02","title":"Fix retriever.test.ts result count mismatch","description":"The retriever.test.ts expects 10 results but receives 60. The limit parameter in the retriever is not being properly applied or there's a multiplication issue when aggregating results from multiple sources (vector + graph).","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T18:24:25.985942-06:00","updated_at":"2025-12-09T18:24:25.985942-06:00"}
{"id":"the-system-7l1","title":"Bounded Context: Observability Interface","description":"The 'Mirror'. API layer, GraphQL lineage, and replay interface. See docs/bitemporal/context/observability-interface/","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T21:47:42.567017-06:00","updated_at":"2025-12-06T22:33:15.206383-06:00","closed_at":"2025-12-06T22:33:15.206385-06:00","labels":["context","interface","nextjs"]}
{"id":"the-system-7l1.1","title":"Define API Route Structure","description":"Next.js App Router setup for /api/ingest, /api/search, /api/graph. See docs/bitemporal/context/observability-interface/define-api-route-structure.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:55:31.104036-06:00","updated_at":"2025-12-06T22:32:35.392999-06:00","closed_at":"2025-12-06T22:32:35.393001-06:00","labels":["interface","nextjs","routing"],"dependencies":[{"issue_id":"the-system-7l1.1","depends_on_id":"the-system-7l1","type":"parent-child","created_at":"2025-12-06T21:55:31.104425-06:00","created_by":"daemon"}]}
{"id":"the-system-7l1.10","title":"Create API Request Validator","description":"Zod middleware for request body validation. See docs/bitemporal/context/observability-interface/create-api-request-validator.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:55:31.489571-06:00","updated_at":"2025-12-06T22:32:35.481194-06:00","closed_at":"2025-12-06T22:32:35.481197-06:00","labels":["interface","validation","zod"],"dependencies":[{"issue_id":"the-system-7l1.10","depends_on_id":"the-system-7l1","type":"parent-child","created_at":"2025-12-06T21:55:31.491-06:00","created_by":"daemon"}]}
{"id":"the-system-7l1.11","title":"Implement Response Serialization","description":"Consistent JSON envelope for API responses. See docs/bitemporal/context/observability-interface/implement-response-serialization.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:55:31.535004-06:00","updated_at":"2025-12-07T00:32:08.165391-06:00","closed_at":"2025-12-07T00:32:08.165391-06:00","labels":["api","interface","standards"],"dependencies":[{"issue_id":"the-system-7l1.11","depends_on_id":"the-system-7l1","type":"parent-child","created_at":"2025-12-06T21:55:31.535404-06:00","created_by":"daemon"}]}
{"id":"the-system-7l1.12","title":"Develop API Usage Telemetry","description":"Middleware logging for Cloud Logging. See docs/bitemporal/context/observability-interface/develop-api-usage-telemetry.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T21:55:31.578377-06:00","updated_at":"2025-12-07T01:03:39.24205-06:00","closed_at":"2025-12-07T01:03:39.24205-06:00","labels":["interface","logging","observability"],"dependencies":[{"issue_id":"the-system-7l1.12","depends_on_id":"the-system-7l1","type":"parent-child","created_at":"2025-12-06T21:55:31.578753-06:00","created_by":"daemon"}]}
{"id":"the-system-7l1.13","title":"Create Swagger OpenAPI Documentation","description":"Auto-generated API docs at /api/docs. See docs/bitemporal/context/observability-interface/create-swagger-openapi-documentation.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T21:55:31.620621-06:00","updated_at":"2025-12-06T23:55:07.690411-06:00","closed_at":"2025-12-06T23:55:07.690416-06:00","labels":["docs","interface","swagger"],"dependencies":[{"issue_id":"the-system-7l1.13","depends_on_id":"the-system-7l1","type":"parent-child","created_at":"2025-12-06T21:55:31.621056-06:00","created_by":"daemon"}]}
{"id":"the-system-7l1.2","title":"Create GraphQL Schema Definition","description":"Schema for Session/Thought/Fact graph traversal. See docs/bitemporal/context/observability-interface/create-graphql-schema-definition.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:55:31.147222-06:00","updated_at":"2025-12-06T23:24:18.9049-06:00","closed_at":"2025-12-06T23:24:18.904903-06:00","labels":["graphql","interface","schema"],"dependencies":[{"issue_id":"the-system-7l1.2","depends_on_id":"the-system-7l1","type":"parent-child","created_at":"2025-12-06T21:55:31.147603-06:00","created_by":"daemon"}]}
{"id":"the-system-7l1.3","title":"Implement REST API Scaffolding","description":"Standardized error handling and wrappers for NextResponse. See docs/bitemporal/context/observability-interface/implement-rest-api-scaffolding.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:55:31.189463-06:00","updated_at":"2025-12-06T22:32:35.421096-06:00","closed_at":"2025-12-06T22:32:35.421097-06:00","labels":["api","interface","utils"],"dependencies":[{"issue_id":"the-system-7l1.3","depends_on_id":"the-system-7l1","type":"parent-child","created_at":"2025-12-06T21:55:31.189884-06:00","created_by":"daemon"}]}
{"id":"the-system-7l1.4","title":"Develop Ingest Stream Endpoint","description":"POST /api/ingest webhook for raw event testing. See docs/bitemporal/context/observability-interface/develop-ingest-stream-endpoint.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T21:55:31.230885-06:00","updated_at":"2025-12-07T00:58:40.657795-06:00","closed_at":"2025-12-07T00:58:40.657795-06:00","labels":["endpoint","ingestion","interface"],"dependencies":[{"issue_id":"the-system-7l1.4","depends_on_id":"the-system-7l1","type":"parent-child","created_at":"2025-12-06T21:55:31.231326-06:00","created_by":"daemon"}]}
{"id":"the-system-7l1.5","title":"Develop Semantic Search Endpoint","description":"POST /api/search proxy to Qdrant/Search Service. See docs/bitemporal/context/observability-interface/develop-semantic-search-endpoint.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:55:31.273817-06:00","updated_at":"2025-12-06T23:26:13.049726-06:00","closed_at":"2025-12-06T23:26:13.049729-06:00","labels":["endpoint","interface","search"],"dependencies":[{"issue_id":"the-system-7l1.5","depends_on_id":"the-system-7l1","type":"parent-child","created_at":"2025-12-06T21:55:31.274271-06:00","created_by":"daemon"}]}
{"id":"the-system-7l1.6","title":"Develop Lineage Query Endpoint","description":"GET /api/lineage/:sessionId logic using FalkorDB traversals. See docs/bitemporal/context/observability-interface/develop-lineage-query-endpoint.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:55:31.315247-06:00","updated_at":"2025-12-06T23:27:47.079813-06:00","closed_at":"2025-12-06T23:27:47.079816-06:00","labels":["endpoint","graph","interface"],"dependencies":[{"issue_id":"the-system-7l1.6","depends_on_id":"the-system-7l1","type":"parent-child","created_at":"2025-12-06T21:55:31.315619-06:00","created_by":"daemon"}]}
{"id":"the-system-7l1.7","title":"Develop Session Replay Endpoint","description":"POST /api/replay triggers Deterministic Execution. See docs/bitemporal/context/observability-interface/develop-session-replay-endpoint.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T21:55:31.358518-06:00","updated_at":"2025-12-07T00:53:09.015891-06:00","closed_at":"2025-12-07T00:53:09.015891-06:00","labels":["endpoint","interface","replay"],"dependencies":[{"issue_id":"the-system-7l1.7","depends_on_id":"the-system-7l1","type":"parent-child","created_at":"2025-12-06T21:55:31.35897-06:00","created_by":"daemon"}]}
{"id":"the-system-7l1.8","title":"Implement Authentication Middleware","description":"Clerk integration for protecting /api routes. See docs/bitemporal/context/observability-interface/implement-authentication-middleware.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:55:31.401751-06:00","updated_at":"2025-12-06T22:32:35.450231-06:00","closed_at":"2025-12-06T22:32:35.450233-06:00","labels":["auth","clerk","interface"],"dependencies":[{"issue_id":"the-system-7l1.8","depends_on_id":"the-system-7l1","type":"parent-child","created_at":"2025-12-06T21:55:31.402188-06:00","created_by":"daemon"}]}
{"id":"the-system-7l1.9","title":"Implement RBAC Authorization Logic","description":"Role-based checks (Viewer vs Admin). See docs/bitemporal/context/observability-interface/implement-rbac-authorization-logic.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:55:31.446552-06:00","updated_at":"2025-12-07T00:45:59.19262-06:00","closed_at":"2025-12-07T00:45:59.19262-06:00","labels":["auth","interface","rbac"],"dependencies":[{"issue_id":"the-system-7l1.9","depends_on_id":"the-system-7l1","type":"parent-child","created_at":"2025-12-06T21:55:31.446957-06:00","created_by":"daemon"}]}
{"id":"the-system-7m0","title":"[EPIC] Risk Mitigation \u0026 Safety","description":"Lazy model loading, A/B testing framework, rate limiting for LLM tier (Section 12)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-08T23:01:28.827114-06:00","updated_at":"2025-12-09T00:14:00.213883-06:00","closed_at":"2025-12-09T00:14:00.213883-06:00","dependencies":[{"issue_id":"the-system-7m0","depends_on_id":"the-system-020","type":"blocks","created_at":"2025-12-08T23:03:07.507811-06:00","created_by":"daemon"}]}
{"id":"the-system-7xg","title":"Implement NEXT relationship chaining for thoughts","description":"The Memory service has a TODO comment for creating NEXT edges between sequential thoughts within sessions. This breaks thought lineage visualization. Need to update memory/src/index.ts to create NEXT edges when processing parsed events. Ref: define-thought-node-schema.md","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-08T02:05:40.437926-06:00","updated_at":"2025-12-08T02:15:29.998911-06:00","closed_at":"2025-12-08T02:15:29.998911-06:00"}
{"id":"the-system-7xi","title":"[EPIC] Schema \u0026 Data Model Updates","description":"Schema updates for reranking support.\n\nBounded Context: Data Model Domain\nReference: docs/plans/reranker-implementation.md (Section 7)\n\nUpdates required:\n- Qdrant collection schema (ColBERT multivector)\n- Search result schema (rerankerScore field)\n- API response schema (reranker metadata)\n\nSchema migrations for existing data.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T22:58:19.493877-06:00","updated_at":"2025-12-08T23:54:29.231685-06:00","closed_at":"2025-12-08T23:54:29.231685-06:00","dependencies":[{"issue_id":"the-system-7xi","depends_on_id":"the-system-020","type":"blocks","created_at":"2025-12-08T23:02:47.022205-06:00","created_by":"daemon"}]}
{"id":"the-system-82y","title":"Run typecheck, lint, format, and test","description":"","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T02:43:44.282608-06:00","updated_at":"2025-12-08T02:53:44.524789-06:00","closed_at":"2025-12-08T02:53:44.524789-06:00"}
{"id":"the-system-835","title":"MEDIUM: MCP client connections never disconnected","description":"Location: apps/control/src/tools/mcp_client.ts:16-22\n\nThe McpToolAdapter creates MCP client connections via StdioClientTransport (spawns child processes) but provides no disconnect() method. On shutdown, child processes and connections are never closed.\n\nImpact: Resource leaks and zombie processes.\n\nFix: Add disconnect() method and call it in SIGTERM/SIGINT handlers.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:57:00.115588-06:00","updated_at":"2025-12-09T16:57:00.115588-06:00"}
{"id":"the-system-8ct","title":"Add Test Coverage: packages/events","description":"Add comprehensive unit and integration tests for packages/events","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T01:51:16.369165-06:00","updated_at":"2025-12-07T01:55:06.883502-06:00","closed_at":"2025-12-07T01:55:06.883502-06:00","labels":["events","packages","testing"]}
{"id":"the-system-8ngq","title":"MEDIUM: Unhandled promise rejection in BatchIndexer.add()","description":"Location: packages/search-core/src/services/batch-indexer.ts:20-27\n\nThe add() method calls this.flush() without awaiting it or handling errors. If flush rejects, the error is silently ignored.\n\nImpact: Indexing errors are silently dropped.\n\nFix: Handle errors from flush() or make add() async.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:57:39.007444-06:00","updated_at":"2025-12-09T16:57:39.007444-06:00"}
{"id":"the-system-8ol","title":"Update SearchResult schema with rerankerScore","description":"Add reranker score fields to search result schema.\n\nReference: docs/plans/reranker-implementation.md (Section 7.2)\n\nSchema update:\n```typescript\nexport interface SearchResult {\n  id: string;\n\n  // Scores\n  rrfScore: number;           // Original hybrid fusion score\n  rerankerScore?: number;     // Cross-encoder/ColBERT score\n  rerankTier?: RerankerTier;  // Which reranker was used\n\n  // Existing\n  payload: SearchResultPayload;\n}\n```\n\nBoth scores preserved for transparency and debugging.\n\nLocation: packages/search-core/src/models/schema.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:58:26.887024-06:00","updated_at":"2025-12-08T23:08:37.233174-06:00","closed_at":"2025-12-08T23:08:37.233174-06:00"}
{"id":"the-system-9082","title":"MEDIUM: ReDoS risk in phone regex","description":"Location: packages/ingestion-core/src/redactor.ts:45\n\nThe phone regex has nested optional groups with catastrophic backtracking potential on certain inputs.\n\nImpact: Performance degradation on crafted inputs in high-throughput scenarios.\n\nFix: Simplify regex or use phone parsing library as suggested in comments.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:58:25.222214-06:00","updated_at":"2025-12-09T16:58:25.222214-06:00"}
{"id":"the-system-95f","title":"Create quality evaluation script with NDCG/MRR metrics","description":"Build evaluation harness: test queries, ground truth, compute NDCG@10, MRR, MAP. Compare RRF-only vs RRF+rerank. File: scripts/evaluate-reranker.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T23:01:47.472355-06:00","updated_at":"2025-12-08T23:59:19.270629-06:00","closed_at":"2025-12-08T23:59:19.270629-06:00"}
{"id":"the-system-97r","title":"[EPIC] Phase 2: DRY Consolidation","description":"# Phase 2: DRY Consolidation\n\n**Duration**: 4-5 days\n**Dependencies**: Phase 1 complete\n**Parallelization**: ALL tasks (2.1-2.5) can run in parallel\n\n## Overview\nEliminate code duplication across the codebase:\n- Create base classes for embedders and extractors\n- Build parser registry to replace if-else chains\n- Consolidate configuration files\n- Create shared React hooks\n\n## Issue Summary\n- Total duplicated code: ~15%\n- LOC to save: ~400+ lines\n- Files to consolidate: 12+\n\n## Success Criteria\n- [ ] Duplicated code reduced from ~15% to \u003c5%\n- [ ] Base classes created and in use\n- [ ] Parser registry operational\n- [ ] Config files consolidated\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 348-440)\n- docs/refactor/packages/search-core/REPORT.md\n- docs/refactor/packages/ingestion-core/REPORT.md\n- docs/refactor/apps/interface/REPORT.md","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-09T03:31:26.606386-06:00","updated_at":"2025-12-09T04:10:18.468532-06:00","closed_at":"2025-12-09T04:10:18.468532-06:00","labels":["dry","p0","refactoring"],"dependencies":[{"issue_id":"the-system-97r","depends_on_id":"the-system-1q5","type":"blocks","created_at":"2025-12-09T03:38:41.101881-06:00","created_by":"daemon"}]}
{"id":"the-system-97r.1","title":"[2.1] Create BaseEmbedder Class (search-core)","description":"# Task 2.1: Create BaseEmbedder Class\n\n**Effort**: 4 hours\n**Dependencies**: None (after Phase 1)\n**LOC Saved**: ~150 lines\n**Parallel**: Can run with all Phase 2 tasks\n\n## Location\n`packages/search-core/src/services/base-embedder.ts`\n\n## Classes to Refactor\n- TextEmbedder\n- CodeEmbedder\n- ColBERTEmbedder\n- SpladeEmbedder\n\n## Base Class Design\n```typescript\nexport abstract class BaseEmbedder\u003cTConfig extends EmbedderConfig\u003e {\n  protected config: TConfig;\n  protected logger: Logger;\n  \n  constructor(config: TConfig, logger: Logger) {\n    this.config = config;\n    this.logger = logger;\n  }\n  \n  abstract embed(text: string): Promise\u003cnumber[]\u003e;\n  abstract embedBatch(texts: string[]): Promise\u003cnumber[][]\u003e;\n  \n  protected async withRetry\u003cT\u003e(fn: () =\u003e Promise\u003cT\u003e): Promise\u003cT\u003e {\n    // Common retry logic\n  }\n  \n  protected validateInput(text: string): void {\n    // Common validation\n  }\n}\n```\n\n## Acceptance Criteria\n- [ ] BaseEmbedder class created\n- [ ] All 4 embedders refactored to extend base\n- [ ] Common logic deduplicated\n- [ ] Unit tests pass\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 354-370)\n- docs/refactor/packages/search-core/REPORT.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T03:34:43.696657-06:00","updated_at":"2025-12-09T04:10:18.198915-06:00","closed_at":"2025-12-09T04:10:18.198915-06:00","labels":["dry","parallel-ok","refactoring","search-core"],"dependencies":[{"issue_id":"the-system-97r.1","depends_on_id":"the-system-97r","type":"parent-child","created_at":"2025-12-09T03:34:43.697195-06:00","created_by":"daemon"}]}
{"id":"the-system-97r.2","title":"[2.2] Create TagExtractor Base Class (ingestion-core)","description":"# Task 2.2: Create TagExtractor Base Class\n\n**Effort**: 3 hours\n**Dependencies**: None (after Phase 1)\n**LOC Saved**: ~80 lines\n**Parallel**: Can run with all Phase 2 tasks\n\n## Location\n`packages/ingestion-core/src/extractors/base.ts`\n\n## Classes to Refactor\n- ThinkingExtractor\n- DiffExtractor\n\n## Base Class Design\n```typescript\nexport abstract class BaseTagExtractor {\n  protected tagName: string;\n  protected logger: Logger;\n  \n  constructor(tagName: string, logger: Logger) {\n    this.tagName = tagName;\n    this.logger = logger;\n  }\n  \n  abstract extract(content: string): ExtractedTag[];\n  \n  protected findTagBoundaries(content: string): TagBoundary[] {\n    // Common tag boundary detection\n  }\n  \n  protected parseAttributes(tag: string): Record\u003cstring, string\u003e {\n    // Common attribute parsing\n  }\n}\n```\n\n## Acceptance Criteria\n- [ ] BaseTagExtractor class created\n- [ ] ThinkingExtractor refactored\n- [ ] DiffExtractor refactored\n- [ ] Common regex logic shared\n- [ ] Unit tests pass\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 372-387)\n- docs/refactor/packages/ingestion-core/REPORT.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T03:35:11.224357-06:00","updated_at":"2025-12-09T04:10:18.263311-06:00","closed_at":"2025-12-09T04:10:18.263311-06:00","labels":["dry","ingestion-core","parallel-ok","refactoring"],"dependencies":[{"issue_id":"the-system-97r.2","depends_on_id":"the-system-97r","type":"parent-child","created_at":"2025-12-09T03:35:11.224946-06:00","created_by":"daemon"}]}
{"id":"the-system-97r.3","title":"[2.3] Create Parser Registry (ingestion-core)","description":"# Task 2.3: Create Parser Registry\n\n**Effort**: 4 hours\n**Dependencies**: None (after Phase 1)\n**Blocks**: Ingestion app refactoring\n**Parallel**: Can run with all Phase 2 tasks\n\n## Location\n`packages/ingestion-core/src/parser/registry.ts`\n\n## Current Problem\n8-way if-else chain in `apps/ingestion/src/index.ts` for parser selection.\n\n## Registry Design\n```typescript\nexport class ParserRegistry {\n  private parsers = new Map\u003cstring, Parser\u003e();\n  \n  register(provider: string, parser: Parser): void {\n    this.parsers.set(provider.toLowerCase(), parser);\n  }\n  \n  get(provider: string): Parser | undefined {\n    return this.parsers.get(provider.toLowerCase());\n  }\n  \n  has(provider: string): boolean {\n    return this.parsers.has(provider.toLowerCase());\n  }\n  \n  providers(): string[] {\n    return Array.from(this.parsers.keys());\n  }\n}\n\n// Auto-registration\nexport const defaultRegistry = new ParserRegistry();\ndefaultRegistry.register('anthropic', new AnthropicParser());\ndefaultRegistry.register('openai', new OpenAIParser());\n// ... etc\n```\n\n## Changes Required\n- Create `ParserRegistry` class\n- Auto-register all 8 parsers\n- Update `apps/ingestion/src/index.ts` to use registry\n- Add support for provider aliases\n\n## Acceptance Criteria\n- [ ] ParserRegistry class created\n- [ ] All 8 parsers registered\n- [ ] Ingestion app updated\n- [ ] Provider aliases work\n- [ ] Unit tests pass\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 389-405)\n- docs/refactor/packages/ingestion-core/REPORT.md\n- docs/refactor/apps/ingestion/REPORT.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T03:35:12.657478-06:00","updated_at":"2025-12-09T04:10:18.325441-06:00","closed_at":"2025-12-09T04:10:18.325441-06:00","labels":["dry","ingestion-core","parallel-ok","refactoring"],"dependencies":[{"issue_id":"the-system-97r.3","depends_on_id":"the-system-97r","type":"parent-child","created_at":"2025-12-09T03:35:12.657956-06:00","created_by":"daemon"}]}
{"id":"the-system-97r.4","title":"[2.4] Consolidate Configuration (search-core)","description":"# Task 2.4: Consolidate Configuration (search-core)\n\n**Effort**: 3 hours\n**Dependencies**: Task 0.1 (env helpers from @engram/common)\n**Parallel**: Can run with all Phase 2 tasks\n\n## Files to Merge\n- `packages/search-core/src/config.ts`\n- `packages/search-core/src/config/reranker-config.ts`\n- `packages/search-core/src/config/env.ts`\n\n## Target\nSingle `packages/search-core/src/config/index.ts`\n\n## Config Structure\n```typescript\nexport const searchConfig = {\n  qdrant: {\n    host: envStr('QDRANT_HOST', 'localhost'),\n    port: envNum('QDRANT_PORT', 6333),\n    collectionName: envStr('QDRANT_COLLECTION', 'engram'),\n  },\n  reranker: {\n    enabled: envBool('RERANKER_ENABLED', false),\n    model: envStr('RERANKER_MODEL', 'cross-encoder'),\n    topK: envNum('RERANKER_TOP_K', 10),\n  },\n  embedding: {\n    model: envStr('EMBEDDING_MODEL', 'text-embedding-ada-002'),\n    dimensions: envNum('EMBEDDING_DIMENSIONS', 1536),\n  },\n} as const;\n\nexport type SearchConfig = typeof searchConfig;\n```\n\n## Acceptance Criteria\n- [ ] Config files merged\n- [ ] Using env helpers from @engram/common\n- [ ] No duplicate env reads\n- [ ] Type-safe config object\n- [ ] All tests pass\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 407-421)\n- docs/refactor/packages/search-core/REPORT.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T03:35:13.814887-06:00","updated_at":"2025-12-09T04:10:18.387392-06:00","closed_at":"2025-12-09T04:10:18.387392-06:00","labels":["config","dry","parallel-ok","refactoring","search-core"],"dependencies":[{"issue_id":"the-system-97r.4","depends_on_id":"the-system-97r","type":"parent-child","created_at":"2025-12-09T03:35:13.815313-06:00","created_by":"daemon"},{"issue_id":"the-system-97r.4","depends_on_id":"the-system-wai.1","type":"blocks","created_at":"2025-12-09T03:38:54.374518-06:00","created_by":"daemon"}]}
{"id":"the-system-97r.5","title":"[2.5] Create Shared useWebSocket Hook (interface)","description":"# Task 2.5: Create Shared useWebSocket Hook\n\n**Effort**: 3 hours\n**Dependencies**: None (after Phase 1)\n**LOC Saved**: ~80 lines\n**Parallel**: Can run with all Phase 2 tasks\n\n## Location\n`apps/interface/app/hooks/useWebSocket.ts`\n\n## Hooks to Refactor\n- useSessionStream\n- useSessionsStream\n\n## Hook Design\n```typescript\ninterface UseWebSocketOptions\u003cT\u003e {\n  url: string;\n  onMessage: (data: T) =\u003e void;\n  onError?: (error: Error) =\u003e void;\n  onOpen?: () =\u003e void;\n  onClose?: () =\u003e void;\n  reconnect?: boolean;\n  reconnectInterval?: number;\n}\n\nexport function useWebSocket\u003cT\u003e(options: UseWebSocketOptions\u003cT\u003e) {\n  const [status, setStatus] = useState\u003c'connecting' | 'open' | 'closed' | 'error'\u003e('connecting');\n  const wsRef = useRef\u003cWebSocket | null\u003e(null);\n  \n  // Common WebSocket logic...\n  \n  return { status, send, close };\n}\n```\n\n## Acceptance Criteria\n- [ ] useWebSocket hook created\n- [ ] useSessionStream refactored\n- [ ] useSessionsStream refactored\n- [ ] Reconnection logic shared\n- [ ] Unit tests pass\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 423-439)\n- docs/refactor/apps/interface/REPORT.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T03:35:15.44817-06:00","updated_at":"2025-12-09T04:10:18.428972-06:00","closed_at":"2025-12-09T04:10:18.428972-06:00","labels":["dry","hooks","interface","parallel-ok","refactoring"],"dependencies":[{"issue_id":"the-system-97r.5","depends_on_id":"the-system-97r","type":"parent-child","created_at":"2025-12-09T03:35:15.448617-06:00","created_by":"daemon"}]}
{"id":"the-system-99n","title":"MEDIUM: Missing HTTP request error handler","description":"Location: apps/ingestion/src/index.ts:299-338\n\nThe HTTP server sets up req.on('data') and req.on('end') handlers but does not handle the 'error' event on the request stream.\n\nImpact: Potential unhandled errors when clients disconnect unexpectedly.\n\nFix: Add req.on('error') handler.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:57:35.413066-06:00","updated_at":"2025-12-09T16:57:35.413066-06:00"}
{"id":"the-system-9dd","title":"Bounded Context: Semantic Search","description":"The 'Cortex'. Vector indexing, hybrid search, and reranking. See docs/bitemporal/context/semantic-search/","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:47:42.480224-06:00","updated_at":"2025-12-06T23:26:13.08016-06:00","closed_at":"2025-12-06T23:26:13.080162-06:00","labels":["context","qdrant","search"]}
{"id":"the-system-9dd.1","title":"Define Vector Point Schema","description":"Zod schema for Qdrant points (dense/sparse vectors + metadata). See docs/bitemporal/context/semantic-search/define-vector-point-schema.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:52:43.310246-06:00","updated_at":"2025-12-06T22:28:17.730493-06:00","closed_at":"2025-12-06T22:28:17.730495-06:00","labels":["qdrant","schema","search"],"dependencies":[{"issue_id":"the-system-9dd.1","depends_on_id":"the-system-9dd","type":"parent-child","created_at":"2025-12-06T21:52:43.310637-06:00","created_by":"daemon"}]}
{"id":"the-system-9dd.10","title":"Develop Dense Vector Retrieval","description":"Execute Qdrant search on 'dense' vector field. See docs/bitemporal/context/semantic-search/develop-dense-vector-retrieval.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:52:43.693549-06:00","updated_at":"2025-12-06T22:29:05.186656-06:00","closed_at":"2025-12-06T22:29:05.186659-06:00","labels":["dense","retrieval","search"],"dependencies":[{"issue_id":"the-system-9dd.10","depends_on_id":"the-system-9dd","type":"parent-child","created_at":"2025-12-06T21:52:43.6939-06:00","created_by":"daemon"}]}
{"id":"the-system-9dd.11","title":"Develop Sparse Graph Keyword Retrieval","description":"Execute Qdrant search on 'sparse' vector field. See docs/bitemporal/context/semantic-search/develop-sparse-graph-keyword-retrieval.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:52:43.736242-06:00","updated_at":"2025-12-06T22:29:05.215971-06:00","closed_at":"2025-12-06T22:29:05.215974-06:00","labels":["retrieval","search","sparse"],"dependencies":[{"issue_id":"the-system-9dd.11","depends_on_id":"the-system-9dd","type":"parent-child","created_at":"2025-12-06T21:52:43.736624-06:00","created_by":"daemon"}]}
{"id":"the-system-9dd.12","title":"Implement Result Re-ranking Logic","description":"Cross-Encoder (bge-reranker) to refine top-k results. See docs/bitemporal/context/semantic-search/implement-result-re-ranking-logic.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:52:43.778368-06:00","updated_at":"2025-12-06T23:23:16.248997-06:00","closed_at":"2025-12-06T23:23:16.249-06:00","labels":["ml","ranking","search"],"dependencies":[{"issue_id":"the-system-9dd.12","depends_on_id":"the-system-9dd","type":"parent-child","created_at":"2025-12-06T21:52:43.778789-06:00","created_by":"daemon"}]}
{"id":"the-system-9dd.13","title":"Create Embedding Batch Processor","description":"Queue system to batch embedding generation. See docs/bitemporal/context/semantic-search/create-embedding-batch-processor.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:52:43.822685-06:00","updated_at":"2025-12-06T23:43:46.907094-06:00","closed_at":"2025-12-06T23:43:46.907097-06:00","labels":["batching","performance","search"],"dependencies":[{"issue_id":"the-system-9dd.13","depends_on_id":"the-system-9dd","type":"parent-child","created_at":"2025-12-06T21:52:43.823076-06:00","created_by":"daemon"}]}
{"id":"the-system-9dd.14","title":"Implement Qdrant Snapshot Manager","description":"Automated backup of vector index to GCS. See docs/bitemporal/context/semantic-search/implement-qdrant-snapshot-manager.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T21:52:43.864783-06:00","updated_at":"2025-12-07T01:01:26.548378-06:00","closed_at":"2025-12-07T01:01:26.548378-06:00","labels":["backup","ops","search"],"dependencies":[{"issue_id":"the-system-9dd.14","depends_on_id":"the-system-9dd","type":"parent-child","created_at":"2025-12-06T21:52:43.865127-06:00","created_by":"daemon"}]}
{"id":"the-system-9dd.15","title":"Create Similarity Score Threshold Configuration","description":"Dynamic thresholds to filter irrelevant results. See docs/bitemporal/context/semantic-search/create-similarity-score-threshold-configuration.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T21:52:43.90902-06:00","updated_at":"2025-12-06T23:58:01.176471-06:00","closed_at":"2025-12-06T23:58:01.176474-06:00","labels":["config","search","tuning"],"dependencies":[{"issue_id":"the-system-9dd.15","depends_on_id":"the-system-9dd","type":"parent-child","created_at":"2025-12-06T21:52:43.909425-06:00","created_by":"daemon"}]}
{"id":"the-system-9dd.16","title":"Develop Semantic Deduplication Logic","description":"Prevent indexing semantically identical duplicates. See docs/bitemporal/context/semantic-search/develop-semantic-deduplication-logic.md","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-06T21:52:43.949354-06:00","updated_at":"2025-12-07T01:18:14.912124-06:00","closed_at":"2025-12-07T01:18:14.912124-06:00","labels":["dedupe","quality","search"],"dependencies":[{"issue_id":"the-system-9dd.16","depends_on_id":"the-system-9dd","type":"parent-child","created_at":"2025-12-06T21:52:43.949671-06:00","created_by":"daemon"}]}
{"id":"the-system-9dd.2","title":"Select Text Embedding Model","description":"Choice: intfloat/multilingual-e5-small (ONNX). See docs/bitemporal/context/semantic-search/select-text-embedding-model.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:52:43.353524-06:00","updated_at":"2025-12-06T22:28:17.759041-06:00","closed_at":"2025-12-06T22:28:17.759043-06:00","labels":["model","search","text"],"dependencies":[{"issue_id":"the-system-9dd.2","depends_on_id":"the-system-9dd","type":"parent-child","created_at":"2025-12-06T21:52:43.353852-06:00","created_by":"daemon"}]}
{"id":"the-system-9dd.3","title":"Select Code Embedding Model","description":"Choice: nomic-embed-text-v1.5 (8k context). See docs/bitemporal/context/semantic-search/select-code-embedding-model.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:52:43.39731-06:00","updated_at":"2025-12-06T22:28:17.789019-06:00","closed_at":"2025-12-06T22:28:17.789022-06:00","labels":["code","model","search"],"dependencies":[{"issue_id":"the-system-9dd.3","depends_on_id":"the-system-9dd","type":"parent-child","created_at":"2025-12-06T21:52:43.397728-06:00","created_by":"daemon"}]}
{"id":"the-system-9dd.4","title":"Implement Text Embedding Service","description":"Wrapper for fast-embed/ONNX to generate text vectors. See docs/bitemporal/context/semantic-search/implement-text-embedding-service.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:52:43.439112-06:00","updated_at":"2025-12-06T22:28:17.81775-06:00","closed_at":"2025-12-06T22:28:17.817752-06:00","labels":["embedding","search","service"],"dependencies":[{"issue_id":"the-system-9dd.4","depends_on_id":"the-system-9dd","type":"parent-child","created_at":"2025-12-06T21:52:43.439559-06:00","created_by":"daemon"}]}
{"id":"the-system-9dd.5","title":"Implement Code Embedding Service","description":"Wrapper for nomic-embed to generate code vectors. See docs/bitemporal/context/semantic-search/implement-code-embedding-service.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:52:43.482698-06:00","updated_at":"2025-12-06T22:28:17.844903-06:00","closed_at":"2025-12-06T22:28:17.844905-06:00","labels":["embedding","search","service"],"dependencies":[{"issue_id":"the-system-9dd.5","depends_on_id":"the-system-9dd","type":"parent-child","created_at":"2025-12-06T21:52:43.483104-06:00","created_by":"daemon"}]}
{"id":"the-system-9dd.6","title":"Configure Qdrant Collection Manager","description":"Script to init Qdrant with dense/sparse configuration. See docs/bitemporal/context/semantic-search/configure-qdrant-collection-manager.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:52:43.526279-06:00","updated_at":"2025-12-06T22:28:36.503247-06:00","closed_at":"2025-12-06T22:28:36.50325-06:00","labels":["ops","qdrant","search"],"dependencies":[{"issue_id":"the-system-9dd.6","depends_on_id":"the-system-9dd","type":"parent-child","created_at":"2025-12-06T21:52:43.52668-06:00","created_by":"daemon"}]}
{"id":"the-system-9dd.7","title":"Implement Vector Upsert Logic","description":"Indexer service listening to memory.node_created events. See docs/bitemporal/context/semantic-search/implement-vector-upsert-logic.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:52:43.569542-06:00","updated_at":"2025-12-06T22:29:05.127435-06:00","closed_at":"2025-12-06T22:29:05.127442-06:00","labels":["indexing","redpanda","search"],"dependencies":[{"issue_id":"the-system-9dd.7","depends_on_id":"the-system-9dd","type":"parent-child","created_at":"2025-12-06T21:52:43.56991-06:00","created_by":"daemon"}]}
{"id":"the-system-9dd.8","title":"Define Hybrid Search Request Schema","description":"Interface for search queries (text, filters, strategy). See docs/bitemporal/context/semantic-search/define-hybrid-search-request-schema.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:52:43.610895-06:00","updated_at":"2025-12-06T22:29:05.157487-06:00","closed_at":"2025-12-06T22:29:05.157489-06:00","labels":["api","schema","search"],"dependencies":[{"issue_id":"the-system-9dd.8","depends_on_id":"the-system-9dd","type":"parent-child","created_at":"2025-12-06T21:52:43.611304-06:00","created_by":"daemon"}]}
{"id":"the-system-9dd.9","title":"Implement Intent Classifier for Queries","description":"Heuristic router to weight dense vs sparse search. See docs/bitemporal/context/semantic-search/implement-intent-classifier-for-queries.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T21:52:43.652792-06:00","updated_at":"2025-12-06T23:59:35.580581-06:00","closed_at":"2025-12-06T23:59:35.580584-06:00","labels":["nlp","router","search"],"dependencies":[{"issue_id":"the-system-9dd.9","depends_on_id":"the-system-9dd","type":"parent-child","created_at":"2025-12-06T21:52:43.653219-06:00","created_by":"daemon"}]}
{"id":"the-system-9ga7","title":"LOW: PII patterns defined but not applied in redactor","description":"Location: packages/ingestion-core/src/redactor.ts\n\nAWS_KEY and GENERIC_SECRET patterns are defined in PATTERNS object but never applied in redact() method.\n\nFix: Either remove unused patterns or apply them.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:59:47.017672-06:00","updated_at":"2025-12-09T16:59:47.017672-06:00"}
{"id":"the-system-9ngq","title":"LOW: Buffer written with utf-8 encoding corrupts binary data","description":"Location: packages/storage/src/blob.ts:17-24\n\nWhen saving a Buffer, the method writes it with utf-8 encoding, which can corrupt binary data that is not valid UTF-8.\n\nFix: Don't specify encoding for Buffer content.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:59:18.127053-06:00","updated_at":"2025-12-09T16:59:18.127053-06:00"}
{"id":"the-system-9we","title":"Improve code coverage across the monorepo","description":"","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T02:44:22.329459-06:00","updated_at":"2025-12-08T02:56:44.70659-06:00","closed_at":"2025-12-08T02:56:44.70659-06:00"}
{"id":"the-system-a1m","title":"Implement archive before graph pruning","description":"GraphPruner deletes old transaction history without archiving first. Need to export to JSONL before deletion, then upload to GCS cold storage to preserve audit trail. Ref: implement-graph-pruning-strategy.md","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-08T02:06:07.02924-06:00","updated_at":"2025-12-08T02:32:57.807637-06:00","closed_at":"2025-12-08T02:32:57.807637-06:00"}
{"id":"the-system-a5xt","title":"LOW: Silent JSON.stringify failure in parsers","description":"Locations: \n- packages/ingestion-core/src/parser/claude-code.ts:61\n- packages/ingestion-core/src/parser/gemini.ts:93\n\nSeveral parsers call JSON.stringify() on user-provided input without handling potential circular reference errors.\n\nFix: Add try-catch around JSON.stringify calls.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:59:22.097664-06:00","updated_at":"2025-12-09T16:59:22.097664-06:00"}
{"id":"the-system-ad2","title":"Bounded Context: Cognitive Ingestion","description":"The 'Nervous System'. Stream intake, protocol detection, parsing, and sanitization. See docs/bitemporal/context/cognitive-ingestion/","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:47:42.349348-06:00","updated_at":"2025-12-06T22:33:15.059846-06:00","closed_at":"2025-12-06T22:33:15.059849-06:00","labels":["context","ingestion","redpanda"]}
{"id":"the-system-ad2.1","title":"Define Raw Stream Event Schema","description":"Zod schema for validating raw JSON payloads from OpenAI/Anthropic. See docs/bitemporal/context/cognitive-ingestion/define-raw-stream-event-schema.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:48:49.946059-06:00","updated_at":"2025-12-06T22:13:50.376277-06:00","closed_at":"2025-12-06T22:13:50.37628-06:00","labels":["ingestion","schema","zod"],"dependencies":[{"issue_id":"the-system-ad2.1","depends_on_id":"the-system-ad2","type":"parent-child","created_at":"2025-12-06T21:48:49.946457-06:00","created_by":"daemon"}]}
{"id":"the-system-ad2.10","title":"Implement Secret Masking Regex","description":"Patterns to detect and mask API keys (sk-..., AKIA...). See docs/bitemporal/context/cognitive-ingestion/implement-secret-masking-regex.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:48:50.35047-06:00","updated_at":"2025-12-06T22:14:36.511186-06:00","closed_at":"2025-12-06T22:14:36.511188-06:00","labels":["ingestion","secrets","security"],"dependencies":[{"issue_id":"the-system-ad2.10","depends_on_id":"the-system-ad2","type":"parent-child","created_at":"2025-12-06T21:48:50.350891-06:00","created_by":"daemon"}]}
{"id":"the-system-ad2.11","title":"Create Redpanda Producer Configuration","description":"KafkaJS producer setup with idempotency enabled. See docs/bitemporal/context/cognitive-ingestion/create-redpanda-producer-configuration.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:48:50.394597-06:00","updated_at":"2025-12-06T22:14:59.087098-06:00","closed_at":"2025-12-06T22:14:59.087102-06:00","labels":["ingestion","producer","redpanda"],"dependencies":[{"issue_id":"the-system-ad2.11","depends_on_id":"the-system-ad2","type":"parent-child","created_at":"2025-12-06T21:48:50.394957-06:00","created_by":"daemon"}]}
{"id":"the-system-ad2.12","title":"Create Redpanda Consumer Configuration","description":"Shared consumer factory for downstream services. See docs/bitemporal/context/cognitive-ingestion/create-redpanda-consumer-configuration.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:48:50.438598-06:00","updated_at":"2025-12-06T22:14:59.118086-06:00","closed_at":"2025-12-06T22:14:59.118088-06:00","labels":["consumer","ingestion","redpanda"],"dependencies":[{"issue_id":"the-system-ad2.12","depends_on_id":"the-system-ad2","type":"parent-child","created_at":"2025-12-06T21:48:50.438911-06:00","created_by":"daemon"}]}
{"id":"the-system-ad2.13","title":"Implement Stream De-multiplexer","description":"Ensure ordering by using session_id as Kafka partition key. See docs/bitemporal/context/cognitive-ingestion/implement-stream-de-multiplexer.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:48:50.484897-06:00","updated_at":"2025-12-06T22:27:34.813106-06:00","closed_at":"2025-12-06T22:27:34.813109-06:00","labels":["ingestion","partitioning","streaming"],"dependencies":[{"issue_id":"the-system-ad2.13","depends_on_id":"the-system-ad2","type":"parent-child","created_at":"2025-12-06T21:48:50.485301-06:00","created_by":"daemon"}]}
{"id":"the-system-ad2.14","title":"Implement Dead Letter Queue Handler","description":"Route failed parse events to 'ingestion.dead_letter'. See docs/bitemporal/context/cognitive-ingestion/implement-dead-letter-queue-handler.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T21:48:50.529054-06:00","updated_at":"2025-12-07T00:15:45.628973-06:00","closed_at":"2025-12-07T00:15:45.628975-06:00","labels":["dlq","error-handling","ingestion"],"dependencies":[{"issue_id":"the-system-ad2.14","depends_on_id":"the-system-ad2","type":"parent-child","created_at":"2025-12-06T21:48:50.529498-06:00","created_by":"daemon"}]}
{"id":"the-system-ad2.2","title":"Implement Stream Protocol Detector","description":"Lightweight fingerprinting logic to identify provider (OpenAI vs Anthropic) from headers/body. See docs/bitemporal/context/cognitive-ingestion/implement-stream-protocol-detector.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:48:49.991361-06:00","updated_at":"2025-12-06T22:14:36.453173-06:00","closed_at":"2025-12-06T22:14:36.453176-06:00","labels":["ingestion","protocol"],"dependencies":[{"issue_id":"the-system-ad2.2","depends_on_id":"the-system-ad2","type":"parent-child","created_at":"2025-12-06T21:48:49.991728-06:00","created_by":"daemon"}]}
{"id":"the-system-ad2.3","title":"Create Anthropic Parser Strategy","description":"Parser for Anthropic SSE events (message_start, content_block_delta). See docs/bitemporal/context/cognitive-ingestion/create-anthropic-parser-strategy.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:48:50.036626-06:00","updated_at":"2025-12-06T22:27:15.778399-06:00","closed_at":"2025-12-06T22:27:15.778402-06:00","labels":["anthropic","ingestion","parser"],"dependencies":[{"issue_id":"the-system-ad2.3","depends_on_id":"the-system-ad2","type":"parent-child","created_at":"2025-12-06T21:48:50.037092-06:00","created_by":"daemon"}]}
{"id":"the-system-ad2.4","title":"Create OpenAI Parser Strategy","description":"Parser for OpenAI chat.completion.chunk objects. See docs/bitemporal/context/cognitive-ingestion/create-openai-parser-strategy.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:48:50.079563-06:00","updated_at":"2025-12-06T22:27:15.811684-06:00","closed_at":"2025-12-06T22:27:15.811689-06:00","labels":["ingestion","openai","parser"],"dependencies":[{"issue_id":"the-system-ad2.4","depends_on_id":"the-system-ad2","type":"parent-child","created_at":"2025-12-06T21:48:50.079982-06:00","created_by":"daemon"}]}
{"id":"the-system-ad2.5","title":"Implement Thinking Tag Extractor","description":"Stateful stream transformer to isolate \u003cthinking\u003e blocks. See docs/bitemporal/context/cognitive-ingestion/implement-thinking-tag-extractor.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T21:48:50.124994-06:00","updated_at":"2025-12-06T23:35:12.643673-06:00","closed_at":"2025-12-06T23:35:12.643676-06:00","labels":["ingestion","thinking","xml"],"dependencies":[{"issue_id":"the-system-ad2.5","depends_on_id":"the-system-ad2","type":"parent-child","created_at":"2025-12-06T21:48:50.125395-06:00","created_by":"daemon"}]}
{"id":"the-system-ad2.6","title":"Implement Diff Block Extractor","description":"Logic to extract code search/replace blocks from the stream. See docs/bitemporal/context/cognitive-ingestion/implement-diff-block-extractor.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T21:48:50.169791-06:00","updated_at":"2025-12-06T23:36:10.386842-06:00","closed_at":"2025-12-06T23:36:10.386845-06:00","labels":["code","diff","ingestion"],"dependencies":[{"issue_id":"the-system-ad2.6","depends_on_id":"the-system-ad2","type":"parent-child","created_at":"2025-12-06T21:48:50.170164-06:00","created_by":"daemon"}]}
{"id":"the-system-ad2.7","title":"Implement Tool Call Extractor","description":"Normalizer for native tool calls into a standard internal format. See docs/bitemporal/context/cognitive-ingestion/implement-tool-call-extractor.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:48:50.21583-06:00","updated_at":"2025-12-06T22:27:15.842937-06:00","closed_at":"2025-12-06T22:27:15.84294-06:00","labels":["ingestion","tool-call"],"dependencies":[{"issue_id":"the-system-ad2.7","depends_on_id":"the-system-ad2","type":"parent-child","created_at":"2025-12-06T21:48:50.216209-06:00","created_by":"daemon"}]}
{"id":"the-system-ad2.8","title":"Define Normalized Event Structure","description":"ParsedStreamEvent schema (Zod) including 'role' field. See docs/bitemporal/context/cognitive-ingestion/define-normalized-event-structure.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:48:50.259846-06:00","updated_at":"2025-12-06T22:13:50.406647-06:00","closed_at":"2025-12-06T22:13:50.406648-06:00","labels":["ingestion","schema","zod"],"dependencies":[{"issue_id":"the-system-ad2.8","depends_on_id":"the-system-ad2","type":"parent-child","created_at":"2025-12-06T21:48:50.260267-06:00","created_by":"daemon"}]}
{"id":"the-system-ad2.9","title":"Implement PII Redaction Logic","description":"Regex-based scrubber for emails, credit cards, SSNs. See docs/bitemporal/context/cognitive-ingestion/implement-pii-redaction-logic.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:48:50.304318-06:00","updated_at":"2025-12-06T22:14:36.484351-06:00","closed_at":"2025-12-06T22:14:36.484353-06:00","labels":["ingestion","pii","security"],"dependencies":[{"issue_id":"the-system-ad2.9","depends_on_id":"the-system-ad2","type":"parent-child","created_at":"2025-12-06T21:48:50.304763-06:00","created_by":"daemon"}]}
{"id":"the-system-ajl","title":"Update traffic generator script for new node types","description":"Update the traffic generator to create Turn, Reasoning, and FileTouch nodes with the new schema","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T03:19:12.927132-06:00","updated_at":"2025-12-08T03:34:05.999996-06:00","closed_at":"2025-12-08T03:34:05.999996-06:00"}
{"id":"the-system-aku","title":"Add code-specific embedding model","description":"Code embedding currently uses the same text model (e5-small) as text, which is suboptimal for code semantics. Need to switch to nomic-embed-text-v1.5 or similar code model with 8k context, and implement chunking for large files. Ref: select-code-embedding-model.md","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-08T02:06:06.160641-06:00","updated_at":"2025-12-08T02:21:00.601945-06:00","closed_at":"2025-12-08T02:21:00.601945-06:00"}
{"id":"the-system-aml","title":"Implement A/B testing framework for reranker rollout","description":"Feature flags: rerank_enabled_pct, rerank_tier_override. Random assignment per session. Track metrics per variant.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T23:02:29.648023-06:00","updated_at":"2025-12-09T00:13:50.194887-06:00","closed_at":"2025-12-09T00:13:50.194887-06:00"}
{"id":"the-system-aq2","title":"MEDIUM: Global Date.now/Math.random pollution in ReplayEngine","description":"Location: packages/execution-core/src/replay.ts:139-159\n\nThe setupDeterministicEnv() method modifies global Date.now and Math.random which affects all code running in the same process.\n\nImpact: Race condition with concurrent replays, cross-contamination of other operations.\n\nFix: Use dependency injection for time/random instead of global mutation.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:57:33.849424-06:00","updated_at":"2025-12-09T16:57:33.849424-06:00"}
{"id":"the-system-aqn","title":"Implement query result Redis cache","description":"Cache reranked results in Redis with 5min TTL. Key: hash(query+filters+rerankTier). Target 30%+ hit rate.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T23:02:13.374933-06:00","updated_at":"2025-12-09T00:24:38.126496-06:00","closed_at":"2025-12-09T00:24:38.126496-06:00","dependencies":[{"issue_id":"the-system-aqn","depends_on_id":"the-system-yvk","type":"blocks","created_at":"2025-12-08T23:03:27.884299-06:00","created_by":"daemon"}]}
{"id":"the-system-ayk","title":"Update API response schema with reranker metadata","description":"Add reranker metadata to search API response.\n\nReference: docs/plans/reranker-implementation.md (Section 7.3)\n\nResponse schema:\n```typescript\ninterface SearchAPIResponse {\n  success: boolean;\n  data: {\n    results: SearchResult[];\n    meta: {\n      query: string;\n      strategy: SearchStrategy;\n      reranker?: {\n        tier: RerankerTier;\n        model: string;\n        latencyMs: number;\n      };\n      totalLatencyMs: number;\n    };\n  };\n}\n```\n\nLocation: apps/interface/app/api/search/route.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:58:33.982851-06:00","updated_at":"2025-12-08T23:19:19.038265-06:00","closed_at":"2025-12-08T23:19:19.038265-06:00","dependencies":[{"issue_id":"the-system-ayk","depends_on_id":"the-system-8ol","type":"blocks","created_at":"2025-12-08T23:03:26.756607-06:00","created_by":"daemon"}]}
{"id":"the-system-b9g","title":"Add Prometheus metrics for candidate counts","description":"Histogram: search_rerank_candidates with tier labels, buckets [5,10,20,30,50,100]","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T23:02:00.653278-06:00","updated_at":"2025-12-08T23:58:30.544456-06:00","closed_at":"2025-12-08T23:58:30.544456-06:00"}
{"id":"the-system-bkj","title":"[EPIC] Query Routing \u0026 Classification","description":"Query routing system for tier selection.\n\nBounded Context: Query Classification Domain\nReference: docs/plans/reranker-implementation.md (Section 3.2.1, Appendix B)\n\nRoutes queries to appropriate reranker tier based on:\n- Query complexity (length, operators)\n- Content type filter (code vs text)\n- User tier/subscription\n- Latency budget\n\nRouting heuristics:\n- Quoted strings ‚Üí accurate tier\n- Code patterns ‚Üí code tier\n- Long/complex queries ‚Üí accurate tier\n- Simple queries ‚Üí fast tier","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T22:55:51.528438-06:00","updated_at":"2025-12-08T23:54:29.195471-06:00","closed_at":"2025-12-08T23:54:29.195471-06:00","dependencies":[{"issue_id":"the-system-bkj","depends_on_id":"the-system-020","type":"blocks","created_at":"2025-12-08T23:02:51.332623-06:00","created_by":"daemon"}]}
{"id":"the-system-bms0","title":"LOW: Missing error handling for corrupted snapshot data","description":"Location: packages/vfs/src/vfs.ts:111-114\n\nloadSnapshot does not handle corrupted/invalid snapshot data gracefully. Invalid gzip or JSON throws unclear errors.\n\nFix: Add try-catch with descriptive error messages.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:59:44.49805-06:00","updated_at":"2025-12-09T16:59:44.49805-06:00"}
{"id":"the-system-bob","title":"Test Qdrant hybrid search with SPLADE vectors","description":"Integration test for Qdrant hybrid search using SPLADE sparse vectors. Verify synonym handling and vocabulary mismatch improvements over BM25.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T19:25:08.791888-06:00","updated_at":"2025-12-08T20:20:17.320417-06:00","closed_at":"2025-12-08T20:20:17.320417-06:00","dependencies":[{"issue_id":"the-system-bob","depends_on_id":"the-system-1v5","type":"blocks","created_at":"2025-12-08T19:25:16.457402-06:00","created_by":"daemon"}]}
{"id":"the-system-bxe","title":"Add ms-marco-MiniLM-L-6-v2 fast reranker model","description":"Add fast-tier reranker using ms-marco-MiniLM-L-6-v2.\n\nReference: docs/plans/reranker-implementation.md (Section 2.2, Tier 1)\n\nModel: Xenova/ms-marco-MiniLM-L-6-v2\n- 22M parameters\n- Target latency: \u003c 50ms\n- Use case: All queries, fast default\n\nImplementation:\n- Add model constant to reranker config\n- Implement fast reranker singleton\n- Use q8 quantization for speed\n\nLocation: packages/search-core/src/services/fast-reranker.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:55:33.760038-06:00","updated_at":"2025-12-08T23:53:44.638167-06:00","closed_at":"2025-12-08T23:53:44.638167-06:00"}
{"id":"the-system-byw","title":"Fix tool extraction from LLM output","description":"The DecisionEngine in control/src/engine/decision.ts may not properly extract tool calls from LLM generateText response. Need to verify tool_calls parsing and handle edge cases where structured output is malformed. Ref: define-decision-loop-logic.md","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-08T02:06:09.319012-06:00","updated_at":"2025-12-08T02:31:05.742627-06:00","closed_at":"2025-12-08T02:31:05.742627-06:00"}
{"id":"the-system-caz","title":"Evaluate interface nodes: add Cost, Session, GitSnapshot, Timing nodes?","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T18:50:45.476212-06:00","updated_at":"2025-12-08T19:01:43.324894-06:00","closed_at":"2025-12-08T19:01:43.324894-06:00"}
{"id":"the-system-cf3","title":"MEDIUM: Unhandled async callback rejection in TurnAggregator","description":"Location: apps/memory/src/index.ts:118-134\n\nThe onNodeCreated callback is async but emitNodeCreated() calls it without await. The try/catch only catches synchronous errors.\n\nImpact: Unhandled promise rejections, potential process crash.\n\nFix: Await the callback or add .catch() handler.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:57:36.296615-06:00","updated_at":"2025-12-09T16:57:36.296615-06:00"}
{"id":"the-system-cnc","title":"[EPIC] ColBERT Late Interaction Reranking","description":"ColBERT late interaction for billion-scale efficiency.\n\nBounded Context: Late Interaction Domain\nReference: docs/plans/reranker-implementation.md (Section 3.2.3, Phase 3)\n\nColBERT enables:\n- Precomputed document token embeddings\n- MaxSim scoring at query time\n- 180x fewer FLOPs than cross-encoders at k=10\n- Native Qdrant multivector support\n\nModel: jinaai/jina-colbert-v2 (559M, 89 languages)\n\nThis is the scale path for billion-event search.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T22:56:19.020164-06:00","updated_at":"2025-12-09T00:36:42.045753-06:00","closed_at":"2025-12-09T00:36:42.045753-06:00","dependencies":[{"issue_id":"the-system-cnc","depends_on_id":"the-system-020","type":"blocks","created_at":"2025-12-08T23:02:49.04013-06:00","created_by":"daemon"}]}
{"id":"the-system-cwic","title":"LOW: formatBytes returns incorrect output for negative values","description":"Location: packages/common/src/utils/format.ts:97-105\n\nMath.log() of a negative number returns NaN, causing formatBytes(-1024) to return '-1024 undefined'.\n\nFix: Add check for negative bytes and handle appropriately.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:58:47.257807-06:00","updated_at":"2025-12-09T16:58:47.257807-06:00"}
{"id":"the-system-cznl","title":"LOW: Singleton embedders cause test pollution","description":"Locations:\n- packages/search-core/src/services/text-embedder.ts:38\n- packages/search-core/src/services/code-embedder.ts:47\n- packages/search-core/src/services/reranker.ts:9\n\nAll embedders use static singleton instances without cleanup methods. Tests cannot reset state between runs.\n\nFix: Add reset() or destroy() methods for testing.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:59:42.657948-06:00","updated_at":"2025-12-09T16:59:42.657948-06:00"}
{"id":"the-system-d9uf","title":"LOW: QueryBuilder allows parameter collision","description":"Location: packages/memory-core/src/queries/builder.ts:24-46\n\nThe at() method uses fixed parameter names. If called multiple times with different values, the last call overwrites previous values.\n\nFix: Use indexed parameter names like vt_0, vt_1.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:59:21.12854-06:00","updated_at":"2025-12-09T16:59:21.12854-06:00"}
{"id":"the-system-dfv","title":"MEDIUM: setInterval without cleanup in WebSocket server","description":"Location: apps/interface/lib/websocket-server.ts:357-372\n\nsetInterval created at module load time for timeout checker is never cleared. During HMR in development, multiple intervals accumulate.\n\nImpact: Multiple timers running simultaneously, duplicate broadcasts.\n\nFix: Store interval reference and clear on module unload.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:57:30.959122-06:00","updated_at":"2025-12-09T16:57:30.959122-06:00"}
{"id":"the-system-djr","title":"Research SPLADE-distilbert ONNX conversion","description":"If sparse retrieval quality is insufficient: 1) Convert SPLADE-distilbert to ONNX, 2) Implement SpladePooling in JavaScript, 3) Benchmark against improved BM25. See docs/sparse-embedding-evaluation.md for research findings, available models (naver/splade-v3, naver/splade-v3-distilbert), implementation path, and estimated effort (3-5 days).","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T02:53:59.382213-06:00","updated_at":"2025-12-08T19:17:58.831261-06:00","closed_at":"2025-12-08T19:17:58.831261-06:00"}
{"id":"the-system-dkx","title":"Implement ColBERTEmbedder using jina-colbert-v2","description":"Implement ColBERT embedder for token-level representations.\n\nReference: docs/plans/reranker-implementation.md (Section 3.2.3, Phase 3)\n\nModel: jinaai/jina-colbert-v2\n- Token dimension: 128\n- Supports 89 languages\n- Aggressive quantization (2-bit: 36‚Üí20 bytes per vector)\n\nInterface:\n```typescript\nexport class ColBERTEmbedder {\n  // Encode document into token-level embeddings\n  async encodeDocument(content: string): Promise\u003cFloat32Array[]\u003e;\n  \n  // Encode query for MaxSim scoring\n  async encodeQuery(query: string): Promise\u003cFloat32Array[]\u003e;\n}\n```\n\nLocation: packages/search-core/src/services/colbert-embedder.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:56:27.758309-06:00","updated_at":"2025-12-09T00:36:41.873834-06:00","closed_at":"2025-12-09T00:36:41.873834-06:00"}
{"id":"the-system-dn0","title":"Add RERANKED indicator badge to search results header","description":"Add visual indicator when results have been reranked.\n\nReference: docs/plans/reranker-implementation.md (Section 8.2)\n\nImplementation:\n```typescript\n// In SearchResults header\n{meta?.reranker \u0026\u0026 (\n  \u003cspan \n    className=\"rerank-badge\" \n    title={\\`Reranked by \\${meta.reranker.model}\\`}\n  \u003e\n    RERANKED ({meta.reranker.latencyMs}ms)\n  \u003c/span\u003e\n)}\n```\n\nStyling:\n- Cyan/teal badge consistent with design system\n- Show model name on hover\n- Display latency for transparency\n\nLocation: apps/interface/app/components/SearchResults.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:59:00.191152-06:00","updated_at":"2025-12-08T23:23:53.646996-06:00","closed_at":"2025-12-08T23:23:53.646996-06:00"}
{"id":"the-system-dtt7","title":"Fix missing xai-client module in llm-reranker tests","description":"The llm-reranker.test.ts has 20 failing tests due to missing '../clients/xai-client' module. The import path does not resolve to an existing file. Need to either create the xai-client module or update the import path.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T18:24:13.569652-06:00","updated_at":"2025-12-09T18:24:13.569652-06:00"}
{"id":"the-system-dzq","title":"Benchmark SPLADE vs BM25Sparse","description":"Create benchmark script comparing latency, sparsity, and retrieval quality between SPLADE and BM25Sparse implementations. Test with real search queries. Document results.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T19:25:07.625165-06:00","updated_at":"2025-12-08T19:47:14.158554-06:00","closed_at":"2025-12-08T19:47:14.158554-06:00","dependencies":[{"issue_id":"the-system-dzq","depends_on_id":"the-system-1v5","type":"blocks","created_at":"2025-12-08T19:25:16.424498-06:00","created_by":"daemon"}]}
{"id":"the-system-e3mj","title":"LOW: Unreachable code in protocol detection","description":"Location: packages/ingestion-core/src/protocol.ts:23-25\n\nThe Azure OpenAI check is unreachable because the previous condition on line 18 returns early on the same condition.\n\nFix: Restructure logic to check more specific case first.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:59:43.627699-06:00","updated_at":"2025-12-09T16:59:43.627699-06:00"}
{"id":"the-system-e5r","title":"Add FileTouchNode schema to memory-core","description":"Create FileTouchNode with file_path (indexed), action (read/edit/create/delete), diff_preview","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T03:13:54.365247-06:00","updated_at":"2025-12-08T03:18:11.196582-06:00","closed_at":"2025-12-08T03:18:11.196582-06:00","dependencies":[{"issue_id":"the-system-e5r","depends_on_id":"the-system-3sh","type":"blocks","created_at":"2025-12-08T03:14:04.515795-06:00","created_by":"daemon"}]}
{"id":"the-system-efo","title":"[EPIC] Configuration Management","description":"Configuration for reranking system.\n\nBounded Context: Configuration Domain\nReference: docs/plans/reranker-implementation.md (Section 9)\n\nConfiguration levels:\n- Environment variables\n- Runtime configuration\n- Tier-specific settings\n- Routing heuristics\n\nEnables flexible deployment and tuning.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T22:59:08.223991-06:00","updated_at":"2025-12-09T00:35:19.34847-06:00","closed_at":"2025-12-09T00:35:19.34847-06:00","dependencies":[{"issue_id":"the-system-efo","depends_on_id":"the-system-020","type":"blocks","created_at":"2025-12-08T23:03:06.734126-06:00","created_by":"daemon"}]}
{"id":"the-system-ely","title":"Add Prometheus metrics for score improvement","description":"Histogram: search_rerank_score_delta tracking top result score improvement from reranking","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T23:02:01.69805-06:00","updated_at":"2025-12-08T23:58:31.460004-06:00","closed_at":"2025-12-08T23:58:31.460004-06:00"}
{"id":"the-system-epl","title":"[EPIC] UI/Presentation Layer Updates","description":"UI updates for reranking display.\n\nBounded Context: Presentation Domain\nReference: docs/plans/reranker-implementation.md (Section 8)\n\nUpdates:\n- Show REL score when reranked (instead of RRF)\n- Display reranking indicator badge\n- Update score bar component\n- Show reranker metadata in response\n\nUser should see transparency into ranking method.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T22:58:41.869302-06:00","updated_at":"2025-12-09T00:32:26.241209-06:00","closed_at":"2025-12-09T00:32:26.241209-06:00","dependencies":[{"issue_id":"the-system-epl","depends_on_id":"the-system-7xi","type":"blocks","created_at":"2025-12-08T23:02:48.023063-06:00","created_by":"daemon"}]}
{"id":"the-system-f36","title":"Add cache metrics and hit rate tracking","description":"Track cache_hits, cache_misses, cache_evictions counters. Expose hit_rate gauge.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T23:02:15.883625-06:00","updated_at":"2025-12-09T00:24:40.686967-06:00","closed_at":"2025-12-09T00:24:40.686967-06:00"}
{"id":"the-system-f3v9","title":"MEDIUM: LRU cache uses O(n) operations","description":"Location: packages/search-core/src/services/embedding-cache.ts:216-222\n\nThe LRU implementation uses indexOf and splice on an array, making cache operations O(n).\n\nImpact: For large caches (1GB default), this could cause performance degradation.\n\nFix: Use a Map with doubly-linked list or LRU library for O(1) operations.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:58:18.22501-06:00","updated_at":"2025-12-09T16:58:18.22501-06:00"}
{"id":"the-system-felh","title":"LOW: Test/implementation mismatch for GCSBlobStore.read","description":"Location: packages/storage/src/blob.test.ts:161-167\n\nTest expects GCSBlobStore.read() to return empty string on failure, but implementation correctly throws StorageError.\n\nFix: Update test to expect thrown error.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:59:19.998534-06:00","updated_at":"2025-12-09T16:59:19.998534-06:00"}
{"id":"the-system-g0a","title":"Add xAI API client for grok-4-1-fast-reasoning","description":"Implement xAI API client for LLM reranking.\n\nReference: docs/plans/reranker-implementation.md (Section 9.1)\n\nEnvironment variables:\n- XAI_API_KEY: API key for xAI\n- LLM_RERANK_MODEL: grok-4-1-fast-reasoning\n\nClient requirements:\n- Async API calls\n- Rate limiting\n- Error handling and retries\n- Cost tracking per query\n\nLocation: packages/search-core/src/clients/xai-client.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:57:32.249662-06:00","updated_at":"2025-12-09T00:36:40.213062-06:00","closed_at":"2025-12-09T00:36:40.213062-06:00"}
{"id":"the-system-g0m","title":"Implement Wasm sandbox for code execution isolation","description":"The original Wassette (Wasm sandbox) concept is not implemented. Execution service operates directly on VFS without isolation. Need to integrate Wasmtime or similar, define capability-based permissions, enforce memory/CPU limits. Ref: define-wassette-runtime-configuration.md, develop-sandbox-security-policy.md","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-08T02:06:05.270576-06:00","updated_at":"2025-12-08T02:07:44.391937-06:00","closed_at":"2025-12-08T02:07:44.391937-06:00"}
{"id":"the-system-gct","title":"Add rate limiting for LLM reranker tier","description":"Hard limit: 100 LLM rerank requests/hour per user. Track cost attribution. Alert on budget exceeded.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T23:02:30.438042-06:00","updated_at":"2025-12-09T00:13:49.372619-06:00","closed_at":"2025-12-09T00:13:49.372619-06:00"}
{"id":"the-system-gln","title":"Add Test Coverage: packages/storage","description":"Add comprehensive unit and integration tests for packages/storage","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T01:51:16.737233-06:00","updated_at":"2025-12-07T02:00:51.894829-06:00","closed_at":"2025-12-07T02:00:51.894831-06:00","labels":["packages","storage","testing"]}
{"id":"the-system-hcz","title":"[EPIC] SearchRetriever Integration","description":"Integrate reranking into SearchRetriever pipeline.\n\nBounded Context: Retrieval Integration Domain\nReference: docs/plans/reranker-implementation.md (Section 4)\n\nThis is Phase 1 - the critical path to enable reranking.\n\nIntegration points:\n- Add rerank option to SearchQuery interface\n- Call reranker after hybrid search\n- Merge scores and return enriched results\n- Circuit breaker for latency protection\n\nThis epic wires everything together.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T22:57:41.084625-06:00","updated_at":"2025-12-08T23:54:29.159561-06:00","closed_at":"2025-12-08T23:54:29.159561-06:00","dependencies":[{"issue_id":"the-system-hcz","depends_on_id":"the-system-020","type":"blocks","created_at":"2025-12-08T23:02:46.137633-06:00","created_by":"daemon"}]}
{"id":"the-system-heq1","title":"Fix reranker-integration.test.ts assertion failures","description":"The reranker-integration.test.ts has failing assertions in search ranking tests. The hybrid search reranking logic is returning unexpected result ordering. Needs investigation into the scoring algorithm and expected vs actual rankings.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T18:24:23.346575-06:00","updated_at":"2025-12-09T18:24:23.346575-06:00"}
{"id":"the-system-hq0","title":"Write unit tests for ColBERTReranker","description":"Test MaxSim scoring, document encoding, multivector handling. File: packages/search-core/src/services/__tests__/colbert-reranker.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T23:01:45.580775-06:00","updated_at":"2025-12-08T23:59:20.604303-06:00","closed_at":"2025-12-08T23:59:20.604303-06:00"}
{"id":"the-system-i8q","title":"Implement score merging strategy","description":"Implement score merging for RRF + reranker scores.\n\nReference: docs/plans/reranker-implementation.md (Section 4.2)\n\nStrategy options:\n- Option A: Replace with reranker score\n- Option B: Weighted combination  \n- Option C: Rank-based (reranker ordering, preserve both scores)\n\nRecommendation: Use Option C\n- Reranker determines final ordering\n- Preserve both scores in response for transparency\n\nInterface:\n```typescript\ninterface MergedResult {\n  rrfScore: number;\n  rerankerScore: number;\n  finalScore: number;\n}\n```\n\nLocation: packages/search-core/src/services/score-merger.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:55:42.774178-06:00","updated_at":"2025-12-09T00:31:47.033528-06:00","closed_at":"2025-12-09T00:31:47.033528-06:00"}
{"id":"the-system-ipu","title":"Create useSearch hook for search API integration","description":"Create a React hook for search API integration with debouncing and SWR caching.\n\nReference: docs/plans/search-ui.md (Phase 3: API Integration)\n\nNew file: apps/interface/app/hooks/useSearch.ts\n\nInterface:\n- Input: query string, optional UseSearchOptions\n- Output: { results, isLoading, error }\n\nUseSearchOptions:\n- debounceMs: number (default 300) - prevent excessive API calls\n- limit: number (default 10) - max results to return\n- filters: { type?: 'thought' | 'code' | 'doc', session_id?: string }\n\nSearchResult shape (from Qdrant):\n- id: string\n- score: number\n- payload: { content, node_id, session_id, type, timestamp, file_path? }\n\nImplementation details:\n- Use SWR for caching and request deduplication (already in package.json)\n- Debounce query changes to avoid hammering API during typing\n- Call POST /api/search with { query, limit, filters }\n- Handle loading and error states\n- Return empty array when query is empty or too short (\u003c 2 chars)\n\nThe hook should be strategy-agnostic - the API route already defaults to hybrid search.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T21:38:43.503504-06:00","updated_at":"2025-12-08T21:53:58.042214-06:00","closed_at":"2025-12-08T21:53:58.042214-06:00","dependencies":[{"issue_id":"the-system-ipu","depends_on_id":"the-system-xr2","type":"blocks","created_at":"2025-12-08T21:38:51.000726-06:00","created_by":"daemon"}]}
{"id":"the-system-iqt","title":"Implement ColBERTReranker with MaxSim scoring","description":"Implement ColBERT reranker using late interaction scoring.\n\nReference: docs/plans/reranker-implementation.md (Section 3.2.3)\n\nMaxSim algorithm:\n- For each query token, compute similarity with every document token\n- Keep only max similarity per query token\n- Sum all token-level max scores into final relevance\n\nInterface:\n```typescript\nexport class ColBERTReranker {\n  // Fast query-time scoring using cached doc embeddings\n  async rerank(\n    query: string,\n    candidates: CachedDocumentCandidate[],\n    topK: number\n  ): Promise\u003cRerankResult[]\u003e;\n}\n```\n\nPerformance target: ~20ms for 30 docs (with precomputed)\n\nLocation: packages/search-core/src/services/colbert-reranker.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:56:37.210825-06:00","updated_at":"2025-12-09T00:36:41.953739-06:00","closed_at":"2025-12-09T00:36:41.953739-06:00","dependencies":[{"issue_id":"the-system-iqt","depends_on_id":"the-system-dkx","type":"blocks","created_at":"2025-12-08T23:03:10.407399-06:00","created_by":"daemon"}]}
{"id":"the-system-iv9","title":"Implement RerankerRouter class","description":"Implement RerankerRouter for query-based tier selection.\n\nReference: docs/plans/reranker-implementation.md (Section 3.2.1)\n\nInterface:\n```typescript\nexport type RerankerTier = \"fast\" | \"accurate\" | \"code\" | \"llm\";\n\nexport interface RerankerRoutingResult {\n  tier: RerankerTier;\n  reranker: string;\n  maxCandidates: number;\n  reason: string;\n}\n\nexport class RerankerRouter {\n  route(query: string, options: RoutingOptions): RerankerRoutingResult;\n}\n```\n\nRouting rules:\n- Code patterns (function(), class, =\u003e) ‚Üí code tier\n- Complex queries (\u003e50 chars, operators) ‚Üí accurate tier\n- Agentic patterns (tool, execute) ‚Üí accurate tier\n- Default ‚Üí fast tier\n\nLocation: packages/search-core/src/services/reranker-router.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:56:01.207548-06:00","updated_at":"2025-12-08T23:39:18.592562-06:00","closed_at":"2025-12-08T23:39:18.592562-06:00"}
{"id":"the-system-izg","title":"Implement GCS blob store adapter","description":"GCSBlobStore in storage/src/blob.ts is a stub with console.log only. Need to implement actual GCS operations using @google-cloud/storage for production blob storage. Ref: create-blob-storage-adapter.md","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T02:06:29.12036-06:00","updated_at":"2025-12-08T02:41:05.652671-06:00","closed_at":"2025-12-08T02:41:05.652671-06:00"}
{"id":"the-system-jle","title":"Add Test Coverage: packages/vfs","description":"Add comprehensive unit and integration tests for packages/vfs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T01:51:16.790893-06:00","updated_at":"2025-12-07T02:01:21.212578-06:00","closed_at":"2025-12-07T02:01:21.212578-06:00","labels":["packages","testing","vfs"]}
{"id":"the-system-jlk2","title":"Milestone 1: Basic Pipeline (MVP)","description":"Dataset loader, Session/Turn mapper, basic dense retrieval, simple reader, JSONL output","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T11:33:27.044808-06:00","updated_at":"2025-12-18T11:40:56.440985-06:00","closed_at":"2025-12-18T11:40:56.440985-06:00"}
{"id":"the-system-jpt","title":"Optimize batch graph pruning","description":"GraphPruner uses single-threaded deletion which may be slow on large graphs. Need to implement batched deletion with configurable batch sizes to avoid Redis timeouts. Ref: implement-graph-pruning-strategy.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T02:06:28.17326-06:00","updated_at":"2025-12-08T02:39:05.558051-06:00","closed_at":"2025-12-08T02:39:05.558051-06:00"}
{"id":"the-system-jzj","title":"[EPIC] Phase 4: Testing Infrastructure","description":"# Phase 4: Testing Infrastructure\n\n**Duration**: 5-7 days\n**Dependencies**: Phase 3 complete\n**Parallelization**: ALL tasks can run in parallel\n\n## Overview\nBuild comprehensive testing coverage:\n- Add critical missing unit tests\n- Create integration test infrastructure\n- Build test helpers and fixtures\n\n## Issue Summary\n- Testing gaps: 31\n- Current coverage: ~35%\n- Target coverage: \u003e80%\n- Critical untested files: 6\n\n## Success Criteria\n- [ ] Test coverage \u003e80%\n- [ ] All critical paths covered\n- [ ] Integration test helpers available\n- [ ] CI/CD test stage passing\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 536-569)\n- All app and package REPORT.md files (Testing sections)","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-09T03:36:26.81194-06:00","updated_at":"2025-12-09T04:39:13.083585-06:00","closed_at":"2025-12-09T04:39:13.083585-06:00","labels":["p0","refactoring","testing"],"dependencies":[{"issue_id":"the-system-jzj","depends_on_id":"the-system-5o4","type":"blocks","created_at":"2025-12-09T03:38:41.161771-06:00","created_by":"daemon"}]}
{"id":"the-system-jzj.1","title":"[4.1a] Add Tests: apps/execution/src/index.ts","description":"# Task 4.1a: Add Tests for apps/execution/src/index.ts\n\n**Effort**: 6 hours\n**Current Coverage**: 0%\n**Target Coverage**: 80%\n**Parallel**: Can run with all Phase 4 tasks\n\n## File Under Test\n`apps/execution/src/index.ts`\n\n## Test Cases to Write\n1. Kafka consumer initialization\n2. Message processing pipeline\n3. Tool execution flow\n4. Error handling and recovery\n5. Graceful shutdown\n6. Rehydration from graph\n\n## Mocking Requirements\n- KafkaClient (MessageClient interface)\n- FalkorClient (GraphClient interface)\n- Tool executors\n- Logger\n\n## Test File Location\n`apps/execution/src/__tests__/index.test.ts`\n\n## Acceptance Criteria\n- [ ] 80% coverage achieved\n- [ ] All happy paths tested\n- [ ] Error scenarios covered\n- [ ] Edge cases documented\n- [ ] Mocks properly typed\n\n## References\n- docs/refactor/WORK_ORDER.md (line 100)\n- docs/refactor/apps/execution/REPORT.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T03:37:04.649643-06:00","updated_at":"2025-12-09T04:39:05.499781-06:00","closed_at":"2025-12-09T04:39:05.499781-06:00","labels":["execution","parallel-ok","refactoring","testing"],"dependencies":[{"issue_id":"the-system-jzj.1","depends_on_id":"the-system-jzj","type":"parent-child","created_at":"2025-12-09T03:37:04.652031-06:00","created_by":"daemon"}]}
{"id":"the-system-jzj.2","title":"[4.1b] Add Tests: apps/memory/src/turn-aggregator.ts","description":"# Task 4.1b: Add Tests for TurnAggregator\n\n**Effort**: 8 hours\n**Current Coverage**: 0%\n**Target Coverage**: 80%\n**Parallel**: Can run with all Phase 4 tasks\n\n## File Under Test\n`apps/memory/src/turn-aggregator.ts`\n\n## Test Cases to Write\n1. Turn creation and aggregation\n2. Event processing (all 6 event types)\n3. Bitemporal timestamp handling\n4. Graph node/edge creation\n5. Session state management\n6. Error recovery\n7. Concurrent turn handling\n\n## Mocking Requirements\n- FalkorClient (GraphClient interface)\n- RedisPublisher\n- Logger\n- Clock for bitemporal testing\n\n## Test File Location\n`apps/memory/src/__tests__/turn-aggregator.test.ts`\n\n## Acceptance Criteria\n- [ ] 80% coverage achieved\n- [ ] All event types tested\n- [ ] Bitemporal logic verified\n- [ ] Concurrent scenarios tested\n- [ ] Graph operations mocked\n\n## References\n- docs/refactor/WORK_ORDER.md (line 101)\n- docs/refactor/apps/memory/REPORT.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T03:37:07.033035-06:00","updated_at":"2025-12-09T04:39:06.825922-06:00","closed_at":"2025-12-09T04:39:06.825922-06:00","labels":["memory","parallel-ok","refactoring","testing"],"dependencies":[{"issue_id":"the-system-jzj.2","depends_on_id":"the-system-jzj","type":"parent-child","created_at":"2025-12-09T03:37:07.033904-06:00","created_by":"daemon"}]}
{"id":"the-system-jzj.3","title":"[4.1c] Add Tests: packages/ingestion-core OpenAI Parser","description":"# Task 4.1c: Add Tests for OpenAI Parser\n\n**Effort**: 4 hours\n**Current Coverage**: 0%\n**Target Coverage**: 80%\n**Parallel**: Can run with all Phase 4 tasks\n\n## File Under Test\n`packages/ingestion-core/src/parser/openai.ts`\n\n## Test Cases to Write\n1. Standard completion parsing\n2. Streaming chunk handling\n3. Tool call parsing\n4. Function call parsing\n5. Usage statistics extraction\n6. Error event handling\n7. Malformed input handling\n\n## Test Fixtures Needed\n- Sample OpenAI API responses\n- Streaming chunk sequences\n- Tool call examples\n- Error responses\n\n## Test File Location\n`packages/ingestion-core/src/parser/__tests__/openai.test.ts`\n\n## Acceptance Criteria\n- [ ] 80% coverage achieved\n- [ ] All message types tested\n- [ ] Streaming scenarios covered\n- [ ] Error handling verified\n- [ ] Fixtures documented\n\n## References\n- docs/refactor/WORK_ORDER.md (line 102)\n- docs/refactor/packages/ingestion-core/REPORT.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T03:37:09.167631-06:00","updated_at":"2025-12-09T04:39:07.946701-06:00","closed_at":"2025-12-09T04:39:07.946701-06:00","labels":["ingestion-core","parallel-ok","refactoring","testing"],"dependencies":[{"issue_id":"the-system-jzj.3","depends_on_id":"the-system-jzj","type":"parent-child","created_at":"2025-12-09T03:37:09.16832-06:00","created_by":"daemon"}]}
{"id":"the-system-jzj.4","title":"[4.1d] Add Tests: packages/storage/src/redis.ts","description":"# Task 4.1d: Add Tests for Redis Storage\n\n**Effort**: 4 hours\n**Current Coverage**: 0%\n**Target Coverage**: 80%\n**Parallel**: Can run with all Phase 4 tasks\n\n## File Under Test\n`packages/storage/src/redis.ts`\n\n## Test Cases to Write\n1. Connection management\n2. Publish/subscribe operations\n3. Session update publishing\n4. Error handling\n5. Reconnection logic\n6. Graceful disconnect\n\n## Mocking Requirements\n- Redis client (ioredis)\n- Network errors\n- Timeout scenarios\n\n## Test File Location\n`packages/storage/src/__tests__/redis.test.ts`\n\n## Acceptance Criteria\n- [ ] 80% coverage achieved\n- [ ] Connection lifecycle tested\n- [ ] Pub/sub operations verified\n- [ ] Error scenarios covered\n- [ ] Reconnection tested\n\n## References\n- docs/refactor/WORK_ORDER.md (line 103)\n- docs/refactor/packages/storage/REPORT.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T03:37:10.768963-06:00","updated_at":"2025-12-09T04:39:08.925848-06:00","closed_at":"2025-12-09T04:39:08.925848-06:00","labels":["parallel-ok","refactoring","storage","testing"],"dependencies":[{"issue_id":"the-system-jzj.4","depends_on_id":"the-system-jzj","type":"parent-child","created_at":"2025-12-09T03:37:10.769474-06:00","created_by":"daemon"}]}
{"id":"the-system-jzj.5","title":"[4.1e] Add Tests: apps/interface graph-queries.ts","description":"# Task 4.1e: Add Tests for Graph Queries\n\n**Effort**: 6 hours\n**Current Coverage**: 0%\n**Target Coverage**: 80%\n**Parallel**: Can run with all Phase 4 tasks\n\n## File Under Test\n`apps/interface/lib/graph-queries.ts`\n\n## Test Cases to Write\n1. Session queries\n2. Turn queries\n3. Lineage graph construction\n4. Time-travel queries\n5. Search result formatting\n6. Error handling\n\n## Mocking Requirements\n- FalkorClient responses\n- Various graph structures\n- Edge cases (empty results, cycles)\n\n## Test File Location\n`apps/interface/lib/__tests__/graph-queries.test.ts`\n\n## Acceptance Criteria\n- [ ] 80% coverage achieved\n- [ ] All query types tested\n- [ ] Graph construction verified\n- [ ] Edge cases covered\n- [ ] Response formatting tested\n\n## References\n- docs/refactor/WORK_ORDER.md (line 104)\n- docs/refactor/apps/interface/REPORT.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T03:37:12.985069-06:00","updated_at":"2025-12-09T04:39:10.151148-06:00","closed_at":"2025-12-09T04:39:10.151148-06:00","labels":["interface","parallel-ok","refactoring","testing"],"dependencies":[{"issue_id":"the-system-jzj.5","depends_on_id":"the-system-jzj","type":"parent-child","created_at":"2025-12-09T03:37:12.985544-06:00","created_by":"daemon"}]}
{"id":"the-system-jzj.6","title":"[4.1f] Add Tests: apps/control ContextAssembler","description":"# Task 4.1f: Add Tests for ContextAssembler\n\n**Effort**: 4 hours\n**Current Coverage**: 0%\n**Target Coverage**: 80%\n**Parallel**: Can run with all Phase 4 tasks\n\n## File Under Test\n`apps/control/src/context/assembler.ts`\n\n## Test Cases to Write\n1. Context assembly from session\n2. Turn history retrieval\n3. Search context integration\n4. Token budget management\n5. Priority ordering\n6. Error handling (graph failures)\n\n## Mocking Requirements\n- SessionRepository\n- TurnRepository\n- SearchRetriever\n- Logger\n\n## Test File Location\n`apps/control/src/context/__tests__/assembler.test.ts`\n\n## Acceptance Criteria\n- [ ] 80% coverage achieved\n- [ ] Assembly logic tested\n- [ ] Token limits verified\n- [ ] Search integration tested\n- [ ] Error scenarios covered\n\n## References\n- docs/refactor/WORK_ORDER.md (line 105)\n- docs/refactor/apps/control/REPORT.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T03:37:14.809787-06:00","updated_at":"2025-12-09T04:39:11.131015-06:00","closed_at":"2025-12-09T04:39:11.131015-06:00","labels":["control","parallel-ok","refactoring","testing"],"dependencies":[{"issue_id":"the-system-jzj.6","depends_on_id":"the-system-jzj","type":"parent-child","created_at":"2025-12-09T03:37:14.810221-06:00","created_by":"daemon"}]}
{"id":"the-system-jzj.7","title":"[4.2] Create Integration Test Infrastructure","description":"# Task 4.2: Create Integration Test Infrastructure\n\n**Effort**: 8 hours\n**Dependencies**: Task 0.1 (@engram/common)\n**Parallel**: Can run with all Phase 4.1 tasks\n\n## Location\n`packages/common/src/testing/`\n\n## Utilities to Create\n\n### Test Factories\n```typescript\n// factories/falkor.ts\nexport function createTestFalkorClient(\n  responses?: Map\u003cstring, unknown[]\u003e\n): MockGraphClient {\n  return new MockGraphClient(responses);\n}\n\n// factories/kafka.ts\nexport function createTestKafkaClient(\n  messages?: unknown[]\n): MockMessageClient {\n  return new MockMessageClient(messages);\n}\n\n// factories/redis.ts\nexport function createTestRedisPublisher(): MockRedisPublisher {\n  return new MockRedisPublisher();\n}\n```\n\n### Test Fixtures\n```typescript\n// fixtures/sessions.ts\nexport const testSession: Session = {\n  id: 'test-session-1',\n  externalId: 'ext-123',\n  startTime: new Date('2024-01-01'),\n  // ...\n};\n\n// fixtures/turns.ts\nexport const testTurn: Turn = {\n  id: 'test-turn-1',\n  sessionId: 'test-session-1',\n  // ...\n};\n```\n\n### Test Helpers\n```typescript\n// helpers/time.ts\nexport function withFrozenTime\u003cT\u003e(\n  time: Date,\n  fn: () =\u003e T\n): T {\n  // Mock Date.now() for bitemporal testing\n}\n\n// helpers/graph.ts\nexport function buildTestGraph(\n  nodes: Node[],\n  edges: Edge[]\n): GraphSnapshot {\n  // Build test graph structure\n}\n```\n\n## Acceptance Criteria\n- [ ] All mock clients created\n- [ ] Common fixtures defined\n- [ ] Time helpers working\n- [ ] Graph helpers working\n- [ ] Exported from @engram/common\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 555-569)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T03:37:16.569248-06:00","updated_at":"2025-12-09T04:39:12.290691-06:00","closed_at":"2025-12-09T04:39:12.290691-06:00","labels":["infrastructure","parallel-ok","refactoring","testing"],"dependencies":[{"issue_id":"the-system-jzj.7","depends_on_id":"the-system-jzj","type":"parent-child","created_at":"2025-12-09T03:37:16.569882-06:00","created_by":"daemon"},{"issue_id":"the-system-jzj.7","depends_on_id":"the-system-wai.1","type":"blocks","created_at":"2025-12-09T03:39:05.037477-06:00","created_by":"daemon"}]}
{"id":"the-system-kdkp","title":"Fix port conflicts in search-core tests (5001, 5002)","description":"Tests in search-core fail with EADDRINUSE on ports 5001 and 5002. The test setup/teardown is not properly cleaning up server instances, or tests are running in parallel without isolated port assignments. Need to either use dynamic port allocation or ensure proper cleanup between test suites.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T18:24:27.307264-06:00","updated_at":"2025-12-09T18:24:27.307264-06:00"}
{"id":"the-system-kdx","title":"Create SearchInput component with UUID detection","description":"Create a smart search input that detects UUIDs vs natural language queries.\n\nReference: docs/plans/search-ui.md (Phase 1: SearchInput Component)\n\nNew file: apps/interface/app/components/SearchInput.tsx\n\nFeatures:\n- Single input field replacing the current UUID-only input on homepage\n- Placeholder: \"Search thoughts, code, or enter session UUID...\"\n- UUID detection: regex /^[0-9a-f-]{36}$/i triggers \"Go to session\" mode\n- Natural language: triggers search mode after debounce\n\nComponent state:\n- query: string - current input value\n- mode: 'idle' | 'uuid' | 'search' - determined by input pattern\n\nProps:\n- onSearch: (query: string) =\u003e void - callback when search should execute\n- onNavigateSession: (sessionId: string) =\u003e void - callback for UUID navigation\n\nVisual design (matching existing glassmorphism):\n- Background: rgba(15, 20, 30, 0.7)\n- Border: 1px solid rgba(100, 116, 139, 0.25)\n- Focus border: rgba(0, 245, 212, 0.4) (cyan accent)\n- Focus glow: box-shadow with cyan\n- Font: JetBrains Mono, 13px\n- Search icon: lucide-react Search icon, rgb(148, 163, 184)\n\nKeyboard shortcuts:\n- \"/\" focuses the input (global listener)\n- Enter with UUID navigates to session\n- Enter with search query is optional (search is live)\n\nThis component is UI-only and does not call the API directly - it uses callbacks.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T21:39:06.939115-06:00","updated_at":"2025-12-08T21:53:40.195809-06:00","closed_at":"2025-12-08T21:53:40.195809-06:00"}
{"id":"the-system-kl6","title":"[EPIC] LLM Listwise Reranking","description":"LLM-based listwise reranking for premium queries.\n\nBounded Context: LLM Reranking Domain\nReference: docs/plans/reranker-implementation.md (Section 3.2.4, Phase 4)\n\nUses grok-4-1-fast-reasoning via xAI API for:\n- Listwise comparison ranking\n- Complex reasoning queries\n- High-stakes search results\n\nAdvantages over pointwise:\n- Sees all candidates in context\n- Can make relative comparisons\n- Better for complex reasoning queries\n\nReserved for premium tier due to cost/latency.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T22:57:06.019306-06:00","updated_at":"2025-12-09T00:36:40.318197-06:00","closed_at":"2025-12-09T00:36:40.318197-06:00","dependencies":[{"issue_id":"the-system-kl6","depends_on_id":"the-system-bkj","type":"blocks","created_at":"2025-12-08T23:02:50.403079-06:00","created_by":"daemon"}]}
{"id":"the-system-l1c","title":"HIGH: Cypher injection via limit parameter interpolation","description":"Locations:\n- apps/interface/app/api/graphql/schema.ts:88,129\n- apps/interface/lib/graph-queries.ts:479\n- apps/control/src/context/assembler.ts:117-124\n- apps/memory/src/index.ts:406-411\n\nUser-controlled limit parameters are directly interpolated into Cypher queries without sanitization, enabling potential injection attacks.\n\nFix: Use parameterized queries for all values including LIMIT and SKIP.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:56:16.308652-06:00","updated_at":"2025-12-09T16:56:16.308652-06:00"}
{"id":"the-system-lfsd","title":"Milestone 4: Full Evaluation","description":"GPT-4o QA evaluation integration, per-category metrics breakdown, retrieval recall/NDCG computation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T11:33:46.465895-06:00","updated_at":"2025-12-18T12:33:05.083667-06:00","closed_at":"2025-12-18T12:33:05.083667-06:00","dependencies":[{"issue_id":"the-system-lfsd","depends_on_id":"the-system-ypub","type":"blocks","created_at":"2025-12-18T11:34:17.902632-06:00","created_by":"ccheney"}]}
{"id":"the-system-lutl","title":"LOW: XState actor never stopped - resource leak","description":"Location: apps/control/src/engine/decision.ts:224-226\n\nThe DecisionEngine has a start() method but no stop() method. XState actors maintain internal subscriptions that are never cleaned up.\n\nFix: Add stop() method that calls this.actor.stop().","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:59:41.753666-06:00","updated_at":"2025-12-09T16:59:41.753666-06:00"}
{"id":"the-system-lwe","title":"Update ScoreBar to show REL vs RRF based on rerank status","description":"Update score bar component to differentiate reranked vs non-reranked results.\n\nReference: docs/plans/reranker-implementation.md (Section 8.1)\n\nImplementation:\n```typescript\nfunction ScoreBar({ result }: { result: SearchResult }) {\n  const hasRerank = result.rerankerScore !== undefined;\n\n  return (\n    \u003cdiv\u003e\n      {hasRerank ? (\n        \u003c\u003e\n          \u003cspan title=\"Cross-encoder relevance score\"\u003eREL\u003c/span\u003e\n          \u003cBar score={result.rerankerScore} /\u003e\n          \u003cspan\u003e{Math.round(result.rerankerScore * 100)}%\u003c/span\u003e\n        \u003c/\u003e\n      ) : (\n        \u003c\u003e\n          \u003cspan title=\"Reciprocal Rank Fusion score\"\u003eRRF\u003c/span\u003e\n          \u003cBar score={result.rrfScore} /\u003e\n          \u003cspan\u003e{Math.round(result.rrfScore * 100)}%\u003c/span\u003e\n        \u003c/\u003e\n      )}\n    \u003c/div\u003e\n  );\n}\n```\n\nLocation: apps/interface/app/components/SearchResults.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:58:51.034902-06:00","updated_at":"2025-12-08T23:21:34.595427-06:00","closed_at":"2025-12-08T23:21:34.595427-06:00"}
{"id":"the-system-mcb","title":"Implement context assembly for agent loops","description":"The ContextAssembler in control/src/context/assembler.ts returns hardcoded 'System: You are Engram.' instead of assembling actual context. Need to: query search service for relevant memories, fetch recent session history, implement sliding window with token counting. Ref: implement-context-window-manager.md","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-08T02:05:39.422099-06:00","updated_at":"2025-12-08T02:17:41.692016-06:00","closed_at":"2025-12-08T02:17:41.692016-06:00","dependencies":[{"issue_id":"the-system-mcb","depends_on_id":"the-system-q20","type":"blocks","created_at":"2025-12-08T02:06:47.444388-06:00","created_by":"daemon"}]}
{"id":"the-system-mgk","title":"[EPIC] Caching \u0026 Optimization","description":"Document representation caching, query result caching, and async reranking (Phase 5)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T23:01:27.738605-06:00","updated_at":"2025-12-09T00:24:42.010535-06:00","closed_at":"2025-12-09T00:24:42.010535-06:00","dependencies":[{"issue_id":"the-system-mgk","depends_on_id":"the-system-hcz","type":"blocks","created_at":"2025-12-08T23:03:06.001547-06:00","created_by":"daemon"}]}
{"id":"the-system-ml6","title":"Integrate search components into homepage","description":"Integrate SearchInput and SearchResults into the homepage, replacing the UUID-only input.\n\nReference: docs/plans/search-ui.md (Phase 4: Homepage Integration)\n\nModified file: apps/interface/app/page.tsx\n\nChanges:\n1. Remove the existing UUID input form (lines 326-381)\n2. Add SearchInput component in its place\n3. Add state to track current search query and results\n4. Wire up useSearch hook with the query\n5. Conditionally render:\n   - SearchResults when query has results\n   - SessionBrowser when query is empty (current behavior)\n6. Add global \"/\" keyboard shortcut to focus search input\n\nState to add:\n- searchQuery: string\n- Pass to useSearch hook\n- Pass to SearchInput as controlled input\n\nLayout flow:\n- Header (unchanged)\n- SearchInput (new, replaces UUID form)\n- SearchResults OR SessionBrowser (conditional)\n- Footer (unchanged)\n\nBehavior:\n- Page loads: shows SessionBrowser (existing behavior)\n- User types search: shows SearchResults after debounce\n- User clears search: returns to SessionBrowser\n- User enters UUID: navigates to session (existing behavior)\n\nImport new components:\n- import { SearchInput } from \"./components/SearchInput\"\n- import { SearchResults } from \"./components/SearchResults\"\n- import { useSearch } from \"./hooks/useSearch\"\n\nDepends on: SearchInput, SearchResults, and useSearch hook must all be complete.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T21:39:36.624523-06:00","updated_at":"2025-12-08T21:53:58.081378-06:00","closed_at":"2025-12-08T21:53:58.081378-06:00","dependencies":[{"issue_id":"the-system-ml6","depends_on_id":"the-system-kdx","type":"blocks","created_at":"2025-12-08T21:39:44.930567-06:00","created_by":"daemon"},{"issue_id":"the-system-ml6","depends_on_id":"the-system-2a6","type":"blocks","created_at":"2025-12-08T21:39:44.961809-06:00","created_by":"daemon"},{"issue_id":"the-system-ml6","depends_on_id":"the-system-ipu","type":"blocks","created_at":"2025-12-08T21:39:44.991398-06:00","created_by":"daemon"}]}
{"id":"the-system-mvx","title":"Update memory app ingestion to create Turn/Reasoning/FileTouch nodes","description":"Modify apps/memory to aggregate tokens into Turns, extract reasoning blocks, track file touches","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T03:13:57.810188-06:00","updated_at":"2025-12-08T03:24:06.494292-06:00","closed_at":"2025-12-08T03:24:06.494292-06:00","dependencies":[{"issue_id":"the-system-mvx","depends_on_id":"the-system-nob","type":"blocks","created_at":"2025-12-08T03:14:04.631055-06:00","created_by":"daemon"}]}
{"id":"the-system-mwbx","title":"Milestone 5: CI/CD and Reporting","description":"Automated benchmark runs, historical score tracking, regression detection","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T11:33:53.022111-06:00","updated_at":"2025-12-18T12:40:47.886005-06:00","closed_at":"2025-12-18T12:40:47.886005-06:00","dependencies":[{"issue_id":"the-system-mwbx","depends_on_id":"the-system-lfsd","type":"blocks","created_at":"2025-12-18T11:34:24.03805-06:00","created_by":"ccheney"}]}
{"id":"the-system-n7y","title":"Bounded Context: Bitemporal Memory","description":"The 'Hippocampus'. Manages the knowledge graph, bitemporal logic, and persistence. See docs/bitemporal/context/bitemporal-memory/","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:47:42.394915-06:00","updated_at":"2025-12-06T22:33:15.150169-06:00","closed_at":"2025-12-06T22:33:15.150172-06:00","labels":["context","falkordb","memory"]}
{"id":"the-system-n7y.1","title":"Define FalkorDB Project Structure","description":"Setup packages/memory-core and apps/memory structure. See docs/bitemporal/context/bitemporal-memory/define-falkordb-project-structure.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:50:33.03288-06:00","updated_at":"2025-12-06T22:16:45.364281-06:00","closed_at":"2025-12-06T22:16:45.364284-06:00","labels":["memory","redis","structure"],"dependencies":[{"issue_id":"the-system-n7y.1","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.033279-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.10","title":"Define Snapshot Node Schema","description":"Zod schema for SnapshotNode (VFS state). See docs/bitemporal/context/bitemporal-memory/define-snapshot-node-schema.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:50:33.414833-06:00","updated_at":"2025-12-06T22:18:30.865325-06:00","closed_at":"2025-12-06T22:18:30.865327-06:00","labels":["memory","schema","zod"],"dependencies":[{"issue_id":"the-system-n7y.10","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.415209-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.11","title":"Define Standard Edge Schemas","description":"Zod schemas for NEXT, TRIGGERS, MODIFIES, etc. See docs/bitemporal/context/bitemporal-memory/define-standard-edge-schemas.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:50:33.459816-06:00","updated_at":"2025-12-06T22:18:30.892083-06:00","closed_at":"2025-12-06T22:18:30.892085-06:00","labels":["memory","schema","zod"],"dependencies":[{"issue_id":"the-system-n7y.11","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.460217-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.12","title":"Implement FalkorDB Connection Manager","description":"Redis client wrapper ensuring graph module is loaded. See docs/bitemporal/context/bitemporal-memory/implement-falkordb-connection-manager.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:50:33.502096-06:00","updated_at":"2025-12-06T22:16:16.310596-06:00","closed_at":"2025-12-06T22:16:16.310599-06:00","labels":["infrastructure","memory","redis"],"dependencies":[{"issue_id":"the-system-n7y.12","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.502466-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.13","title":"Develop Bitemporal Query Builder","description":"Fluent API to inject temporal WHERE clauses into Cypher. See docs/bitemporal/context/bitemporal-memory/develop-bitemporal-query-builder.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:50:33.547233-06:00","updated_at":"2025-12-06T22:25:41.607896-06:00","closed_at":"2025-12-06T22:25:41.607899-06:00","labels":["builder","cypher","memory"],"dependencies":[{"issue_id":"the-system-n7y.13","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.547662-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.14","title":"Create Blob Storage Adapter","description":"Adapter for offloading large text to FS/GCS. See docs/bitemporal/context/bitemporal-memory/create-blob-storage-adapter.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:50:33.590197-06:00","updated_at":"2025-12-06T22:25:00.383421-06:00","closed_at":"2025-12-06T22:25:00.383424-06:00","labels":["blob","memory","storage"],"dependencies":[{"issue_id":"the-system-n7y.14","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.590608-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.15","title":"Implement Graph Node Writer","description":"Service to write nodes with current transaction time. See docs/bitemporal/context/bitemporal-memory/implement-graph-node-writer.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:50:33.633077-06:00","updated_at":"2025-12-06T22:25:22.979015-06:00","closed_at":"2025-12-06T22:25:22.979018-06:00","labels":["cypher","memory","writer"],"dependencies":[{"issue_id":"the-system-n7y.15","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.63344-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.16","title":"Implement Graph Edge Writer","description":"Service to write edges with temporal props. See docs/bitemporal/context/bitemporal-memory/implement-graph-edge-writer.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:50:33.676429-06:00","updated_at":"2025-12-06T22:25:23.009856-06:00","closed_at":"2025-12-06T22:25:23.009858-06:00","labels":["cypher","memory","writer"],"dependencies":[{"issue_id":"the-system-n7y.16","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.676784-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.17","title":"Implement Transaction Time Logic","description":"Logic for 'Correction' (Append-Only + REPLACES edge). See docs/bitemporal/context/bitemporal-memory/implement-transaction-time-logic.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:50:33.718919-06:00","updated_at":"2025-12-06T22:26:05.365755-06:00","closed_at":"2025-12-06T22:26:05.365759-06:00","labels":["logic","memory","temporal"],"dependencies":[{"issue_id":"the-system-n7y.17","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.719335-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.18","title":"Implement Valid Time Logic","description":"Support for inserting facts with custom valid-time windows. See docs/bitemporal/context/bitemporal-memory/implement-valid-time-logic.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T21:50:33.761664-06:00","updated_at":"2025-12-06T22:26:05.395849-06:00","closed_at":"2025-12-06T22:26:05.395851-06:00","labels":["logic","memory","temporal"],"dependencies":[{"issue_id":"the-system-n7y.18","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.762095-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.19","title":"Create Graphiti MCP Server Wrapper","description":"Expose memory capabilities via MCP (read_graph, search). See docs/bitemporal/context/bitemporal-memory/create-graphiti-mcp-server-wrapper.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:50:33.807801-06:00","updated_at":"2025-12-06T22:26:39.91986-06:00","closed_at":"2025-12-06T22:26:39.919864-06:00","labels":["api","mcp","memory"],"dependencies":[{"issue_id":"the-system-n7y.19","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.808232-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.2","title":"Implement Bitemporal Timestamp Logic","description":"Time utility for vt_start/end and tt_start/end logic. See docs/bitemporal/context/bitemporal-memory/implement-bitemporal-timestamp-logic.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:50:33.075239-06:00","updated_at":"2025-12-06T22:16:45.395585-06:00","closed_at":"2025-12-06T22:16:45.395588-06:00","labels":["logic","memory","temporal"],"dependencies":[{"issue_id":"the-system-n7y.2","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.075584-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.20","title":"Implement Graph Pruning Strategy","description":"Cron job to retire old transaction history to cold storage. See docs/bitemporal/context/bitemporal-memory/implement-graph-pruning-strategy.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T21:50:33.849582-06:00","updated_at":"2025-12-06T23:57:25.889551-06:00","closed_at":"2025-12-06T23:57:25.889554-06:00","labels":["maintenance","memory","pruning"],"dependencies":[{"issue_id":"the-system-n7y.20","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.850043-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.21","title":"Develop Node Merging Logic","description":"SAME_AS edge logic for entity resolution. See docs/bitemporal/context/bitemporal-memory/develop-node-merging-logic.md","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-06T21:50:33.892839-06:00","updated_at":"2025-12-07T01:19:13.419722-06:00","closed_at":"2025-12-07T01:19:13.419722-06:00","labels":["logic","memory","merge"],"dependencies":[{"issue_id":"the-system-n7y.21","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.893204-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.3","title":"Define Base Node Model","description":"Zod schema for BaseNode with ULID and Bitemporal fields. See docs/bitemporal/context/bitemporal-memory/define-base-node-model.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:50:33.118314-06:00","updated_at":"2025-12-06T22:16:45.426165-06:00","closed_at":"2025-12-06T22:16:45.426168-06:00","labels":["memory","schema","zod"],"dependencies":[{"issue_id":"the-system-n7y.3","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.118687-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.4","title":"Define Session Node Schema","description":"Zod schema for SessionNode. See docs/bitemporal/context/bitemporal-memory/define-session-node-schema.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:50:33.159325-06:00","updated_at":"2025-12-06T22:18:30.693834-06:00","closed_at":"2025-12-06T22:18:30.693836-06:00","labels":["memory","schema","zod"],"dependencies":[{"issue_id":"the-system-n7y.4","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.159681-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.5","title":"Define Thought Node Schema","description":"Zod schema for ThoughtNode including blob_ref. See docs/bitemporal/context/bitemporal-memory/define-thought-node-schema.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:50:33.203394-06:00","updated_at":"2025-12-06T22:18:30.724025-06:00","closed_at":"2025-12-06T22:18:30.724027-06:00","labels":["memory","schema","zod"],"dependencies":[{"issue_id":"the-system-n7y.5","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.203771-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.6","title":"Define ToolCall Node Schema","description":"Zod schema for ToolCallNode. See docs/bitemporal/context/bitemporal-memory/define-tool-call-node-schema.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:50:33.243789-06:00","updated_at":"2025-12-06T22:18:30.751905-06:00","closed_at":"2025-12-06T22:18:30.751907-06:00","labels":["memory","schema","zod"],"dependencies":[{"issue_id":"the-system-n7y.6","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.244099-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.7","title":"Define CodeArtifact Node Schema","description":"Zod schema for CodeArtifactNode. See docs/bitemporal/context/bitemporal-memory/define-code-artifact-node-schema.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:50:33.288416-06:00","updated_at":"2025-12-06T22:18:30.780785-06:00","closed_at":"2025-12-06T22:18:30.780787-06:00","labels":["memory","schema","zod"],"dependencies":[{"issue_id":"the-system-n7y.7","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.288799-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.8","title":"Define DiffHunk Node Schema","description":"Zod schema for DiffHunkNode. See docs/bitemporal/context/bitemporal-memory/define-diff-hunk-node-schema.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:50:33.330499-06:00","updated_at":"2025-12-06T22:18:30.807635-06:00","closed_at":"2025-12-06T22:18:30.807637-06:00","labels":["memory","schema","zod"],"dependencies":[{"issue_id":"the-system-n7y.8","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.33086-06:00","created_by":"daemon"}]}
{"id":"the-system-n7y.9","title":"Define Observation Node Schema","description":"Zod schema for ObservationNode. See docs/bitemporal/context/bitemporal-memory/define-observation-node-schema.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:50:33.372577-06:00","updated_at":"2025-12-06T22:18:30.835869-06:00","closed_at":"2025-12-06T22:18:30.835872-06:00","labels":["memory","schema","zod"],"dependencies":[{"issue_id":"the-system-n7y.9","depends_on_id":"the-system-n7y","type":"parent-child","created_at":"2025-12-06T21:50:33.372993-06:00","created_by":"daemon"}]}
{"id":"the-system-nob","title":"Update edge types for new hierarchy","description":"Add HAS_TURN, CONTAINS, TOUCHES edges. Session‚ÜíTurn‚ÜíReasoning/FileTouch hierarchy","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T03:13:56.705827-06:00","updated_at":"2025-12-08T03:19:20.848304-06:00","closed_at":"2025-12-08T03:19:20.848304-06:00","dependencies":[{"issue_id":"the-system-nob","depends_on_id":"the-system-3sh","type":"blocks","created_at":"2025-12-08T03:14:04.593217-06:00","created_by":"daemon"}]}
{"id":"the-system-nr2u","title":"MEDIUM: Missing flush() method for unclosed tags in extractors","description":"Location: packages/ingestion-core/src/extractors/base.ts\n\nIf a stream ends while inside a block (after open tag but before close tag), buffered content is never flushed. No flush() or finalize() method exists.\n\nImpact: Content is lost in truncated streams or dropped connections.\n\nFix: Add flush() method to retrieve remaining buffered content.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:58:24.102028-06:00","updated_at":"2025-12-09T16:58:24.102028-06:00"}
{"id":"the-system-nsh","title":"Add search settings panel for reranker configuration","description":"","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-08T23:44:10.003249-06:00","updated_at":"2025-12-09T00:08:26.75304-06:00","closed_at":"2025-12-09T00:08:26.75304-06:00"}
{"id":"the-system-nxc","title":"Implement Custom Logger Package","description":"Refactor @the-soul/logger to match the provided reference implementation using pino, redaction, and structured logging. Ensure all apps use it.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T01:06:06.999517-06:00","updated_at":"2025-12-07T01:08:37.608613-06:00","closed_at":"2025-12-07T01:08:37.608613-06:00"}
{"id":"the-system-o9x","title":"MEDIUM: Unbounded session engine cache - memory leak","description":"Location: apps/control/src/session/manager.ts:27,78-82\n\nThe SessionManager stores DecisionEngine instances in a Map keyed by session ID but never removes them. Each engine contains an XState actor with subscriptions and event listeners.\n\nImpact: Memory leak, eventual OOM crash for long-running service.\n\nFix: Implement session timeout/cleanup mechanism.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:56:59.330219-06:00","updated_at":"2025-12-09T16:56:59.330219-06:00"}
{"id":"the-system-oan","title":"Evaluate Hugging Face models for sparse embeddings","description":"Investigate using Hugging Face's SPLADE or other sparse embedding models via transformers.js as an alternative to the current BM25 implementation. Current BM25Sparse uses simple TF-based scoring without IDF. Consider: 1) SPLADE models for learned sparse embeddings 2) FastEmbed integration if available for JS 3) Proper vocabulary-based tokenization instead of hash-based indexing. Ref: text-embedder.ts BM25Sparse class","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T02:15:39.264419-06:00","updated_at":"2025-12-08T02:49:37.421264-06:00","closed_at":"2025-12-08T02:49:37.421264-06:00"}
{"id":"the-system-onc","title":"HIGH: Rate limiter uses cumulative cost instead of per-request","description":"Location: packages/search-core/src/services/llm-reranker.ts:200-202\n\nThe cost used for rate limiting is the cumulative total cost, not the cost of the current request. getTotalCost() returns the total cost since the client was created.\n\nImpact: Rate limiting/budget tracking is fundamentally broken - records increasingly large costs over time.\n\nFix: Track per-request cost instead of cumulative total.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:56:21.786467-06:00","updated_at":"2025-12-09T16:56:21.786467-06:00"}
{"id":"the-system-otm","title":"Wire reranker call into SearchRetriever.search()","description":"Integrate reranking stage into SearchRetriever.search() method.\n\nReference: docs/plans/reranker-implementation.md (Section 4.1)\n\nUpdated flow:\n```typescript\nasync search(query: SearchQuery): Promise\u003cSearchResult[]\u003e {\n  // 1. Query classification (existing)\n  const classification = this.classifier.classify(query.text);\n\n  // 2. Hybrid retrieval - OVERSAMPLE\n  const rerankDepth = query.rerankDepth ?? 30;\n  const rawResults = await this.hybridSearch(query.text, rerankDepth, filters);\n\n  // 3. NEW: Reranking stage\n  if (query.rerank !== false) {\n    const tier = query.rerankTier ?? this.router.route(query.text, { classification });\n    const reranker = this.getReranker(tier);\n\n    const reranked = await reranker.rerank(\n      query.text,\n      rawResults.map(r =\u003e r.payload.content),\n      query.limit ?? 10\n    );\n\n    return this.mergeScores(rawResults, reranked);\n  }\n\n  return rawResults.slice(0, query.limit);\n}\n```\n\nLocation: packages/search-core/src/services/retriever.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:58:02.323205-06:00","updated_at":"2025-12-08T23:08:03.264261-06:00","closed_at":"2025-12-08T23:08:03.264261-06:00","dependencies":[{"issue_id":"the-system-otm","depends_on_id":"the-system-1cg","type":"blocks","created_at":"2025-12-08T23:03:25.392307-06:00","created_by":"daemon"}]}
{"id":"the-system-p4j","title":"Write unit tests for BatchedReranker","description":"Test batch processing, latency budgets, concurrent processing. File: packages/search-core/src/services/__tests__/batched-reranker.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T23:01:43.01757-06:00","updated_at":"2025-12-08T23:54:54.934973-06:00","closed_at":"2025-12-08T23:54:54.934973-06:00"}
{"id":"the-system-padn","title":"LOW: GraphPruner DELETE without DETACH will fail","description":"Location: packages/memory-core/src/pruner.ts:91-96\n\nThe pruner's delete query uses 'DELETE n' without 'DETACH', which will fail in FalkorDB if the nodes have relationships.\n\nFix: Change to 'DETACH DELETE n'.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:58:50.125276-06:00","updated_at":"2025-12-09T16:58:50.125276-06:00"}
{"id":"the-system-pcy8","title":"LOW: Timeout memory leak in retriever createTimeout","description":"Location: packages/search-core/src/services/retriever.ts:17-21\n\nThe createTimeout function creates a timer that is never cleared when reranking succeeds. Timer continues until it fires (then ignored).\n\nFix: Use AbortController pattern or return cleanup function.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:59:19.327997-06:00","updated_at":"2025-12-09T16:59:19.327997-06:00"}
{"id":"the-system-pel","title":"Implement RERANK_CONFIG runtime configuration","description":"Implement runtime configuration for reranking.\n\nReference: docs/plans/reranker-implementation.md (Section 9.2)\n\nConfiguration structure:\n```typescript\nexport const RERANK_CONFIG = {\n  enabled: true,\n  defaultTier: \"fast\" as RerankerTier,\n\n  tiers: {\n    fast: {\n      model: \"Xenova/ms-marco-MiniLM-L-6-v2\",\n      maxLatencyMs: 50,\n      batchSize: 16,\n    },\n    accurate: {\n      model: \"Xenova/bge-reranker-base\",\n      maxLatencyMs: 150,\n      batchSize: 8,\n    },\n    code: {\n      model: \"jinaai/jina-reranker-v2-base-multilingual\",\n      maxLatencyMs: 150,\n      batchSize: 8,\n    },\n    llm: {\n      model: \"grok-4-1-fast-reasoning\",\n      maxLatencyMs: 2000,\n      maxCandidates: 10,\n    },\n  },\n\n  routing: {\n    codePatterns: [/\\w+\\.\\w+\\(/, /function\\s+\\w+/, /class\\s+\\w+/],\n    complexThreshold: 50,\n    agenticPatterns: [/tool|function|call|execute/i],\n  },\n\n  cache: {\n    queryResultTTL: 300,\n    documentRepresentationTTL: 3600,\n    maxCacheSize: 1024 * 1024 * 1024,\n  },\n};\n```\n\nLocation: packages/search-core/src/config.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:59:29.618242-06:00","updated_at":"2025-12-08T23:32:07.760324-06:00","closed_at":"2025-12-08T23:32:07.760324-06:00"}
{"id":"the-system-psts","title":"LongMemEval Benchmark Adapter","description":"","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-18T11:33:01.4785-06:00","updated_at":"2025-12-18T12:40:54.397026-06:00","closed_at":"2025-12-18T12:40:54.397026-06:00"}
{"id":"the-system-q00","title":"Add reranking environment variables","description":"Add environment variables for reranking configuration.\n\nReference: docs/plans/reranker-implementation.md (Section 9.1)\n\nEnvironment variables:\n```bash\n# Reranking configuration\nRERANK_ENABLED=true\nRERANK_DEFAULT_TIER=fast\nRERANK_DEPTH=30\nRERANK_TIMEOUT_MS=500\n\n# Model paths (for custom/local models)\nRERANK_MODEL_FAST=Xenova/ms-marco-MiniLM-L-6-v2\nRERANK_MODEL_ACCURATE=Xenova/bge-reranker-base\nRERANK_MODEL_CODE=jinaai/jina-reranker-v2-base-multilingual\nRERANK_MODEL_COLBERT=jinaai/jina-colbert-v2\n\n# LLM reranking (premium)\nLLM_RERANK_ENABLED=false\nLLM_RERANK_MODEL=grok-4-1-fast-reasoning\nLLM_RERANK_MAX_CANDIDATES=10\nXAI_API_KEY=your-xai-api-key\n```\n\nUpdate .env.example with all variables.\n\nLocation: .env.example, apps/search/.env.example","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:59:18.382605-06:00","updated_at":"2025-12-08T23:26:47.345666-06:00","closed_at":"2025-12-08T23:26:47.345666-06:00"}
{"id":"the-system-q20","title":"Implement sparse vector embeddings for hybrid search","description":"The embedSparse() method in search-core/services/text-embedder.ts returns empty {indices: [], values: []}. This makes hybrid search effectively dense-only. Need to implement SPLADE or BM25 sparse embeddings. Ref: TSD 3.3.1, docs/report/feature-parity-analysis.md","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-08T02:05:37.416913-06:00","updated_at":"2025-12-08T02:13:54.163104-06:00","closed_at":"2025-12-08T02:13:54.163104-06:00"}
{"id":"the-system-q4d","title":"[EPIC] Observability \u0026 Metrics","description":"Prometheus metrics, structured logging, and dashboards for reranking performance (Section 11)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-08T23:01:26.84727-06:00","updated_at":"2025-12-08T23:58:39.524708-06:00","closed_at":"2025-12-08T23:58:39.524708-06:00","dependencies":[{"issue_id":"the-system-q4d","depends_on_id":"the-system-hcz","type":"blocks","created_at":"2025-12-08T23:03:04.506242-06:00","created_by":"daemon"}]}
{"id":"the-system-qgf","title":"Refactor Path Aliases","description":"Configure tsconfig paths (@/* or specific aliases) for all apps and packages to simplify imports.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T00:53:12.853766-06:00","updated_at":"2025-12-07T00:57:10.48543-06:00","closed_at":"2025-12-07T00:57:10.48543-06:00"}
{"id":"the-system-qrm","title":"HIGH: Cypher injection in GraphWriter label/relationType","description":"Location: packages/memory-core/src/graph.ts:19,39\n\nThe GraphWriter class constructs Cypher queries by directly interpolating the label and relationType parameters into query strings without sanitization.\n\nExample exploitation:\nwriter.writeNode('Session} DETACH DELETE (n) WITH n CREATE (n:Evil', data);\n\nFix: Validate label/type strings against a regex like /^[A-Za-z_][A-Za-z0-9_]*$/","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:56:17.363826-06:00","updated_at":"2025-12-09T16:56:17.363826-06:00"}
{"id":"the-system-qs2","title":"Redesign Soul System Interface with distinctive aesthetic","description":"","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-07T02:37:33.885606-06:00","updated_at":"2025-12-08T02:59:44.97476-06:00","closed_at":"2025-12-08T02:59:44.97476-06:00"}
{"id":"the-system-rcp3","title":"LOW: Inconsistent array vs object access in rehydrator","description":"Location: packages/execution-core/src/rehydrator.ts:59-62\n\nThe code accesses query results as array indices (snap[0], snap[1]) but other queries use typed object access. Could cause undefined values if GraphClient returns objects.\n\nFix: Use consistent access pattern with proper typing.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:58:48.225806-06:00","updated_at":"2025-12-09T16:58:48.225806-06:00"}
{"id":"the-system-rjw","title":"MEDIUM: Interval timers not cleared on shutdown","description":"Location: apps/memory/src/index.ts:142-165\n\nstartPruningJob() and startTurnCleanupJob() create setInterval timers but never store or return the interval IDs. The shutdown handler only clears heartbeatInterval.\n\nImpact: Timers continue running during shutdown, may cause errors.\n\nFix: Store interval IDs and clear them in shutdown handler.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:57:02.388938-06:00","updated_at":"2025-12-09T16:57:02.388938-06:00"}
{"id":"the-system-skbg","title":"MEDIUM: Redis connection not disconnected on shutdown","description":"Location: apps/ingestion/src/index.ts:217-242\n\nRedis publisher is created but redis.disconnect() is never called in the shutdown handler. Connection is left open.\n\nImpact: Redis connections may leak on shutdown.\n\nFix: Add redis.disconnect() call in shutdown handler.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:58:21.809651-06:00","updated_at":"2025-12-09T16:58:21.809651-06:00"}
{"id":"the-system-sqb","title":"Add circuit breaker for reranking latency protection","description":"Implement circuit breaker to fall back to RRF if reranking is slow.\n\nReference: docs/plans/reranker-implementation.md (Section 12)\n\nRisk mitigation:\n- If rerank latency \u003e 500ms, fall back to RRF-only results\n- Circuit breaker pattern to prevent cascading failures\n- Log fallback events for monitoring\n\nImplementation:\n```typescript\nconst RERANK_TIMEOUT_MS = 500;\n\nasync searchWithRerank(query, rawResults) {\n  try {\n    const reranked = await Promise.race([\n      this.reranker.rerank(...),\n      timeout(RERANK_TIMEOUT_MS)\n    ]);\n    return reranked;\n  } catch (e) {\n    logger.warn({ event: \"rerank_fallback\", reason: e.message });\n    return rawResults; // Fallback to RRF\n  }\n}\n```\n\nLocation: packages/search-core/src/services/retriever.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:58:12.099734-06:00","updated_at":"2025-12-08T23:25:14.990579-06:00","closed_at":"2025-12-08T23:25:14.990579-06:00"}
{"id":"the-system-sxj","title":"Create Grafana dashboard for reranking metrics","description":"Dashboard panels: latency by tier, cache hit rate, score improvement distribution, error rates","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T23:02:03.550159-06:00","updated_at":"2025-12-09T00:35:33.919843-06:00","closed_at":"2025-12-09T00:35:33.919843-06:00"}
{"id":"the-system-t13","title":"HIGH: Missing named vector field in deduplicator search","description":"Location: packages/search-core/src/services/deduplicator.ts:25-30\n\nThe search does not specify which vector field to use, but the collection has named vectors (text_dense, code_dense, colbert).\n\nSearching without specifying the vector name will fail or produce unexpected results with modern Qdrant API.\n\nFix: Specify the vector field name in the search query.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:56:25.066329-06:00","updated_at":"2025-12-09T16:56:25.066329-06:00"}
{"id":"the-system-test-apps-control","title":"Add Test Coverage: apps/control","description":"Add comprehensive unit and integration tests for apps/control","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:00:00-06:00","updated_at":"2025-12-07T02:05:09.287286-06:00","closed_at":"2025-12-07T02:05:09.287288-06:00","labels":["apps","control","testing"]}
{"id":"the-system-test-apps-execution","title":"Add Test Coverage: apps/execution","description":"Add comprehensive unit and integration tests for apps/execution","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:00:00-06:00","updated_at":"2025-12-07T02:03:42.250721-06:00","closed_at":"2025-12-07T02:03:42.250721-06:00","labels":["apps","execution","testing"]}
{"id":"the-system-test-apps-ingestion","title":"Add Test Coverage: apps/ingestion","description":"Add comprehensive unit and integration tests for apps/ingestion","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:00:00-06:00","updated_at":"2025-12-07T02:05:02.450726-06:00","closed_at":"2025-12-07T02:05:02.450726-06:00","labels":["apps","ingestion","testing"]}
{"id":"the-system-test-apps-interface","title":"Add Test Coverage: apps/interface","description":"Add comprehensive unit and integration tests for apps/interface","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:00:00-06:00","updated_at":"2025-12-07T02:05:45.45239-06:00","closed_at":"2025-12-07T02:05:45.45239-06:00","labels":["apps","interface","testing"]}
{"id":"the-system-test-apps-memory","title":"Add Test Coverage: apps/memory","description":"Add comprehensive unit and integration tests for apps/memory","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:00:00-06:00","updated_at":"2025-12-07T02:06:40.35145-06:00","closed_at":"2025-12-07T02:06:40.35145-06:00","labels":["apps","memory","testing"]}
{"id":"the-system-test-apps-search","title":"Add Test Coverage: apps/search","description":"Add comprehensive unit and integration tests for apps/search","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:00:00-06:00","updated_at":"2025-12-07T02:08:18.988343-06:00","closed_at":"2025-12-07T02:08:18.988343-06:00","labels":["apps","search","testing"]}
{"id":"the-system-test-packages-events","title":"Add Test Coverage: packages/events","description":"Add comprehensive unit and integration tests for packages/events","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:00:00-06:00","updated_at":"2025-12-07T02:02:43.672865-06:00","closed_at":"2025-12-07T02:02:43.672865-06:00","labels":["events","packages","testing"]}
{"id":"the-system-test-packages-execution-core","title":"Add Test Coverage: packages/execution-core","description":"Add comprehensive unit and integration tests for packages/execution-core","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:00:00-06:00","updated_at":"2025-12-07T02:02:43.706184-06:00","closed_at":"2025-12-07T02:02:43.706184-06:00","labels":["execution-core","packages","testing"]}
{"id":"the-system-test-packages-infra","title":"Add Test Coverage: packages/infra","description":"Add comprehensive unit and integration tests for packages/infra","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:00:00-06:00","updated_at":"2025-12-07T02:08:35.766277-06:00","closed_at":"2025-12-07T02:08:35.766277-06:00","labels":["infra","packages","testing"]}
{"id":"the-system-test-packages-ingestion-core","title":"Add Test Coverage: packages/ingestion-core","description":"Add comprehensive unit and integration tests for packages/ingestion-core","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:00:00-06:00","updated_at":"2025-12-07T02:02:43.737909-06:00","closed_at":"2025-12-07T02:02:43.737909-06:00","labels":["ingestion-core","packages","testing"]}
{"id":"the-system-test-packages-logger","title":"Add Test Coverage: packages/logger","description":"Add comprehensive unit and integration tests for packages/logger","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:00:00-06:00","updated_at":"2025-12-07T02:02:43.768391-06:00","closed_at":"2025-12-07T02:02:43.768391-06:00","labels":["logger","packages","testing"]}
{"id":"the-system-test-packages-memory-core","title":"Add Test Coverage: packages/memory-core","description":"Add comprehensive unit and integration tests for packages/memory-core","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:00:00-06:00","updated_at":"2025-12-07T02:02:50.41573-06:00","closed_at":"2025-12-07T02:02:50.415732-06:00","labels":["memory-core","packages","testing"]}
{"id":"the-system-test-packages-search-core","title":"Add Test Coverage: packages/search-core","description":"Add comprehensive unit and integration tests for packages/search-core","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:00:00-06:00","updated_at":"2025-12-07T02:03:50.342864-06:00","closed_at":"2025-12-07T02:03:50.342867-06:00","labels":["packages","search-core","testing"]}
{"id":"the-system-test-packages-storage","title":"Add Test Coverage: packages/storage","description":"Add comprehensive unit and integration tests for packages/storage","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:00:00-06:00","updated_at":"2025-12-07T02:02:43.830572-06:00","closed_at":"2025-12-07T02:02:43.830572-06:00","labels":["packages","storage","testing"]}
{"id":"the-system-test-packages-vfs","title":"Add Test Coverage: packages/vfs","description":"Add comprehensive unit and integration tests for packages/vfs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:00:00-06:00","updated_at":"2025-12-07T02:02:43.860444-06:00","closed_at":"2025-12-07T02:02:43.860444-06:00","labels":["packages","testing","vfs"]}
{"id":"the-system-tim","title":"Update SearchIndexer to generate ColBERT representations","description":"Update indexer to generate ColBERT token embeddings at index time.\n\nReference: docs/plans/reranker-implementation.md (Section 5.2, Strategy 2)\n\nUpdate indexNode():\n```typescript\nasync indexNode(node: IndexableNode) {\n  // Existing dense/sparse vectors\n  const textVector = await this.textEmbedder.embed(content);\n  const sparseVector = await this.textEmbedder.embedSparse(content);\n\n  // NEW: ColBERT token embeddings for late interaction\n  const colbertEmbeddings = await this.colbertEmbedder.encode(content);\n\n  await this.client.upsert(this.collectionName, {\n    points: [{\n      id: node.id,\n      vector: {\n        text_dense: textVector,\n        sparse: sparseVector,\n        colbert: colbertEmbeddings, // Multivector field\n      },\n      payload,\n    }],\n  });\n}\n```\n\nLocation: packages/search-core/src/services/indexer.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:56:57.2403-06:00","updated_at":"2025-12-09T00:36:41.997843-06:00","closed_at":"2025-12-09T00:36:41.997843-06:00","dependencies":[{"issue_id":"the-system-tim","depends_on_id":"the-system-v6c","type":"blocks","created_at":"2025-12-08T23:03:22.919858-06:00","created_by":"daemon"}]}
{"id":"the-system-ua4","title":"HIGH: App crashes on startup if XAI_API_KEY not set","description":"Location: packages/search-core/src/config/runtime-config.ts:207-213\n\nIf XAI_API_KEY is not set and LLM tier is enabled by default, calling RuntimeConfig.get() will throw.\n\nThe default config has llm.enabled = true. Any code that imports and uses RuntimeConfig.get() will throw if XAI_API_KEY is not set.\n\nFix: Make LLM tier disabled by default, or handle missing key gracefully.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:56:23.656683-06:00","updated_at":"2025-12-09T16:56:23.656683-06:00"}
{"id":"the-system-v6c","title":"Add colbert multivector field to Qdrant schema","description":"Add ColBERT multivector field to Qdrant collection schema.\n\nReference: docs/plans/reranker-implementation.md (Section 7.1)\n\nSchema update:\n```typescript\nconst COLLECTION_CONFIG = {\n  vectors: {\n    text_dense: { size: 384, distance: \"Cosine\" },\n    code_dense: { size: 768, distance: \"Cosine\" },\n    // NEW: ColBERT multivector for late interaction\n    colbert: {\n      size: 128,  // Jina ColBERT v2 token dim\n      distance: \"Cosine\",\n      multivector_config: {\n        comparator: \"max_sim\"  // MaxSim for late interaction\n      }\n    },\n  },\n  // ... sparse_vectors unchanged\n};\n```\n\nRequires schema migration for existing data.\n\nLocation: packages/search-core/src/services/schema-manager.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:56:47.551034-06:00","updated_at":"2025-12-09T00:36:41.914216-06:00","closed_at":"2025-12-09T00:36:41.914216-06:00","dependencies":[{"issue_id":"the-system-v6c","depends_on_id":"the-system-dkx","type":"blocks","created_at":"2025-12-08T23:03:21.88198-06:00","created_by":"daemon"}]}
{"id":"the-system-v7fd","title":"MEDIUM: Missing graceful shutdown in execution service","description":"Location: apps/execution/src/index.ts:199-210\n\nThe main() function starts the MCP server but does not register any signal handlers for graceful shutdown. Open database connections are not closed cleanly.\n\nImpact: Container pods may be killed forcefully, resources not released.\n\nFix: Add SIGTERM/SIGINT handlers to disconnect gracefully.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:58:20.947286-06:00","updated_at":"2025-12-09T16:58:20.947286-06:00"}
{"id":"the-system-va1","title":"HIGH: Path traversal vulnerability in NodeFileSystem","description":"Location: packages/vfs/src/node-fs.ts\n\nThe NodeFileSystem class directly passes user-supplied paths to fs module functions without any validation, allowing path traversal attacks.\n\nImpact: If used in a web service context where paths come from user input, this is a critical security vulnerability.\n\nFix: Add basePath validation and normalize paths before use.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:56:20.636638-06:00","updated_at":"2025-12-09T16:56:20.636638-06:00"}
{"id":"the-system-vtt","title":"HIGH: Path traversal vulnerability in FileSystemBlobStore","description":"Location: packages/storage/src/blob.ts:26-31\n\nThe load method directly uses the file path from the URI without any validation or sanitization. An attacker could craft a malicious URI like file://../../../etc/passwd to read arbitrary files.\n\nImpact: Arbitrary file read outside intended blob storage directory.\n\nFix: Validate that resolved path is within the basePath directory.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:56:19.570428-06:00","updated_at":"2025-12-09T16:56:19.570428-06:00"}
{"id":"the-system-vyl","title":"Implement BatchedReranker class","description":"Implement BatchedReranker for parallel document scoring.\n\nReference: docs/plans/reranker-implementation.md (Section 3.2.2)\n\nInterface:\n```typescript\nexport interface BatchedRerankerOptions {\n  model: string;\n  maxBatchSize: number;        // Default: 16\n  maxConcurrency: number;      // Default: 4\n  quantization: \"fp16\" | \"q8\"; // Default: q8\n  cacheEnabled: boolean;\n}\n```\n\nKey optimizations:\n- Dynamic batching based on document length\n- Concurrent batch processing via p-queue\n- Query-document pair caching (LRU)\n\nLocation: packages/search-core/src/services/batched-reranker.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:55:14.679825-06:00","updated_at":"2025-12-08T23:53:30.205501-06:00","closed_at":"2025-12-08T23:53:30.205501-06:00","dependencies":[{"issue_id":"the-system-vyl","depends_on_id":"the-system-020","type":"blocks","created_at":"2025-12-08T22:55:19.883161-06:00","created_by":"daemon"}]}
{"id":"the-system-wai","title":"[EPIC] Phase 0: Foundation - Prerequisites for Refactoring","description":"# Phase 0: Foundation\n\n**Duration**: 2-3 days\n**Blocking**: All subsequent phases (1-5)\n**Parallelization**: Tasks 0.1, 0.2, 0.3 can run in parallel\n\n## Overview\nThese are critical cross-cutting blockers that must be resolved first as they block multiple downstream tasks:\n1. `@engram/storage` Interface Layer - 8 components depend on concrete `FalkorClient`\n2. `@engram/common` Package - Required for shared utilities, errors, constants\n3. Domain Type Consolidation - Types scattered between `memory-core`, `storage`, and apps\n\n## Success Criteria\n- [ ] All apps can import `@engram/common`\n- [ ] Storage interfaces defined and implemented\n- [ ] Domain types consolidated in `memory-core`\n- [ ] All existing tests pass\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 118-246)\n- docs/refactor/packages/storage/REPORT.md\n- docs/refactor/packages/memory-core/REPORT.md","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-09T03:29:42.436073-06:00","updated_at":"2025-12-09T03:49:51.204145-06:00","closed_at":"2025-12-09T03:49:51.204145-06:00","labels":["foundation","p0","refactoring"]}
{"id":"the-system-wai.1","title":"[0.1] Create @engram/common Package","description":"# Task 0.1: Create @engram/common Package\n\n**Effort**: 4 hours\n**Dependencies**: None\n**Blocks**: Phases 1, 2, 3, 4, 5\n**Parallel**: Can run with 0.2, 0.3\n\n## Deliverables\n```\npackages/common/\n  package.json\n  tsconfig.json\n  src/\n    index.ts\n    utils/\n      env.ts       # envBool, envNum, envStr\n      hash.ts      # sha256Hash\n      format.ts    # formatRelativeTime, truncateId\n      retry.ts     # withRetry\n    errors/\n      base.ts      # EngramError\n      domain.ts    # GraphOperationError, ParseError, ValidationError\n    constants/\n      timeouts.ts  # GRAPH_QUERY_MS, TOOL_EXECUTION_MS\n      limits.ts    # CONTENT_MAX_LENGTH, HISTORY_ITEMS\n      intervals.ts # PRUNE_JOB_MS, STALE_TURN_CLEANUP_MS\n```\n\n## Acceptance Criteria\n- [ ] All apps can import `@engram/common`\n- [ ] Existing duplicate code removed from apps\n- [ ] Unit tests pass\n- [ ] Package exports all utilities\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 124-158)\n- Duplicated code identified in all app reports","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T03:29:55.71324-06:00","updated_at":"2025-12-09T03:49:51.092613-06:00","closed_at":"2025-12-09T03:49:51.092613-06:00","labels":["foundation","new-package","parallel-ok","refactoring"],"dependencies":[{"issue_id":"the-system-wai.1","depends_on_id":"the-system-wai","type":"parent-child","created_at":"2025-12-09T03:29:55.713681-06:00","created_by":"daemon"}]}
{"id":"the-system-wai.2","title":"[0.2] Create Interface Layer in @engram/storage","description":"# Task 0.2: Create Interface Layer in @engram/storage\n\n**Effort**: 4 hours\n**Dependencies**: None\n**Blocks**: Tasks 1.1, 3.1, 3.3\n**Parallel**: Can run with 0.1, 0.3\n\n## Deliverables\n```typescript\n// packages/storage/src/interfaces.ts (NEW)\nexport interface GraphClient {\n  connect(): Promise\u003cvoid\u003e;\n  disconnect(): Promise\u003cvoid\u003e;\n  query\u003cT\u003e(cypher: string, params?: Record\u003cstring, unknown\u003e): Promise\u003cT[]\u003e;\n  isConnected(): boolean;\n}\n\nexport interface MessageClient {\n  getProducer(): Promise\u003cProducer\u003e;\n  getConsumer(config: ConsumerConfig): Promise\u003cConsumer\u003e;\n  disconnect(): Promise\u003cvoid\u003e;\n}\n\nexport interface BlobStore {\n  save(content: string | Buffer): Promise\u003cstring\u003e;\n  load(uri: string): Promise\u003cstring\u003e;\n}\n\nexport interface RedisPublisher {\n  publishSessionUpdate(sessionId: string, event: unknown): Promise\u003cvoid\u003e;\n  disconnect(): Promise\u003cvoid\u003e;\n}\n```\n\n## Changes Required\n- Update `FalkorClient` to implement `GraphClient`\n- Update `KafkaClient` to implement `MessageClient`\n- Export interfaces from `packages/storage/src/index.ts`\n- Add missing `redis.ts` export\n\n## Dependent Components (must update after)\n- apps/control - ContextAssembler, SessionInitializer\n- apps/memory - TurnAggregator, index.ts\n- apps/execution - Rehydrator, TimeTravelService\n- apps/search - SearchService\n- packages/memory-core - GraphWriter, GraphMerger, GraphPruner\n- packages/search-core - SearchRetriever, SearchIndexer\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 161-210)\n- docs/refactor/packages/storage/REPORT.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T03:30:08.754876-06:00","updated_at":"2025-12-09T03:49:51.134631-06:00","closed_at":"2025-12-09T03:49:51.134631-06:00","labels":["foundation","interfaces","parallel-ok","refactoring"],"dependencies":[{"issue_id":"the-system-wai.2","depends_on_id":"the-system-wai","type":"parent-child","created_at":"2025-12-09T03:30:08.755326-06:00","created_by":"daemon"}]}
{"id":"the-system-wai.3","title":"[0.3] Consolidate Domain Type Definitions","description":"# Task 0.3: Consolidate Domain Type Definitions\n\n**Effort**: 6 hours\n**Dependencies**: None\n**Blocks**: Task 3.1 (Repository Pattern)\n**Parallel**: Can run with 0.1, 0.2\n\n## Current State (Problem)\n- `packages/storage/src/falkor.ts` - Contains domain types (SessionProperties, TurnProperties)\n- `packages/memory-core/src/models/base.ts` - Re-exports with aliases (`FalkorSessionNode`)\n- Various apps define their own `Session` interfaces\n\n## Target State\n```\npackages/memory-core/src/\n  models/\n    base.ts           # Bitemporal types, BaseNode\n    nodes.ts          # All node types (Session, Turn, Reasoning, ToolCall)\n    edges.ts          # Edge types\n    events.ts         # Event types (moved from @engram/events)\n  index.ts            # Clean exports\n\npackages/storage/src/\n  falkor.ts           # Only FalkorDB-specific types (FalkorNode, FalkorEdge)\n```\n\n## Migration Steps\n1. Move domain types from `storage/falkor.ts` to `memory-core/models/`\n2. Update `storage/falkor.ts` to import from `memory-core` for domain types\n3. Remove aliased re-exports from `memory-core/models/base.ts`\n4. Update all consumers to import from `memory-core`\n\n## References\n- docs/refactor/WORK_ORDER.md (lines 213-246)\n- docs/refactor/packages/memory-core/REPORT.md\n- docs/refactor/packages/storage/REPORT.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-09T03:30:21.743562-06:00","updated_at":"2025-12-09T03:49:51.17081-06:00","closed_at":"2025-12-09T03:49:51.17081-06:00","labels":["foundation","parallel-ok","refactoring","types"],"dependencies":[{"issue_id":"the-system-wai.3","depends_on_id":"the-system-wai","type":"parent-child","created_at":"2025-12-09T03:30:21.744091-06:00","created_by":"daemon"}]}
{"id":"the-system-wbq","title":"Add SpladeEmbedder unit tests","description":"Write unit tests for SpladeEmbedder: sparse vector generation, semantic expansion, empty input handling, sparsity verification. Add to packages/search-core/src/services/splade-embedder.test.ts.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T19:25:06.82236-06:00","updated_at":"2025-12-08T19:40:14.347408-06:00","closed_at":"2025-12-08T19:40:14.347408-06:00","dependencies":[{"issue_id":"the-system-wbq","depends_on_id":"the-system-5nj","type":"blocks","created_at":"2025-12-08T19:25:16.392869-06:00","created_by":"daemon"}]}
{"id":"the-system-wpc","title":"Fix rehydrator session filtering","description":"The Rehydrator in execution-core/src/rehydrator.ts has incomplete session filtering. Cypher queries may return global results instead of session-specific. Need to add session_id parameter to all graph queries. Ref: create-file-state-rehydrator.md","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-08T02:06:08.160022-06:00","updated_at":"2025-12-08T02:23:19.701376-06:00","closed_at":"2025-12-08T02:23:19.701376-06:00"}
{"id":"the-system-wr5","title":"Bounded Context: Deterministic Execution","description":"The 'Motor Cortex'. Virtual File System, Wasm sandbox, and tool execution. See docs/bitemporal/context/deterministic-execution/","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:47:42.435989-06:00","updated_at":"2025-12-06T22:33:15.120536-06:00","closed_at":"2025-12-06T22:33:15.120538-06:00","labels":["context","execution","wasm"]}
{"id":"the-system-wr5.1","title":"Define Virtual File System Structure","description":"In-memory Serializable JSON VFS (Files/Dirs). See docs/bitemporal/context/deterministic-execution/define-virtual-file-system-structure.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:52:12.586566-06:00","updated_at":"2025-12-06T22:29:38.233354-06:00","closed_at":"2025-12-06T22:29:38.233359-06:00","labels":["execution","structure","vfs"],"dependencies":[{"issue_id":"the-system-wr5.1","depends_on_id":"the-system-wr5","type":"parent-child","created_at":"2025-12-06T21:52:12.586995-06:00","created_by":"daemon"}]}
{"id":"the-system-wr5.10","title":"Implement Tool Execution Monitor","description":"Orchestrate Wasm start and timeout monitoring. See docs/bitemporal/context/deterministic-execution/implement-tool-execution-monitor.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:52:12.967993-06:00","updated_at":"2025-12-06T22:30:52.068871-06:00","closed_at":"2025-12-06T22:30:52.068873-06:00","labels":["execution","monitor"],"dependencies":[{"issue_id":"the-system-wr5.10","depends_on_id":"the-system-wr5","type":"parent-child","created_at":"2025-12-06T21:52:12.968351-06:00","created_by":"daemon"}]}
{"id":"the-system-wr5.11","title":"Develop Output Capture","description":"Capture stdout/stderr from Wasm instance. See docs/bitemporal/context/deterministic-execution/develop-output-capture.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:52:13.012726-06:00","updated_at":"2025-12-06T22:30:52.096075-06:00","closed_at":"2025-12-06T22:30:52.096077-06:00","labels":["execution","io","logs"],"dependencies":[{"issue_id":"the-system-wr5.11","depends_on_id":"the-system-wr5","type":"parent-child","created_at":"2025-12-06T21:52:13.013154-06:00","created_by":"daemon"}]}
{"id":"the-system-wr5.12","title":"Implement Deterministic Replay Engine","description":"Re-run sessions with mocked Time/RNG. See docs/bitemporal/context/deterministic-execution/implement-deterministic-replay-engine.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:52:13.055726-06:00","updated_at":"2025-12-06T22:31:25.804664-06:00","closed_at":"2025-12-06T22:31:25.804666-06:00","labels":["determinism","execution","replay"],"dependencies":[{"issue_id":"the-system-wr5.12","depends_on_id":"the-system-wr5","type":"parent-child","created_at":"2025-12-06T21:52:13.056108-06:00","created_by":"daemon"}]}
{"id":"the-system-wr5.13","title":"Create Time Travel State Reconstruction","description":"Export VFS state at specific event_id. See docs/bitemporal/context/deterministic-execution/create-time-travel-state-reconstruction.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T21:52:13.09828-06:00","updated_at":"2025-12-06T23:52:26.332939-06:00","closed_at":"2025-12-06T23:52:26.332942-06:00","labels":["debugging","execution","time-travel"],"dependencies":[{"issue_id":"the-system-wr5.13","depends_on_id":"the-system-wr5","type":"parent-child","created_at":"2025-12-06T21:52:13.098657-06:00","created_by":"daemon"}]}
{"id":"the-system-wr5.14","title":"Define Execution Error Handling","description":"Classify User vs System errors. See docs/bitemporal/context/deterministic-execution/define-execution-error-handling.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:52:13.139375-06:00","updated_at":"2025-12-06T22:31:25.836445-06:00","closed_at":"2025-12-06T22:31:25.836447-06:00","labels":["errors","execution"],"dependencies":[{"issue_id":"the-system-wr5.14","depends_on_id":"the-system-wr5","type":"parent-child","created_at":"2025-12-06T21:52:13.139707-06:00","created_by":"daemon"}]}
{"id":"the-system-wr5.15","title":"Implement Wassette MCP Client","description":"Expose execution tools via MCP. See docs/bitemporal/context/deterministic-execution/implement-wassette-mcp-client.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:52:13.183237-06:00","updated_at":"2025-12-06T22:31:25.865417-06:00","closed_at":"2025-12-06T22:31:25.865419-06:00","labels":["api","execution","mcp"],"dependencies":[{"issue_id":"the-system-wr5.15","depends_on_id":"the-system-wr5","type":"parent-child","created_at":"2025-12-06T21:52:13.183643-06:00","created_by":"daemon"}]}
{"id":"the-system-wr5.2","title":"Implement VFS Snapshot Logic","description":"Serialize/Compress VFS state to JSON/Gzip. See docs/bitemporal/context/deterministic-execution/implement-vfs-snapshot-logic.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:52:12.629537-06:00","updated_at":"2025-12-06T22:29:38.265809-06:00","closed_at":"2025-12-06T22:29:38.265812-06:00","labels":["execution","snapshot","vfs"],"dependencies":[{"issue_id":"the-system-wr5.2","depends_on_id":"the-system-wr5","type":"parent-child","created_at":"2025-12-06T21:52:12.629924-06:00","created_by":"daemon"}]}
{"id":"the-system-wr5.3","title":"Implement Diff Application Logic","description":"Apply Unified Diffs to VFS files. See docs/bitemporal/context/deterministic-execution/implement-diff-application-logic.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:52:12.673244-06:00","updated_at":"2025-12-06T22:29:38.29288-06:00","closed_at":"2025-12-06T22:29:38.292881-06:00","labels":["diff","execution","vfs"],"dependencies":[{"issue_id":"the-system-wr5.3","depends_on_id":"the-system-wr5","type":"parent-child","created_at":"2025-12-06T21:52:12.673664-06:00","created_by":"daemon"}]}
{"id":"the-system-wr5.4","title":"Create File State Rehydrator","description":"Reconstruct VFS from Snapshot + Diffs chain. See docs/bitemporal/context/deterministic-execution/create-file-state-rehydrator.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:52:12.715327-06:00","updated_at":"2025-12-06T22:29:41.480122-06:00","closed_at":"2025-12-06T22:29:41.480129-06:00","labels":["execution","rehydration","vfs"],"dependencies":[{"issue_id":"the-system-wr5.4","depends_on_id":"the-system-wr5","type":"parent-child","created_at":"2025-12-06T21:52:12.715735-06:00","created_by":"daemon"}]}
{"id":"the-system-wr5.5","title":"Define Wassette Runtime Configuration","description":"Wasm runtime config schema (memory, env, preopens). See docs/bitemporal/context/deterministic-execution/define-wassette-runtime-configuration.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:52:12.75718-06:00","updated_at":"2025-12-06T22:30:19.573724-06:00","closed_at":"2025-12-06T22:30:19.573727-06:00","labels":["config","execution","wasm"],"dependencies":[{"issue_id":"the-system-wr5.5","depends_on_id":"the-system-wr5","type":"parent-child","created_at":"2025-12-06T21:52:12.757567-06:00","created_by":"daemon"}]}
{"id":"the-system-wr5.6","title":"Implement Wasm Module Loader","description":"Load and cache Wasm binaries (Python, QuickJS). See docs/bitemporal/context/deterministic-execution/implement-wasm-module-loader.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:52:12.798975-06:00","updated_at":"2025-12-06T22:30:19.604291-06:00","closed_at":"2025-12-06T22:30:19.604297-06:00","labels":["execution","loader","wasm"],"dependencies":[{"issue_id":"the-system-wr5.6","depends_on_id":"the-system-wr5","type":"parent-child","created_at":"2025-12-06T21:52:12.799295-06:00","created_by":"daemon"}]}
{"id":"the-system-wr5.7","title":"Develop Sandbox Security Policy","description":"Enforce No-Network, Read-Only Sysroot. See docs/bitemporal/context/deterministic-execution/develop-sandbox-security-policy.md","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T21:52:12.840586-06:00","updated_at":"2025-12-06T22:30:19.633304-06:00","closed_at":"2025-12-06T22:30:19.633306-06:00","labels":["execution","sandbox","security"],"dependencies":[{"issue_id":"the-system-wr5.7","depends_on_id":"the-system-wr5","type":"parent-child","created_at":"2025-12-06T21:52:12.841015-06:00","created_by":"daemon"}]}
{"id":"the-system-wr5.8","title":"Implement Standard Tool Wrapper","description":"Python/JS wrapper to read stdin args and print JSON stdout. See docs/bitemporal/context/deterministic-execution/implement-standard-tool-wrapper-wasm.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:52:12.883147-06:00","updated_at":"2025-12-06T22:30:52.011823-06:00","closed_at":"2025-12-06T22:30:52.011826-06:00","labels":["execution","tools","wrapper"],"dependencies":[{"issue_id":"the-system-wr5.8","depends_on_id":"the-system-wr5","type":"parent-child","created_at":"2025-12-06T21:52:12.883517-06:00","created_by":"daemon"}]}
{"id":"the-system-wr5.9","title":"Create MCP Tool Registry","description":"Registry mapping tool names to Wasm entrypoints. See docs/bitemporal/context/deterministic-execution/create-mcp-tool-registry.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T21:52:12.926676-06:00","updated_at":"2025-12-06T22:30:52.04181-06:00","closed_at":"2025-12-06T22:30:52.041813-06:00","labels":["execution","mcp","registry"],"dependencies":[{"issue_id":"the-system-wr5.9","depends_on_id":"the-system-wr5","type":"parent-child","created_at":"2025-12-06T21:52:12.927093-06:00","created_by":"daemon"}]}
{"id":"the-system-wv6","title":"Add Prometheus metrics for reranking latency","description":"Histogram: search_rerank_latency_ms with tier/model labels, buckets [10,25,50,100,200,500,1000]ms","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T23:01:59.452692-06:00","updated_at":"2025-12-08T23:58:29.354572-06:00","closed_at":"2025-12-08T23:58:29.354572-06:00"}
{"id":"the-system-x0k","title":"MEDIUM: Module-level state shared between TurnAggregator instances","description":"Location: apps/memory/src/turn-aggregator.ts:56-59\n\nThe activeTurns and sessionSequence maps are declared at module level but accessed by instance methods. sessionSequence is never cleaned up.\n\nImpact: State leakage between tests, memory leak over time.\n\nFix: Move maps to instance properties or implement cleanup mechanism.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:57:01.517812-06:00","updated_at":"2025-12-09T16:57:01.517812-06:00"}
{"id":"the-system-x3n","title":"Implement LLMListwiseReranker class","description":"Implement LLM-based listwise reranker using grok-4-1-fast-reasoning.\n\nReference: docs/plans/reranker-implementation.md (Section 3.2.4)\n\nInterface:\n```typescript\nexport interface LLMRerankerOptions {\n  model: \"grok-4-1-fast-reasoning\";\n  maxCandidates: number;  // Max 10 for context efficiency\n  systemPrompt?: string;  // Custom ranking instructions\n}\n\nexport class LLMListwiseReranker {\n  async rerank(\n    query: string,\n    candidates: DocumentCandidate[],\n    topK: number\n  ): Promise\u003cRerankResult[]\u003e;\n}\n```\n\nImplementation notes:\n- Single API call with all candidates in prompt\n- Request ordered list response\n- Parse ranking from LLM output\n- Handle rate limiting and errors\n\nLocation: packages/search-core/src/services/llm-reranker.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T22:57:14.539443-06:00","updated_at":"2025-12-09T00:36:40.284518-06:00","closed_at":"2025-12-09T00:36:40.284518-06:00","dependencies":[{"issue_id":"the-system-x3n","depends_on_id":"the-system-g0a","type":"blocks","created_at":"2025-12-08T23:03:24.05078-06:00","created_by":"daemon"}]}
{"id":"the-system-xr2","title":"Add unit tests for sparse and hybrid search in SearchRetriever","description":"Add unit tests for the new sparse and hybrid search paths in SearchRetriever.\n\nReference: docs/plans/hybrid-retriever.md (Phase 4)\n\nChanges to packages/search-core/src/services/retriever.test.ts:\n\nNew test cases:\n1. \"should perform sparse-only search\"\n   - Mock textEmbedder.embedSparseQuery to return { indices: [...], values: [...] }\n   - Call search() with strategy: \"sparse\"\n   - Verify client.query called with sparse vector format\n   - Verify using: \"sparse\" in the query\n\n2. \"should perform hybrid search with RRF fusion\"\n   - Mock both embedQuery and embedSparseQuery\n   - Call search() with strategy: \"hybrid\"\n   - Verify client.query called with prefetch array containing both vectors\n   - Verify query: { fusion: \"rrf\" } is present\n\n3. \"should handle code search in hybrid mode\"\n   - Set filters.type = \"code\"\n   - Verify prefetch uses \"code_dense\" vector name (not \"text_dense\")\n\n4. \"should oversample in prefetch for better fusion\"\n   - Request limit: 5\n   - Verify prefetch limit is 10 (2x)\n\nExisting integration tests in hybrid-search.integration.test.ts already cover end-to-end behavior.\n\nDepends on: the-system-6bo (hybrid implementation must exist to test it)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T21:38:21.041701-06:00","updated_at":"2025-12-08T21:50:12.32914-06:00","closed_at":"2025-12-08T21:50:12.32914-06:00","dependencies":[{"issue_id":"the-system-xr2","depends_on_id":"the-system-6bo","type":"blocks","created_at":"2025-12-08T21:38:28.77441-06:00","created_by":"daemon"}]}
{"id":"the-system-xtr","title":"Expand GraphQL query execution","description":"GraphQL handler in interface/app/api/graphql/route.ts is minimal. Schema is defined but resolvers need full implementation for session, search, and graph queries. Ref: create-graphql-schema-definition.md","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T02:06:26.65604-06:00","updated_at":"2025-12-08T02:37:25.907356-06:00","closed_at":"2025-12-08T02:37:25.907356-06:00"}
{"id":"the-system-xydh","title":"Milestone 2: Optimized Retrieval","description":"Turn-level granularity indexing, key expansion (fact extraction), time-aware query expansion, hybrid retrieval","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T11:33:33.557628-06:00","updated_at":"2025-12-18T12:13:41.063685-06:00","closed_at":"2025-12-18T12:13:41.063685-06:00","dependencies":[{"issue_id":"the-system-xydh","depends_on_id":"the-system-jlk2","type":"blocks","created_at":"2025-12-18T11:34:04.564238-06:00","created_by":"ccheney"}]}
{"id":"the-system-yfq","title":"Implement lazy model loading with unload on idle","description":"Load reranker models on first use. Unload after 5min idle to prevent OOM. Track model_loaded/model_unloaded events.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T23:02:28.222358-06:00","updated_at":"2025-12-09T00:13:51.319618-06:00","closed_at":"2025-12-09T00:13:51.319618-06:00"}
{"id":"the-system-yhwz","title":"LOW: applySearchReplace only replaces first match","description":"Location: packages/vfs/src/patch.ts:44-51\n\nThe method uses String.replace() which only replaces the first occurrence. Users may expect all occurrences to be replaced.\n\nFix: Document behavior or add replaceAll option.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:58:49.083405-06:00","updated_at":"2025-12-09T16:58:49.083405-06:00"}
{"id":"the-system-ypub","title":"Milestone 3: Optimized Reading","description":"Chain-of-Note implementation, structured JSON prompts, abstention confidence calibration","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T11:33:40.424722-06:00","updated_at":"2025-12-18T12:24:41.33083-06:00","closed_at":"2025-12-18T12:24:41.33083-06:00","dependencies":[{"issue_id":"the-system-ypub","depends_on_id":"the-system-xydh","type":"blocks","created_at":"2025-12-18T11:34:10.87876-06:00","created_by":"ccheney"}]}
{"id":"the-system-yu2","title":"Implement Qdrant snapshot recovery","description":"SnapshotManager can list and create snapshots but cannot restore from them. Need to implement restoreSnapshot() method for disaster recovery. Ref: implement-qdrant-snapshot-manager.md","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T02:06:29.976926-06:00","updated_at":"2025-12-08T02:44:01.472982-06:00","closed_at":"2025-12-08T02:44:01.472982-06:00"}
{"id":"the-system-yvk","title":"Implement document representation LRU cache","description":"In-memory LRU cache for ColBERT document embeddings. Max size 1GB, 1hr TTL. Invalidate on document update.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T23:02:12.52381-06:00","updated_at":"2025-12-09T00:24:36.899172-06:00","closed_at":"2025-12-09T00:24:36.899172-06:00"}
{"id":"the-system-yvm","title":"Verify Wasm Tool Execution","description":"the-system-1p4","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T00:36:29.042108-06:00","updated_at":"2025-12-07T00:43:53.917833-06:00","closed_at":"2025-12-07T00:43:53.917833-06:00"}
{"id":"the-system-yxm","title":"Implement async reranking option","description":"Return RRF results immediately, rerank in background, push refined results via WebSocket. Opt-in per query.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T23:02:14.294709-06:00","updated_at":"2025-12-09T00:35:33.156434-06:00","closed_at":"2025-12-09T00:35:33.156434-06:00"}
{"id":"the-system-z3xy","title":"MEDIUM: DoS vulnerability - no request body size limit","description":"Location: apps/search/src/index.ts:219-238\n\nThe HTTP handler accumulates request body chunks without any size limit. An attacker can send arbitrarily large POST body.\n\nImpact: Denial of Service via memory exhaustion.\n\nFix: Add MAX_BODY_SIZE check and reject oversized requests.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T16:58:22.659182-06:00","updated_at":"2025-12-09T16:58:22.659182-06:00"}
{"id":"the-system-z60","title":"Implement deterministic replay engine","description":"The ReplayEngine class in execution-core/src/replay.ts is a complete stub. Need to implement: VFS rehydration, RNG seeding for determinism, Date.now() mocking, execution and output comparison. Ref: TSD 3.4.1, implement-deterministic-replay-engine.md","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-08T02:05:38.580517-06:00","updated_at":"2025-12-08T02:25:22.052627-06:00","closed_at":"2025-12-08T02:25:22.052627-06:00","dependencies":[{"issue_id":"the-system-z60","depends_on_id":"the-system-wpc","type":"blocks","created_at":"2025-12-08T02:06:46.309574-06:00","created_by":"daemon"}]}
